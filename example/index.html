<html>
    <head>
        <meta charset="utf-8"></meta>
        <title>Useless Examples</title>

        <script src="/example/lib/underscore-min.js"></script>
        <script src="/example/lib/jquery-2.0.3.min.js"></script>
        <script src="/useless.js"></script>
        <script src="/useless/jQueryPlus.js"></script>

        <!-- UI.error -->
        <script src="/useless/UI.error.js"></script>
        <link rel="stylesheet" href="/useless/UI.error.css" type="text/css">

        <!-- Data access -->
        <script src="/useless/DataManager.js"></script>

    </head>
    <style>
        body { font-family: Helvetica, sans-serif; padding: 20px; }
        h1 { font-size: 40px; }

        button { font-size: 20px; padding: 1em; }

        .sliddah {
            margin-bottom: 10px;
            width:         100%;
            height:        24px;
            display:       block;
            position:      relative; }

        .sliddah:before {
            position: absolute;
            left: 0;
            top: 10px;
            right: 0;
            bottom: 10px;
            content: '';
            background: rgba(0,0,0,0.25);
            border-radius: 5px; }

        .sliddah em {
            box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
            position: absolute;
            left:    0px;
            top:    12px;
            width:  24px;
            height: 24px;
            margin-left: -12px;
            margin-top:  -12px;
            background: black;
            border-radius: 24px;
            text-align: center;
            line-height: 24px;
            font-size: 10px;
            color: white;
            cursor: default;
            -webkit-transition: color 0.2s ease-in-out; }
    </style>
    <script>

        function initErrorHandlingDemo () {

            /*  Bind UI.error as default exception handler
             */
            _.withUncaughtExceptionHandler (function (e) {
                UI.error (e, undefined, _.identity) })

            /*  Define some function that throws error
             */
            function erroneousFunction () {
                _.map ([1,2,3], callMe) }

            /*  Bind to button to trigger that function
             */
            $('#ui-error-demo').click (erroneousFunction) }

        function initComponentDemo () {

            /*  Defines slider component
             */
            Sliddah = $component ({

                $requires: {
                    min:   'number',
                    max:   'number',
                    value: 'number' },

                value: $observableProperty (),

                init: function () {
                    this.dom = $('<div class="sliddah">')
                        .append (this.handle = $('<em>'))
                        .drag ({
                            callMoveAtStart: true,
                            move: this.$ (function (memo, where, offset) {
                                this.value = _.rescale (offset.x,
                                    [0,        this.dom.width ()],
                                    [this.min, this.max], { clamp: true }) }) })

                    _.delay (this.$ (function () {
                        this.valueChange (this.$ (function (v) {
                            this.handle.css ({
                                left: Math.round (_.rescale (v,
                                                    [this.min, this.max],
                                                    [0, this.dom.width ()], { clamp: true })) }) })) })) },

                destroy: function () {
                    this.dom.remove () } })

            /*  Constructs slider instance
             */
            var slider1 = new Sliddah ({
                min:   10,
                max:   100,
                value: 42,                                          // inits $observableProperty from config
                valueChange: function (x) {                         // binds from config
                    this.handle.text (x.toFixed (0))  } })          // 'this' passed to trigger callback
                  
            var slider2 = new Sliddah ({ min: 0, max: 1, value: 1,
                valueChange: function (x) {
                    $(document.body).css ('background',
                        _.RGB2CSS ([x, 1, 1])) } })

            /*  Appends slider to DOM tree
             */
            $('#component-demo').append ([slider1.dom, slider2.dom]) }

        /*  Init demos
         */
        $(document).ready (function () {
            
            initErrorHandlingDemo ()
            initComponentDemo ()  })
        </script>

    <body>

        <h1># UI.error demo</h1>
        <button id="ui-error-demo">Call erroneousFunction</button>

        <h1># $component demo</h1>
        <div id="component-demo" style="width: 400px;"></div>

    </body>
</html>
