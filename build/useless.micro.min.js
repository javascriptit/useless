var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[$jscomp.global.Symbol.iterator])return a[$jscomp.global.Symbol.iterator]();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);e&&$jscomp.global.Object.defineProperty(a,d,e)}else a[d]=b[d]};$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};
$jscomp.array.arrayIterator_=function(a,b){a instanceof String&&(a=String(a));var c=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={},e=(d.next=function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}e.next=$jscomp.array.done_;return $jscomp.array.done_()},d[Symbol.iterator]=function(){return e},d);return e};
$jscomp.array.findInternal_=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};
$jscomp.array.from=function(a,b,c){b=void 0===b?function(a){return a}:b;var d=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(a[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=a[Symbol.iterator]();for(var e;!(e=a.next()).done;)d.push(b.call(c,e.value))}else{e=a.length;for(var f=0;f<e;f++)d.push(b.call(c,a[f]))}return d};$jscomp.array.of=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return $jscomp.array.from(b)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return[a,b]})};$jscomp.array.installHelper_=function(a,b){!Array.prototype[a]&&Object.defineProperties&&Object.defineProperty&&Object.defineProperty(Array.prototype,a,{configurable:!0,enumerable:!1,writable:!0,value:b})};$jscomp.array.entries$install=function(){$jscomp.array.installHelper_("entries",$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(a){return a})};
$jscomp.array.keys$install=function(){$jscomp.array.installHelper_("keys",$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(a,b){return b})};$jscomp.array.values$install=function(){$jscomp.array.installHelper_("values",$jscomp.array.values)};
$jscomp.array.copyWithin=function(a,b,c){var d=this.length;a=Number(a);b=Number(b);c=Number(null!=c?c:d);if(a<b)for(c=Math.min(c,d);b<c;)b in this?this[a++]=this[b++]:(delete this[a++],b++);else for(c=Math.min(c,d+b-a),a+=c-b;c>b;)--c in this?this[--a]=this[c]:delete this[a];return this};$jscomp.array.copyWithin$install=function(){$jscomp.array.installHelper_("copyWithin",$jscomp.array.copyWithin)};
$jscomp.array.fill=function(a,b,c){null!=c&&a.length||(c=this.length||0);c=Number(c);for(b=Number((void 0===b?0:b)||0);b<c;b++)this[b]=a;return this};$jscomp.array.fill$install=function(){$jscomp.array.installHelper_("fill",$jscomp.array.fill)};$jscomp.array.find=function(a,b){return $jscomp.array.findInternal_(this,a,b).v};$jscomp.array.find$install=function(){$jscomp.array.installHelper_("find",$jscomp.array.find)};
$jscomp.array.findIndex=function(a,b){return $jscomp.array.findInternal_(this,a,b).i};$jscomp.array.findIndex$install=function(){$jscomp.array.installHelper_("findIndex",$jscomp.array.findIndex)};$jscomp.Map=function(a){a=void 0===a?[]:a;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,this.set(b[0],b[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var a=$jscomp.global.Map;if(!a||!a.prototype.entries||!Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(f){return!1}};
$jscomp.Map.createHead_=function(){var a={};return a.previous=a.next=a.head=a};$jscomp.Map.getId_=function(a){if(!(a instanceof Object))return String(a);$jscomp.Map.key_ in a||a instanceof Object&&Object.isExtensible&&Object.isExtensible(a)&&$jscomp.Map.defineProperty_(a,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in a?a[$jscomp.Map.key_]:" "+a};
$jscomp.Map.prototype.set=function(a,b){var c=this.maybeGetEntry_(a),d=c.id,e=c.list,c=c.entry;e||(e=this.data_[d]=[]);c?c.value=b:(c={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.push(c),this.head_.previous.next=c,this.head_.previous=c,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(a){var b=this.maybeGetEntry_(a);a=b.id;var c=b.list,d=b.index;return(b=b.entry)&&c?(c.splice(d,1),c.length||delete this.data_[a],b.previous.next=b.next,b.next.previous=b.previous,b.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(a){return!!this.maybeGetEntry_(a).entry};
$jscomp.Map.prototype.get=function(a){return(a=this.maybeGetEntry_(a).entry)&&a.value};$jscomp.Map.prototype.maybeGetEntry_=function(a){var b=$jscomp.Map.getId_(a),c=this.data_[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];if(a!==a&&e.key!==e.key||a===e.key)return{id:b,list:c,index:d,entry:e}}return{id:b,list:c,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(a){return[a.key,a.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(a){return a.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(a){return a.value})};$jscomp.Map.prototype.forEach=function(a,b){for(var c=$jscomp.makeIterator(this.entries()),d=c.next();!d.done;d=c.next())d=d.value,a.call(b,d[1],d[0],this)};
$jscomp.Map.prototype.iter_=function(a){var b=this,c=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d.next=function(){if(c){for(;c.head!=b.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:a(c)};c=null}return{done:!0,value:void 0}},d[Symbol.iterator]=function(){return this},d};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(a,b,c){Object.defineProperty(a,b,{value:String(c)})}:function(a,b,c){a[b]=String(c)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(a){a=Number(a)>>>0;if(0===a)return 32;var b=0;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);0===(a&2147483648)&&b++;return b};$jscomp.math.imul=function(a,b){a=Number(a);b=Number(b);var c=a&65535,d=b&65535;return c*d+((a>>>16&65535)*d+c*(b>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1};
$jscomp.math.log10=function(a){return Math.log(a)/Math.LN10};$jscomp.math.log2=function(a){return Math.log(a)/Math.LN2};$jscomp.math.log1p=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0,f=1;e!=d;)b*=a,f*=-1,d=(e=d)+f*b/++c;return d}return Math.log(1+a)};$jscomp.math.expm1=function(a){a=Number(a);if(.25>a&&-.25<a){for(var b=a,c=1,d=a,e=0;e!=d;)b*=a/++c,d=(e=d)+b;return d}return Math.exp(a)-1};$jscomp.math.cosh=function(a){a=Number(a);return(Math.exp(a)+Math.exp(-a))/2};
$jscomp.math.sinh=function(a){a=Number(a);return 0===a?a:(Math.exp(a)-Math.exp(-a))/2};$jscomp.math.tanh=function(a){a=Number(a);if(0===a)return a;var b=Math.exp(2*-Math.abs(a)),b=(1-b)/(1+b);return 0>a?-b:b};$jscomp.math.acosh=function(a){a=Number(a);return Math.log(a+Math.sqrt(a*a-1))};$jscomp.math.asinh=function(a){a=Number(a);if(0===a)return a;var b=Math.log(Math.abs(a)+Math.sqrt(a*a+1));return 0>a?-b:b};
$jscomp.math.atanh=function(a){a=Number(a);return($jscomp.math.log1p(a)-$jscomp.math.log1p(-a))/2};
$jscomp.math.hypot=function(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];a=Number(a);b=Number(b);for(var f=Math.max(Math.abs(a),Math.abs(b)),g=$jscomp.makeIterator(d),e=g.next();!e.done;e=g.next())f=Math.max(f,Math.abs(e.value));if(1E100<f||1E-100>f){a/=f;b/=f;g=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,e=Number(e)/f,g+=e*e;return Math.sqrt(g)*f}f=a*a+b*b;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,e=Number(e),f+=
e*e;return Math.sqrt(f)};$jscomp.math.trunc=function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b};$jscomp.math.cbrt=function(a){if(0===a)return a;a=Number(a);var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a};
$jscomp.number.isInteger=function(a){return $jscomp.number.isFinite(a)?a===Math.floor(a):!1};$jscomp.number.isNaN=function(a){return"number"===typeof a&&isNaN(a)};$jscomp.number.isSafeInteger=function(a){return $jscomp.number.isInteger(a)&&Math.abs(a)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next())if(d=d.value)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e]);return a};$jscomp.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};$jscomp.Set=function(a){a=void 0===a?[]:a;this.map_=new $jscomp.Map;if(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this.add(b.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var a=$jscomp.global.Set;if(!a||!a.prototype.entries||!Object.seal)return!1;var b=Object.seal({x:4}),a=new a($jscomp.makeIterator([b]));if(a.has(b)||1!=a.size||a.add(b)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var a=a.entries(),c=a.next();if(c.done||c.value[0]!=b||c.value[1]!=b)return!1;c=a.next();return c.done||c.value[0]==b||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:a.next().done};
$jscomp.Set.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(a){return this.map_.has(a)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noNullOrUndefined_=function(a,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");};$jscomp.string.noRegExp_=function(a,b){if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];for(var c="",b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next()){d=d.value;d=+d;if(0>d||1114111<d||d!==Math.floor(d))throw new RangeError("invalid_code_point "+d);65535>=d?c+=String.fromCharCode(d):(d-=65536,c+=String.fromCharCode(d>>>10&1023|55296),c+=String.fromCharCode(d&1023|56320))}return c};
$jscomp.string.repeat=function(a){$jscomp.string.noNullOrUndefined_(this,"repeat");var b=String(this);if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(a){$jscomp.string.noNullOrUndefined_(this,"codePointAt");var b=String(this),c=b.length;a=Number(a)||0;if(0<=a&&a<c){a|=0;var d=b.charCodeAt(a);if(55296>d||56319<d||a+1===c)return d;a=b.charCodeAt(a+1);return 56320>a||57343<a?d:1024*(d-55296)+a+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"includes");$jscomp.string.noNullOrUndefined_(this,"includes");return-1!==String(this).indexOf(a,b)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(a,b){b=void 0===b?0:b;$jscomp.string.noRegExp_(a,"startsWith");$jscomp.string.noNullOrUndefined_(this,"startsWith");var c=String(this);a+="";for(var d=c.length,e=a.length,f=Math.max(0,Math.min(b|0,c.length)),g=0;g<e&&f<d;)if(c[f++]!=a[g++])return!1;return g>=e};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(a,b){$jscomp.string.noRegExp_(a,"endsWith");$jscomp.string.noNullOrUndefined_(this,"endsWith");var c=String(this);a+="";void 0===b&&(b=c.length);for(var d=Math.max(0,Math.min(b|0,c.length)),e=a.length;0<e&&0<d;)if(c[--d]!=a[--e])return!1;return 0>=e};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};$uselessFile="useless.micro.js";
"undefined"!==typeof require&&(_=require("underscore"),$include=require);_=function(){_.mixin({zipWith:function(a,b){return _.reduce(_.rest(a),function(a,d){return _.times(Math.max(a&&a.length||0,d&&d.length||0),function(e){return b(a&&a[e],d&&d[e])})},_.first(a))}});if("a1 b2 c3"!==_.zipWith([["a","b","c"],[1,2,3]],function(a,b){return a+b}).join(" "))throw Error("_.zipWith broken");return _}();_.tests={};_.deferTest=_.withTest=function(a,b,c){c()};
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof navigator&&navigator.platform&&navigator.platform.indexOf?_.extend({engine:"browser",browserEngine:0<=navigator.userAgent.indexOf("AppleWebKit")?"WebKit":void 0,browser:0<=navigator.userAgent.indexOf("Firefox")?"Firefox":0<=navigator.userAgent.indexOf("Chrome")?"Chrome":0<=navigator.userAgent.indexOf("Safari")?"Safari":0<=navigator.userAgent.indexOf("Trident")?"IE":void 0},0<=navigator.platform.indexOf("Linux arm")||0<=navigator.platform.indexOf("Android")||
0<=navigator.userAgent.indexOf("Android")?{touch:!0,system:"Android"}:0<=navigator.platform.indexOf("iPad")?{touch:!0,system:"iOS",device:"iPad"}:0<=navigator.platform.indexOf("iPhone")||0<=navigator.platform.indexOf("iPod")?{touch:!0,system:"iOS",device:"iPhone"}:{}):"undefined"!==typeof global&&global._?{engine:"node"}:{},b="browser"===a.engine?window:"node"===a.engine?global:void 0;b.define=function(a,d,e){if(a in b)throw Error("cannot define global "+a+": already there");return Object.defineProperty(b,
a,_.extend(d&&d.get instanceof Function&&d.set instanceof Function&&d||d instanceof Function&&0===d.length&&{get:d}||{value:d},{enumerable:!0},e))};b.define("$global",b);b.define("$platform",Object.defineProperties({},_.mapObject({engine:a.engine,system:a.system,device:a.device,touch:a.touch||!1,IE:"IE"===a.browser,Firefox:"Firefox"===a.browser,Safari:"Safari"===a.browser,Chrome:"Chrome"===a.browser,WebKit:"WebKit"===a.browserEngine,Browser:"browser"===a.engine,NodeJS:"node"===a.engine,iPad:"iPad"===
a.device,iPhone:"iPhone"===a.device,iOS:"iOS"===a.system},function(a,b){return{enumerable:!0,value:a}})))})();$overrideUnderscore=function(a,b){return _[a]=b(_[a])};$platform.NodeJS&&($global.alert=function(a){var b=$global.log&&_.partial(log.warn,log.config({stackOffset:2}))||console.log;b.apply(b,["ALERT:"].concat(_.asArray(arguments)))});$global.alert2=function(a){alert(_.map(arguments,_.stringify).join(", "));return arguments[0]};$global.log=function(){console.log.apply(console.log,arguments)};
_.extend(_,{asArray:function(a){return void 0!==a.length?[].slice.call(a,0):[a]}});
_.extend(_,{numArgs:function(a){return void 0===a._ac?a.length:a._ac},restArg:function(a){return a._ra||!1},noArgs:function(a){return 0===_.numArgs(a)&&!a._ra},hasArgs:function(a){return 0<_.numArgs(a)&&!a._ra},oneArg:function(a){return 1===_.numArgs(a)&&!a._ra},withRestArg:$restArg=function(a){Object.defineProperty(a,"_ra",{enumerable:!1,writable:!0,value:!0});return a},withArgs:function(a,b,c){void 0!==a&&Object.defineProperty(c,"_ac",{enumerable:!1,writable:!0,value:a});void 0!==b&&Object.defineProperty(c,
"_ra",{enumerable:!1,writable:!0,value:b});return c},withSameArgs:function(a,b){return _.withArgs(_.numArgs(a),_.restArg(a),b)}});$overrideUnderscore("memoize",function(a){return function(b){return _.withSameArgs(b,a(b))}});$overrideUnderscore("partial",function(a){return $restArg(function(b){return _.withArgs(Math.max(0,_.numArgs(b)-(arguments.length-1)),b._ra,a.apply(this,arguments))})});
$overrideUnderscore("bind",function(a){return $restArg(function(b,c){return _.withArgs(Math.max(0,_.numArgs(b)-(arguments.length-2)),b._ra,a.apply(this,arguments))})});_.debugEcho=function(){return[this].concat(_.asArray(arguments))};_.call=function(a,b,c){return a.apply(b,_.rest(arguments,2))};_.arity=function(a,b){return function(){return b.apply(this,_.first(arguments,a))}};_.arity0=function(a){return function(){return a.call(this)}};_.arity1=function(a){return function(b){return a.call(this,b)}};
_.arity2=function(a){return function(b,c){return a.call(this,b,c)}};_.arity3=function(a){return function(b,c,d){return a.call(this,b,c,d)}};_.arityFn=function(a){return _["arity"+a]};_.tails=$restArg(function(a){var b=_.rest(arguments);return function(){return a.apply(this,_.asArray(arguments).concat(b))}});_.tails2=$restArg(function(a){var b=_.rest(arguments);return function(c){return a.apply(this,[c].concat(b))}});
_.tails3=$restArg(function(a){var b=_.rest(arguments);return function(c,d){return a.apply(this,[c,d].concat(b))}});_.callsTo=function(a){return $restArg(function(){return _.callsWith.apply(null,arguments)(a)})};_.tailsTo=function(a,b){return $restArg(function(){return _.tailsWith.apply(null,arguments)(a)})};_.callsWith=$restArg(function(){var a=_.asArray(arguments);return function(b){return _.withSameArgs(b,function(){return b.apply(this,a.concat(_.asArray(arguments)))})}});
_.tailsWith=$restArg(function(){var a=_.asArray(arguments);return function(b){return _.withSameArgs(b,function(){return b.apply(this,_.asArray(arguments).concat(a))})}});_.argumentAppendingWrapper=function(a,b){return _.withSameArgs(a,function(){var c=this,d=_.asArray(arguments);return b(function(){return a.apply(c,d.concat(_.asArray(arguments)))})})};
_.argumentPrependingWrapper=function(a,b){return _.withSameArgs(a,function(){var c=this,d=_.asArray(arguments);return b(function(){return a.apply(c,_.asArray(arguments).concat(d))})})};_.new_=$restArg(function(a,b,c,d,e){switch(arguments.length){case 1:return new a;case 2:return new a(b);case 3:return new a(b,c);case 4:return new a(b,c,d);case 5:return new a(b,c,d,e);default:_.notImplemented()}});_.flipN=function(a){return $restArg(function(){return a.apply(this,_.asArray(arguments).reverse())})};
_.flip=function(a){if(_.restArg(a))return _.flipN(a);switch(_.numArgs(a)){case 0:case 1:return a;case 2:return _.flip2(a);case 3:return _.flip3(a);default:throw Error("flip: unsupported arity");}};_.flip2=function(a){return function(b,c){return a.call(this,c,b)}};_.flip3=function(a){return function(b,c,d){return a.call(this,d,c,b)}};_.or=function(a,b){return function(){return a.apply(this,arguments)||b.apply(this,arguments)}};
_.and=function(a,b){return function(){return a.apply(this,arguments)&&b.apply(this,arguments)}};_.not=function(a){return function(){return!a.apply(this,arguments)}};_.extend(_,{Y:function(a){var b=a(function(){return b.apply(this,arguments)});return b}});
(function(){_.hyperOperator=function(a,b,c,d){var e=_.arityFn(a)||_.identity,f=(c||_.goDeeperWhenFirstArgumentIsGood)(a,d||_.isNonTrivial);return function(){var a=_.last(arguments);return _.Y(function(c){var d=_.tails(b,e(c));return function(){return(f(arguments)?d:a).apply(this,arguments)}}).apply(this,_.initial(arguments))}};_.goDeeperWhenFirstArgumentIsGood=function(a,b){return function(a){return 0<a.length?b(a[0]):!1}};_.goDeeperAlwaysIfPossible=function(a,b){return 0===a?_.constant(!1):1===a?
function(a){return b(a[0])}:2===a?function(a){return b(a[0])||b(a[1])}:function(a){return _.some(_.asArray(a),b)}};_.goDeeperOnlyWhenNessesary=function(a,b){return 0===a?_.constant(!1):1===a?function(a){return b(a[0])}:2===a?function(a){return b(a[0])&&b(a[1])}:function(a){return _.every(_.asArray(a),b)}};_.isTrivial=function(a){return _.isEmpty(a)||_.isString(a)||_.isNumber(a)||!(_.isStrictlyObject(a)||_.isArray(a))||_.isPrototypeInstance(a)||_.isMeta(a)};_.isMeta=_.constant(!1);_.isNonTrivial=_.not(_.isTrivial);
_.binary=2;_.unary=1})();_.higherOrder=_.callsTo;_.eval=function(a){return _.isFunction(a)?a.call(this):a};_.evals=function(a){var b=arguments;return function(a){return _.isFunction(a)?a.apply(this,b):a}};_.method=function(a){var b=_.rest(arguments);return function(c){return c[a].apply(c,b)}};_.asFreeFunction=function(a){return function(b,c){return a.apply(b,_.rest(arguments))}};_.asMethod=function(a){return function(){return a.apply(void 0,[this].concat(_.asArray(arguments)))}};
_.once=function(a){var b=!1;return function(){if(!b)return b=!0,a.apply(this,arguments)}};_.withTimeout=function(a,b,c){var d=!1,e=setTimeout(function(){d=!0;a.expired&&a.expired(c)},a.maxTime);b(function(){d||(clearTimeout(e),c&&c.apply(this,arguments))})};_.sequence=function(a){var b=_.isArray(a)?a:_.asArray(arguments),c=b.length;return 0===c?_.identity:function(a){for(var e=0;e<c;e++)a=b[e].call(this,a);return a}};_.seq=_.sequence;
_.then=function(a,b){return function(c){return b.call(this,a.apply(this,arguments))}};_.asString=function(a){return a+""};_.typeOf=function(a){return typeof a};_.instanceOf=function(a){return function(b){return b instanceof a}};_.count=function(a){return a.length};_.array=_.tuple=function(){return _.asArray(arguments)};_.cons=function(a,b){return[a].concat(b||[])};_.atIndex=function(a){return function(b){return b[a]}};_.takesFirst=_.higherOrder(_.first);_.takesLast=_.higherOrder(_.last);
_.applies=function(a,b,c){return function(){return a.apply(b,c)}};_.prepends=function(a){return function(b){return a+b}};_.appends=function(a){return function(b){return b+a}};_.join=function(a,b){return a.join(b)};_.joinWith=_.flip2(_.join);_.joinsWith=_.higherOrder(_.joinWith);_.split=function(a,b){return a.split(b)};_.splitWith=_.flip2(_.split);_.splitsWith=_.higherOrder(_.splitWith);_.sum=function(a,b){return(a||0)+(b||0)};_.subtract=function(a,b){return(a||0)-(b||0)};
_.mul=function(a,b){return(a||0)*(b||0)};_.equal=function(a,b){return a===b};_.sums=_.plus=_.higherOrder(_.sum);_.subtracts=_.minus=_.higherOrder(_.subtract);_.muls=_.higherOrder(_.mul);_.equals=_.higherOrder(_.equal);_.less=function(a,b){return a<b};_.lessOrEqual=function(a,b){return a<=b};_.greater=function(a,b){return a>b};_.greaterOrEqual=function(a,b){return a>=b};_.isNegative=function(a){return 0>a};_.largest=function(a,b){return isNaN(a)&&isNaN(b)?NaN:isNaN(a)?b:isNaN(b)?a:Math.max(a,b)};
_.notZero=function(a){return 0!==a};_.propertyOf=function(a){return function(b){return a[b]}};_.oneOf=$restArg(function(){return _.propertyOf(_.index(_.asArray(arguments)))});_.isInstanceofSyntaxAvailable=function(){var a=Error();try{return a instanceof Error}catch(b){return!1}};_.isTypeOf_ES4=function(a,b){for(;b;){if(b.constructor===a)return!0;b=b.constructor.$base}return!1};_.isTypeOf_ES5=function(a,b){return b instanceof a};_.isTypeOf=_.isInstanceofSyntaxAvailable()?_.isTypeOf_ES5:_.isTypeOf_ES4;
_.isPrototypeInstance=function(a){return a&&a.constructor&&_.isPrototypeConstructor(a.constructor)};_.isPrototypeConstructor=function(a){return a&&void 0!==a.$definition||!1};_.coerceToNaN=function(a){return _.isFinite(a)?a:Number.NaN};_.coerceToArray=function(a){return void 0===a?[]:_.isArray(a)?a:[a]};_.coerceToFunction=function(a){return _.isFunction(a)?a:_.constant(a)};_.isArrayLike=function(a){return a instanceof Array||$platform.Browser&&a instanceof NodeList};
_.isArray=function(a){return a instanceof Array};_.mixin({matches:function(a){return 0===arguments.length&&_.constant(!0)||_.tails2(_.match,a)},match:function(a,b){return a===b||_.isArray(a)&&_.isArray(b)&&_.arrayMatch(a,b)||_.isObject(a)&&_.isObject(b)&&_.objectMatch(a,b)||_.isTypeOf(RegExp,b)&&_.isString(a)&&null!==a.match(b)},arrayMatch:function(a,b){return _.every(b,_.propertyOf(_.index(a)))},objectMatch:function(a,b){return _.reduce(_.pairs(b),function(b,d){return b&&_.match(a[d[0]],d[1])},!0)}});
_.extend(_,{isNonPOD:function(a){return a&&a.constructor&&a.constructor!==Object&&a.constructor!==Array&&a.constructor!==String&&a.constructor!==Number&&a.constructor!==Boolean},isPOD:function(a){return!_.isNonPOD(a)}});"undefined"===typeof Number.EPSILON&&Object.defineProperty(Number,"EPSILON",{enumerable:!0,get:_.constant(2.220446049250313E-16)});_.extend(_,{isDecimal:function(a,b){return!_.isNumber(a)||_.isNaN(a)?!1:Math.abs(Math.floor(a)-a)>(b||Number.EPSILON)}});
_.extend(_,{isEmpty:function(a){return void 0===_.coerceToUndefined(a)},isNonempty:function(a){return void 0!==_.coerceToUndefined(a)},isEmptyObject:function(a){return!_.isArray(a)&&!_.isFunction(a)&&_.isObject(a)&&0===_.keys(a).length},isStrictlyObject:function(a){return a&&"object"===typeof a?!0:!1},isEmptyArray:function(a){return _.isArray(a)&&0===a.length},isNonemptyString:function(a){return"string"===typeof a&&0<a.length},coerceToObject:function(a){return _.isStrictlyObject(a)?a:{}},coerceToEmpty:function(a){if(_.isArray(a))return[];
if(_.isStrictlyObject(a))return{}},coerceToUndefined:function(a){return void 0===a||null===a||a===Math.NaN||""===a||_.isPOD(a)&&(_.isEmptyObject(a)||0===a.length)?void 0:a}});_.hasStdlib=!0;_.throwsError=_.higherOrder(_.throwError=function(a){throw a instanceof Error?a:Error(a);});_.overrideThis=_.throwsError("override this");_.notImplemented=_.throwsError("not implemented");_.mixin({values2:function(a){return _.isArrayLike(a)?a:_.isStrictlyObject(a)?_.values(a):_.isEmpty(a)?[]:[a]}});
_.mixin({map2:function(a,b,c){return _.isArrayLike(a)?_.map(a,b,c):a instanceof Set?_.mapSet(a,b,c):_.isStrictlyObject(a)?_.mapObject(a,b,c):b.call(c,a)}});_.mapSet=function(a,b,c){var d=new Set;a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next())d.add(b.call(c,e.value));return d};_.mapsWith=_.higherOrder(_.mapWith=_.flip2(_.map2));_.mixin({scatter:function(a,b){var c=void 0;_.map2(a,function(a,e){b(a,e,function(a,b){2>arguments.length?(c=c||[]).push(a):(c=c||{})[b]=a})});return c}});
_.obj=function(a){var b=void 0;a(function(a,d){(b=b||{})[d]=a});return b};_.arr=function(a){var b=void 0;a(function(a){(b=b||[]).push(2>arguments.length?a:_.asArray(arguments))});return b};_.mapKeys=function(a,b){return _.isArrayLike(a)?_.map(a,_.tails2(_.mapKeys,b)):_.isStrictlyObject(a)?_.object(_.map(_.pairs(a),function(a){return[b(a[0]),_.mapKeys(a[1],b)]})):a};_.mapMap=_.hyperOperator(_.unary,_.map2);
_.hyperMap=function(a,b){return _.hyperOperator(_.unary,function(a,d){return b(a)||_.map2(a,d)})(a,_.identity)};_.reject2=function(a,b){return _.filter2(a,_.not(b))};_.filter2=function(a,b){if(_.isArrayLike(a)){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=b(f,d);!0===g?c.push(f):!1!==g&&c.push(g)}return c}if(_.isStrictlyObject(a))return c={},_.each(Object.keys(a),function(d){var e=a[d],f=b(e,d);!0===f?c[d]=e:!1!==f&&(c[d]=f)}),c;g=b(a);if(!0===g)return a;if(!1!==g)return g};
_.filterFilter=_.hyperOperator(_.unary,_.filter2);_.hyperFilter=function(a,b){return _.hyperOperator(_.unary,function(a,d){var e=b(a);return!0===e&&_.filter2(a,d)||e})(a,_.identity)};_.hyperReject=function(a,b){return _.hyperFilter(a,function(a){a=b(a);return _.isBoolean(a)?!a:a})};_.each2=function(a,b){if(_.isArrayLike(a))for(var c=0,d=a.length;c<d;c++)b(a[c],c,d);else if(_.isStrictlyObject(a))for(var e=Object.keys(a),f,c=0,d=e.length;c<d;c++)b(a[f=e[c]],f,d);else b(a,void 0,1)};
_.reduce2=function(a,b,c){var d=3>arguments.length,e=a,f=b,g=c;d&&(e=void 0,f=a,g=b);_.each2(f,function(a){e=d?a:g(e,a);d=!1});return e};_.reduceReduce=function(a,b,c){var d=a,e=b,f=c;3>arguments.length&&(d={},e=a,f=b);return _.hyperOperator(_.binary,_.reduce2,_.goDeeperAlwaysIfPossible)(d,e,f)};
_.concat=function(a,b){var c,d;1===arguments.length?(c=a[0],d=_.rest(a)):(c=a,d=_.rest(arguments));return _.isArrayLike(c)?c.concat.apply(c,d):_.reduce2(c,d,function(a,b){return _.isObject(a)&&_.isObject(b)?_.extend({},a,b):a+b})};
_.mixin({zipSetsWith:function(a,b){return _.reduce(_.rest(a),function(a,d){_.each(_.union(d&&Array.from(d.values())||[],a&&Array.from(a.values())||[]),function(e){var f=b(a&&a.has(e)?e:void 0,d&&d.has(e)?e:void 0);void 0===f?a["delete"](e):a.add(f)});return a},new Set(a[0]))},zipObjectsWith:function(a,b){return _.reduce(_.rest(a),function(a,d){_.each(_.union(_.keys(d),_.keys(a)),function(e){var f=b(a&&a[e],d&&d[e]);void 0===f?delete a[e]:a[e]=f});return a},_.clone(a[0]))},zip2:function(a,b){var c=
2===arguments.length?a:_.initial(arguments),d=2===arguments.length?b:_.last(arguments);return _.isArrayLike(c)&&0!==c.length?_.isArrayLike(c[0])?_.zipWith(c,d):c[0]instanceof Set?_.zipSetsWith(c,d):_.isStrictlyObject(c[0])?_.zipObjectsWith(c,d):_.reduce2(c,d):c}});_.mixin({zipZip:_.hyperOperator(_.binary,_.zip2)});_.extend=$restArg(_.extend);_.extended=$restArg(function(){return _.extend.apply(this,[{}].concat(_.asArray(arguments)))});_.extendWith=_.flip(_.extend);
_.extendsWith=_.flip(_.partial(_.partial,_.flip(_.extend)));_.extendedDeep=_.tails3(_.zipZip,function(a,b){return void 0===b?a:b});_.extend2=$restArg(function(a){return _.extend(a,_.reduceRight(arguments,function(a,c){return _.object(_.map(_.union(_.keys(c),_.keys(a)),function(d){var e=c[d];return[d,d in a?"object"===typeof e?_.extend(e,a[d]):a[d]:e]}))},{}))});
_.find2=function(a,b){if(_.isArrayLike(a))for(var c=0,d=a.length;c<d;c++){var e=b(a[c],c,a);if("boolean"!==typeof e)return e;if(!0===e)return a[c]}else if(_.isStrictlyObject(a))for(var c=0,f=Object.keys(a),d=f.length;c<d;c++){var g=f[c],e=b(a[g],g,a);if("boolean"!==typeof e)return e;if(!0===e)return a[g]}};
_.findFind=function(a,b){return _.hyperOperator(_.unary,function(a,d){if(_.isArrayLike(a))for(var e=0,f=a.length;e<f;e++){var g=d(a[e]);if("boolean"!==typeof g)return g;if(!0===g)return a[e]}else if(_.isStrictlyObject(a))for(var e=0,h=Object.keys(a),f=h.length;e<f;e++){var k=h[e],g=d(a[k]);if("boolean"!==typeof g)return g;if(!0===g)return a[k]}g=b(a);return"boolean"!==typeof g?g:!0===g?a:!1})(a,b)};_.nonempty=function(a){return _.filter2(a,_.isNonempty)};
_.extend(_,{clone:function(a){return a instanceof Set?new Set(a):_.isObject(a)?_.isArray(a)?a.slice():_.extend({},a):a},cloneDeep:_.tails2(_.mapMap,function(a){return _.isStrictlyObject(a)&&!_.isPrototypeInstance(a)?_.clone(a):a})});_.hyperMatch=_.hyperOperator(_.binary,function(a,b,c){return _.coerceToUndefined(_.nonempty(_.zip2(a,b,c)))});_.diff=_.tails3(_.hyperMatch,function(a,b){return $atom.unwrap(a)===$atom.unwrap(b)||a===$any||b===$any?void 0:b});
_.hyperMatch=_.hyperOperator(_.binary,function(a,b,c){return _.coerceToUndefined(_.zip2(a,b,c))});_.undiff=_.tails3(_.hyperMatch,function(a,b){return $atom.unwrap(a)===$atom.unwrap(b)||a===$any||b===$any?b:void 0});_.extend(_,{index:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}});_.quote=function(a,b){var c=b||"",d=Math.floor(c.length/2+c.length%2),e=c.slice(0,d),c=c.slice(d)||e;return e+a+c};_.quoteWith=_.flip2(_.quote);_.quotesWith=_.higherOrder(_.quoteWith);
_.partition2=function(a,b){return _.pluck(_.partition3(a,b),"items")};_.partition3=function(a,b){var c=[],d={label:void 0,items:[a.first]};_.each(a,function(a){var f=b(a);d.label!=f&&d.items.length?c.push(d={label:f,items:[a]}):d.items.push(a)});return d.length&&c.push(d),c};
(function(){var a=function(a){var c={};_.each(a,function(a,b){c[a]=c[a]||[];c[a].push(b)});return c};_.longestCommonSubstring=function(a,c){var d=_.indexOfLongestCommonSubstring(a,c);return d.length?a.substr(d.a,d.length):void 0};_.indexOfLongestCommonSubstring=function(b,c){var d={a:0,b:0,length:0},e=a(b),f=[];_.each(c,function(a,b){var c,l=[];_.each(e[a]||[],function(a){c=(a&&f[a-1]||0)+1;c>d.length&&(d.length=c,d.a=a-c+1,d.b=b-c+1);l[a]=c});f=l});return d}})();
_.key=function(a){return function(b,c){return a(c)}};_.filterKeys=function(a,b){return _.filter(a,function(a,d){return b(d)})};_.rejectKeys=function(a,b){return _.reject(a,function(a,d){return b(d)})};_.pickKeys=function(a,b){return _.pick(a,function(a,d){return b(d)})};_.omitKeys=function(a,b){return _.omit(a,function(a,d){return b(d)})};
_.extend(_,{defineProperty:function(a,b,c,d){if(_.isObject(a)&&a.hasOwnProperty(b))throw Error("_.defineProperty: targetObject already has property "+b);Object.defineProperty(a,b,_.extend({enumerable:!0},d,_.coerceToPropertyDefinition(c,b)))},defineHiddenProperty:function(a,b,c,d){return _.defineProperty(a,b,c,_.extend({enumerable:!1},d))},defineMemoizedProperty:function(a,b,c,d){c=_.coerceToPropertyDefinition(c,b);return _.defineProperty(a,b,_.extend({},c,{get:_.memoizeToThis("_"+b,c.get)}),d)},
defineProperties:function(a,b){_.each(b,_.defineProperty.partial(a).flip2)},memoizedState:function(a){return _.filter2(a,function(a,c){return"_"===c[0]&&!_.isFunction(a)})},memoizeToThis:function(a,b){return function(){var c=this[a];return void 0!==c?c:this[a]=b.call(this)}},coerceToPropertyDefinition:function(a,b){var c=a||{},d="undefined"===typeof Tags?a:Tags.unwrap(a);return!c.$constant&&!c.$get&&_.isPropertyDefinition(d)&&d||(c.$get||!c.$constant&&_.isFunction(d)&&_.noArgs(d))&&{get:d,set:_.throwsError("cannot change "+
(b||"property")+" (as it's an accessor function)")}||!c.$get&&{get:_.constant(d),set:_.throwsError("cannot change "+(b||"property")+" (as it's sealed to "+d+")")}||_.throwsError("coerceToPropertyDefinition: crazy input, unable to match")()},isPropertyDefinition:function(a){return _.isObject(a)&&(_.isFunction(a.get)||_.isFunction(a.set))},ownProperties:function(a){return a&&_.pickKeys(a,a.hasOwnProperty.bind(a))||{}}});_.hasTags=!0;
Tags=_.extend2(function(a,b){void 0!==a&&(this.subject=a);void 0!==b&&_.extend(this,b)},{$definition:{},prototype:{add:function(a,b){return this[_.keyword(a)]=b||!0,this},clone:function(a){return _.extend(new Tags(a||this.subject),_.pick(this,_.keyIsKeyword))},modify:function(a){this.subject=a(this.subject);return _.isTypeOf(Tags,this.subject)?_.extend(this.subject,_.pick(this,_.keyIsKeyword)):this},extend:function(a){return _.isTypeOf(Tags,a)?_.extend(this,_.pick(a,_.keyIsKeyword)):this}},omit:$restArg(function(a,
b){if(_.isTypeOf(Tags,a)){var c=_.index(_.rest(arguments)),d=_.pick(a,function(a,b){return _.isKeyword(b)&&!(b in c)});return _.isEmptyObject(d)?a.subject:new Tags(a.subject,d)}return a}),clone:function(a,b){return _.isTypeOf(Tags,a)?a.clone(b):b||a},extend:function(a,b){return _.isTypeOf(Tags,a)?a.clone().extend(b):_.isTypeOf(Tags,b)?Tags.wrap(a).extend(b):a},get:function(a){return _.isTypeOf(Tags,a)?_.pick(a,_.keyIsKeyword):{}},each:function(a,b){_.isTypeOf(Tags,a)&&_.each(a,function(a,d){"$"===
d[0]&&b(d.slice(1))})},hasSubject:function(a){return _.isTypeOf(Tags,a)&&"subject"in a},matches:function(a){return function(b){return b&&void 0!==b[_.keyword(a)]}},unwrapAll:function(a){return _.map2(a,Tags.unwrap)},unwrap:function(a){return _.isTypeOf(Tags,a)?a.subject:a},wrap:function(a){return _.isTypeOf(Tags,a)?a:0===arguments.length?new Tags:new Tags(a)},modify:function(a,b){return _.isTypeOf(Tags,a)?a.clone().modify(b):b(a)},map:function(a,b){return Tags.modify(a,function(a){return _.map2(a,
function(a,c){return Tags.modify(a,function(f){return b(f,c,_.isTypeOf(Tags,a)?a:void 0)})})})},add:function(a,b,c){return Tags.wrap.apply(null,_.rest(arguments,1)).add(a,c)}});_.keyword=function(a){return"$"+a};_.isKeyword=function(a){return"$"==a[0]};_.keywordName=function(a){return _.isKeyword(a)?a.slice(1):a};_.keywords=function(a){return _.pick(a,_.keyIsKeyword)};_.tagKeywords={};_.isTagKeyword=function(a){return _.keywordName(a)in _.tagKeywords};_.keyIsKeyword=function(a,b){return _.isKeyword(b[0])};
_.defineKeyword=function(a,b){_.defineProperty($global,_.keyword(a),b)};_.defineKeyword("untag",Tags.unwrap);
_.defineTagKeyword=function(a,b){b=_.isFunction(b)&&b||_.identity;_.keyword(a)in $global||(_.defineKeyword(a,Tags.add("constant",_.extendWith({matches:Tags.matches(a)},b(function(b,c){return 2>arguments.length?Tags.add(a,b):Tags.add(a,c,b)})))),_.tagKeywords[a]=!0);var c=_.keyword(a);return _.extend($global[c],{is:function(a){return _.isTypeOf(Tags,a)&&c in a||!1},isNot:function(a){return!(_.isTypeOf(Tags,a)&&c in a)||!1},unwrap:function(a){return!0===$atom.matches(a)?Tags.unwrap(a):a}})};
_(["constant","get","once","async"]).each(_.defineTagKeyword);_.defineModifierKeyword=function(a,b){_.defineKeyword(a,function(a){return Tags.modify(a,b)})};_.deleteKeyword=function(a){delete $global[_.keyword(a)]};_.hasTypeMatch=!0;_.defineTagKeyword("required");_.defineTagKeyword("atom");_.defineKeyword("any",_.identity);
(function(){_.isMeta=function(a){return a===$any||!0===$atom.is(a)||!0===$required.is(a)};var a=function(a,b,c){var d=Tags.unwrapAll(_.filter2(a,$required.matches));a=_.nonempty(_.zip2(Tags.unwrapAll(a),b,c));if(_.isEmpty(d))return a;c=_.nonempty(_.zip2(d,b,c));return _.values2(d).length===_.values2(c).length?a:_.coerceToEmpty(b)},b=_.hyperOperator(_.binary,function(b,c,d){var h=Tags.unwrap(b);if(_.isArray(h)){if(_.isArray(c))return a(_.times(c.length,_.constant(h[0])),c,d)}else if(_.isStrictlyObject(h)&&
h["*"]){if(_.isStrictlyObject(c))return a(_.extend(_.map2(c,_.constant(h["*"])),_.omit(h,"*")),c,d)}else return a(b,c,d)}),c=function(a,b){var c=Tags.unwrap(a);return c===$any||void 0===c&&void 0===b||_.isFunction(c)&&(_.isPrototypeConstructor(c)?_.isTypeOf(c,b):c(b))||typeof b===c||b===c};_.mismatches=function(a,c,d){return b(c,d,function(b,c){return a(b,c)?void 0:b})};_.omitMismatches=function(a,c,d){return b(c,d,function(b,c){return a(b,c)?c:void 0})};_.typeMismatches=_.partial(_.mismatches,c);
_.omitTypeMismatches=_.partial(_.omitMismatches,c);_.valueMismatches=_.partial(_.mismatches,function(a,b){return a===$any||b===$any||a===b});var d=function(a){if(_.isArray(a))return _.nonempty([_.reduce(_.rest(a),function(a,b){return _.undiff(a,b)},_.first(a)||void 0)]);if(_.isStrictlyObject(a)){var b=_.pairs(a),b=_.map(_.reduce(_.rest(b),function(a,b){return _.undiff(a,b)},_.first(b)||[void 0,void 0]),_.nonempty);return _.isEmpty(b)||_.isEmpty(b[1])?a:_.object([[b[0]||"*",b[1]]])}return a};_.decideType=
function(a){return _.hyperOperator(_.unary,function(a,b){return a&&a.constructor&&a.constructor.$definition?a.constructor:d(_.map2(a,b))})(a,function(a){return _.isPrototypeInstance(a)?a.constructor:_.isEmptyArray(a)?a:typeof a})}})();_.json=function(a){if("string"===typeof a)try{return JSON.parse(a)}catch(b){return{}}else return JSON.stringify(a)};_.alignStringsRight=function(a){var b=a.map(_.count),c=_.max(b);return[b,a].zip(function(a,b){return" ".repeats(c-a)+b})};
_.bullet=function(a,b){var c=" ".repeats(a.length);return _.joinWith("\n",_.splitWith("\n",b).map(function(b,e){return 0===e?a+b:c+b}))};_.stringifyOneLine=function(a,b){return _.stringify(a,_.extend(b||{},{pretty:!1}))};_.pretty=function(a,b){return _.stringify(a,_.extend(b||{},{pretty:!0}))};_.stringify=function(a,b){b=b||{};var c=_.stringifyImpl(a,[],[],0,b);return 80>c.length||"pretty"in b?c:_.pretty(a,b)};
_.stringifyPrototype=function(a){if($platform.NodeJS&&a.$meta){var b="";a.$meta(function(a){b=a.name});return b&&b+" ()"}return"<prototype>"};_.builtInTypes={Event:{target:$any},MutationEvent:{target:$any,attrName:$any,prevValue:$any},Range:{startContainer:$any,startOffset:$any,endContainer:$any,endOffset:$any},ClientRect:{left:$any,top:$any,right:$any,bottom:$any,width:$any,height:$any}};
_.stringifyImpl=function(a,b,c,d,e){var f=e.formatter&&e.formatter(a);if(f)return f;"undefined"!==typeof jQuery&&_.isTypeOf(jQuery,a)&&(a=_.asArray(a));if(a===$global)return"$global";if(0<=b.indexOf(a))return e.pure?void 0:"<cyclic>";if(0<=c.indexOf(a))return e.pure?void 0:"<ref:"+c.indexOf(a)+">";if(void 0===a)return"undefined";if(null===a)return"null";if(_.isFunction(a))return e.pure?a.toString():_.isPrototypeConstructor(a)&&_.stringifyPrototype(a)||"<function>";if("string"===typeof a)return _.quoteWith('"',
a.limitedTo(e.pure?Number.MAX_SAFE_INTEGER:60));if(_.isTypeOf(Tags,a))return _.reduce(Tags.get(a),function(a,d,e){return _.isBoolean(d)?e+" "+a.quote("()"):e+" ("+_.stringifyImpl(d,b,c,0,{pretty:!1})+", "+a+")"},_.stringifyImpl($untag(a),b,c,d+1,e));if(!e.pure&&_.hasOOP&&_.isPrototypeInstance(a)&&$prototype.defines(a.constructor,"toString"))return a.toString();if(!_.isObject(a)||"undefined"!==typeof $atom&&$atom.is(a))return _.isDecimal(a)&&0<e.precision?_.toFixed(a,e.precision):a+"";if(f=_.find2(_.builtInTypes,
function(b,c){return $global[c]&&a instanceof $global[c]&&c+" "+_.stringifyOneLine(_.omitTypeMismatches(b,a))||!1}))return f;a instanceof Set&&(a=a.items);var g=_.isArray(a),f=e.pretty||!1;if($platform.Browser){if(_.isTypeOf(Element,a))return(a.tagName.lowercase+(a.id&&"#"+a.id||"")+(a.className&&"."+a.className||"")).quote("<>");if(_.isTypeOf(Text,a))return"@"+a.wholeText.limitedTo(20)}if(a.toJSON)return _.quoteWith('"',a.toJSON());if(!e.pure&&(d>(e.maxDepth||5)||g&&a.length>(e.maxArrayLength||60)))return g?
"<array["+a.length+"]>":"<object>";var h=b.concat([a]);c.push(a);var k=_.pairs(a),l=_.stringifyImpl.tails2(h,c,d+1,e),n=e.json?'""':"";if(f){k=_.values(a);d=_.alignStringsRight(_.keys(a).map(_.quotesWith(n).then(_.appends(": "))));e=k.map(l);var f=e.map(function(a,b){return"["===a[0]||"{"===a[0]?3:_.isString(k[b])?1:0}),m=_.max(f);e=[f,e].zip(function(a,b){return" ".repeats(m-a)+b});d=g?e:[d,e].zip(_.bullet);d=_.bullet(g?"[ ":"{ ",d.join(",\n"));e=d.split("\n");return d+(" ".repeats(_.max(e.map(_.count))-
_.count(e.last))+(g?" ]":" }"))}return _.quoteWith(g?"[]":"{  }",_.joinWith(", ",_.map(k,function(a){return(g?"":a[0].quote(n)+": ")+l(a[1])})))};_.toFixed=function(a,b){return a&&a.toFixed&&a.toFixed(b)||void 0};_.toFixed2=function(a){return _.toFixed(a,2)};_.toFixed3=function(a){return _.toFixed(a,3)};
Array.prototype.squash=function(a){a=a||{};var b=a.key||_.identity,c={key:null,next:{},depth:{}},d={};_.each(this,function(a){for(var e=0,f=a.length,g=c,m;e<f;e++,g=m){m=a[e];var p=b(m);m=d[p]||(d[p]={key:p,item:m,next:{},depth:{}});g&&(g.next[p]=m,g.depth[p]=0)}});var e=function(a,b,c,d){d=d||0;a[b.key]=!0;b.next=_.filter2(_.values(b.next),function(c){if(c.key in a)return!1;c=e(a,c,b);d=Math.max(d,b.depth[c.key]);return c});c&&(c.depth[b.key]=Math.max(c.depth[b.key]||0,d+1));delete a[b.key];return b},
f=function(a,b){return a===b||_.some(a.next,function(a){return f(a,b)})},g=function(a){if(!a)return[];var b=(a.next||[]).sort(function(b,c){return(a.depth[b.key]||0)<(a.depth[c.key]||0)});return[a].concat(g(_.reduce(b,function(a,b){if(a===b)return a;if(f(b,a))return b.next.push(a),b;a.next.push(b);return a})))};return _.rest(_.pluck(g(e({},c)),"item"))};DAG=function(a){this.cfg=a||{};this.nodes=a.nodes||_.noop};
DAG.prototype.each=function(a,b,c,d){d=d||new Set;if(!d.has(a)){d.add(a);var e=this,f=this.nodes(a)||[];!0!==b.call(this,a,{nodes:f,prev:c,visited:d})&&f.forEach(function(c){e.each(c,b,a,d)})}return d};DAG.prototype.edges=function(a){var b=[];this.each(a,function(a,d){d.nodes.concat(a).reduce(function(a,c){b.push([a,c]);return c})});return b};DAG.prototype.squash=function(a){return this.edges(a).squash(this.cfg).remove(a)};DAG.squash=function(a,b){return(new DAG(b)).squash(a)};
_.cps=function(){return _.cps.sequence.apply(null,arguments)};_.cps.apply=function(a,b,c,d){c=_.asArray(c);var e=_.numArgs(a)-1,f=c[e];c[e]=function(){d.call(this,arguments,f)};return a.apply(b,c)};_.extend(_.cps,{each:function(a,b,c,d,e,f){var g=arguments.callee,h=d||0,k=0===h?void 0===a.length?_.keys(a):void 0:f,l=0===h?k?k.length:a.length:e,n=2!==_.numArgs(b);if(!a||h>=(l||0))c&&c();else{var m=k?k[h]:h,p=function(){g(a,b,c,h+1,l,k)};n?b(a[m],m,p,c,a):b(a[m],p,c,a)}}});
_.extend(_.cps,{map:function(a,b,c){var d=_.isArray(a)?[]:{};_.cps.each(a,2==_.numArgs(b)?function(a,c,g){b(a,function(a){d[c]=a;g()})}:function(a,c,g){b(a,c,function(a){d[c]=a;g()})},function(){c(d)})}});_.extend(_.cps,{find:function(a,b,c){var d=2!==_.numArgs(b);_.cps.each(a,function(a,c,g,h){var k=function(b){!1===b?g():h(!0===b?a:b,c)};d?b(a,c,k):b(a,k)},c)}});
_.extend(_.cps,{memoize:function(a){return _.barrier?_.cps._betterMemoize(a):_.cps._poorMemoize(a)},_poorMemoize:function(a){var b={};return function(c,d){c in b?d(b[c]):a.call(this,c,function(a){d(b[c]=a)})}},_betterMemoize:function(a){var b={};switch(_.numArgs(a)){case 1:return function(c){b.already||a.call(this,b=_.barrier());b(c)};case 2:return b={},function(c,d){c in b||a.call(this,c,b[c]=_.barrier());b[c](d)};default:throw Error("_.cps.memoize: unsupported number of arguments");}}});
(function(){var a=function(b,c,d,e,f){!b||f>=(b.length||0)?d(e):c(e,b[f],function(e){a(b,c,d,e,f+1)})};_.cps.reduce=function(b,c,d,e){4>arguments.length?a(b,c,d,b[0],1):a(b,c,d,e,0)}})();_.extend(_.cps,{noop:$restArg(function(){return _.last(arguments).call(this)}),identity:$restArg(function(){var a=_.initial(arguments),b=_.last(arguments);if(b)return b.apply(this,a)}),constant:$restArg(function(){var a=arguments;return function(){return _.last(arguments).apply(this,a)}})});
_.cps.arity0=function(a){return function(){a.call(this,_.last(arguments))}};_.cps.arity1=function(a){return function(){a.call(this,arguments[0],_.last(arguments))}};_.cps.arity2=function(a){return function(){a.call(this,arguments[0],arguments[1],_.last(arguments))}};_.cps.transformResult=function(a,b){return function(c){b.apply(this,_.initial(arguments).concat(a(_.last(arguments))))}};_.cps.resultArity2=_.partial(_.cps.transformResult,_.arity2);_.cps.resultArity1=_.partial(_.cps.transformResult,_.arity1);
_.cps.resultArity0=_.partial(_.cps.transformResult,_.arity0);_.cps.sequence=$restArg(function(a){var b=_.isArray(a)&&a||_.asArray(arguments);return _.reduceRight(b,function(a,b){return function(){return b.apply(this,_.asArray(arguments).concat(a))}},_.cps.identity)});_.cps.compose=$restArg(function(a){var b=_.isArray(a)&&a||_.asArray(arguments);return _.cps.sequence(b.slice().reverse())});
_.cps.trySequence=function(a,b,c){_.reduceRight(a,function(a,e){return function(f){if(_.isTypeOf(Error,f))return(c||b)(f);try{return e.apply(this,_.asArray(arguments).concat(a))}catch(g){return(c||b)(g)}}},b)()};_(["method","property","flipped","forceOverride"]).each(_.defineTagKeyword);
$extensionMethods=function(a,b){_.each(b,function(b,d){var e=Tags.unwrap(b);d in _||(_[d]=_[d]||e);if(b.$method||!b.$property&&!_.oneArg(e)){if(b.$property)throw Error("$extensionMethods: crazy input, unable to match");d in a.prototype&&!b.$forceOverride||(a.prototype[d]=_.asMethod(b.$flipped?_.flip(e):e))}else d in a.prototype&&!b.$forceOverride||_.defineHiddenProperty(a.prototype,d,function(){return e(this)})})};
$extensionMethods(Function,{$:$method(_.partial),$$:$method(_.tails),bind:_.bind,partial:_.partial,calls:_.bind,tails:_.tails,tails2:_.tails2,tails3:_.tails3,applies:_.applies,compose:_.compose,then:_.then,flip:_.flip,"with":_.flipN,flip2:_.flip2,flip3:_.flip3,asFreeFunction:_.asFreeFunction,asMethod:_.asMethod,callsWith:_.callsTo,tailsWith:_.tailsTo,higherOrder:_.higherOrder,returns:function(a,b){return function(){a.apply(this,arguments);return b}},asContinuation:function(a){return $restArg(function(){_.last(arguments)(a.apply(this,
_.initial(arguments)))})},wraps:function(a,b){a._wrapped=_.withSameArgs(a,b);return a},wrapped:function(a){return a._wrapped||a},original:function(a){for(;a&&a._wrapped;)a=a._wrapped;return a},arity0:_.arity0,arity1:_.arity1,arity2:_.arity2,arity3:_.arity3,or:_.or,and:_.and,not:_.not,new_:_.new_,each:function(a,b){return _.each2(b,a)},map:function(a,b){return _.map2(b,a)},oneShot:function(a){var b=!1;return function(){if(!b)return b=!0,a.apply(this,arguments)}},memoized:_.memoize,throttled:_.throttle,
debounced:function(a,b,c){var d,e,f,g,h,k=function(){var l=Date.now()-d;l<b&&0<l?e=setTimeout(k,b-l):(e=null,c||(f=a.apply(h,g),e||(h=g=null)))},l=function(){h=this;g=arguments;d=Date.now();var l=c&&!e;e||(e=setTimeout(k,b));l&&(f=a.apply(h,g),h=g=null);return f};l.cancel=function(){e&&(clearTimeout(e),e=null)};l.callImmediately=function(){l.cancel();a.apply(h,g)};return l},postpone:$method(function(a){a.postponed.apply(null,arguments)}),postponed:function(a){return function(){var b=arguments,c=this;
a._postponed||(a._postponed=!0,_.delay(function(){a._postponed=!1;a.apply(c,b)}))}},delay:_.delay,delayed:function(a,b){return function(){var c=arguments,d=this;_.delay(function(){a.apply(d,c)},b)}}});
$extensionMethods(Function,{catch_:function(a,b,c,d){return a.catches(b,c)()},catches:function(a,b,c,d){var e=arguments.length;b=1<e?_.coerceToFunction(b):_.identity;c=2<e?_.coerceToFunction(c):_.identity;d=3<e?_.coerceToFunction(d):_.identity;return function(){var e=void 0,g=!1;try{e=a.apply(this,arguments)}catch(h){e=b(h),g=!0}g||(e=c(e));return d(e)}}});
$extensionMethods(Array,{each:_.each,map:_.map,fold:_.reduce2,reduce:_.reduce,reduceRight:_.reduceRight,zip:_.zipWith,groupBy:_.groupBy,indexBy:_.indexBy,filter:_.filter,flat:_.flatten.tails2(!0),object:_.object,shuffle:_.shuffle,pluck:$method(_.pluck),join:function(a){return $forceOverride(function(b,c){c=2>arguments.length?"":c;return _.isString(c)?a.call(b,c):_.reduce2(b,function(a,b){return[a].concat([c,b])})})}(Array.prototype.join),contains:function(a,b){return 0<=a.indexOf(b)},top:function(a){return a[a.length-
1]},first:function(a){return a[0]},rest:function(a){return _.rest(a)},last:function(a){return a[a.length-1]},take:function(a,b){return a.slice(0,b)},lastN:$method(_.last),before:function(a,b){var c=a.indexOf(b);return 0>c?a:a.slice(0,c-1)},after:function(a,b){var c=a.indexOf(b);return 0>c?a:a.slice(c+1)},isEmpty:function(a){return 0===a.length},notEmpty:function(a){return 0<a.length},lastIndex:function(a){return a.length-1},random:function(a){return a[_.random(0,a.lastIndex)]},copy:function(a){return a.slice(0)},
removeAll:$method(function(a){return a.splice(0,a.length),a}),remove:function(a,b){for(var c;-1!==(c=a.indexOf(b));)a.splice(c,1);return a},removeAt:function(a,b){a.splice(b,1);return a},insertAt:function(a,b,c){a.splice(c,0,b);return a},itemAtWrappedIndex:function(a,b){return a[b%a.length]},reversed:function(a){return a.slice().reverse()},swap:$method(function(a,b,c){var d=a[b];a[b]=a[c];a[c]=d;return a})});
_.zap=function(a){var b=_.last(arguments);return _.reduce(_.rest(_.initial(arguments)),function(a,d){return _.times(Math.max(a.length,d.length),function(e){return b(a[e],d[e])})},a)};
$extensionMethods(String,{quote:_.quote,contains:function(a,b){return 0<=a.indexOf(b)},startsWith:function(a,b){return 1===b.length?a[0]===b:a.substring(0,b.length)===b},endsWith:function(a,b){return 1===b.length?a[a.length-1]===b:a.substring(a.length-b.length)===b},pad:function(a,b,c){return a+(c||" ").repeats(Math.max(0,b-a.length))},cut:function(a,b){return a.substring(0,b-1)+a.substring(b,a.length)},insert:function(a,b,c){return a.substring(0,b)+c+a.substring(b,a.length)},lowercase:function(a){return a.toLowerCase()},
uppercase:function(a){return a.toUpperCase()},trimmed:function(a){return a.trim()},limitedTo:function(a,b){return a&&(a.length<=b?a:a.substr(0,b-1)+"\u2026")},escaped:function(a){return _.escape(a)},repeats:function(a,b){return _.times(b,_.constant(a)).join("")},prepend:function(a,b){return b+a},append:function(a,b){return a+b},first:function(a,b){return _.first(a,b).join("")},last:function(a,b){return _.last(a,b).join("")},reversed:function(a){return a.split("").reverse().join("")},capitalized:function(a){return a.charAt(0).toUpperCase()+
a.slice(1)},decapitalized:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},latinAlphanumericValue:function(a){return a.replace(/[^a-z0-9]/gi,"")},alphanumericValue:function(a){return a.replace(unicode_hack(/[^0-9\p{L}|^0-9\p{N}|^0-9\p{Pc}|^0-9\p{M}]/g),"")},numericValue:function(a){return a.replace(/[^0-9]/g,"")},integerValue:function(a){return a.numericValue.parsedInt},parsedInt:function(a){a=parseInt(a,10);return _.isFinite(a)?a:void 0},bytes:function(a){for(var b=new Uint8Array(a.length),
c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b},hash:function(a){var b=0,c,d,e;if(0===a.length)return b;c=0;for(e=a.length;c<e;c++)d=a.charCodeAt(c),b=(b<<5)-b+d,b|=0;return b},transliterate:function(){var a=_.extend({"\u0430":"a","\u0431":"b","\u0432":"v","\u0433":"g","\u0434":"d","\u0435":"e","\u0451":"yo","\u0436":"zh","\u0437":"z","\u0438":"i","\u0439":"y","\u043a":"k","\u043b":"l","\u043c":"m","\u043d":"n","\u043e":"o","\u043f":"p","\u0440":"r","\u0441":"s","\u0442":"t","\u0443":"u","\u0444":"ph",
"\u0445":"h","\u0446":"ts","\u0447":"ch","\u0448":"sh","\u0449":"sch","\u044c":"","\u044a":"","\u044b":"y","\u044d":"e","\u044e":"yu","\u044f":"ya"},_.object(_.map("_-1234567890qwertyuiopasdfghjklzxcvbnm",function(a){return[a,a]})));return function(b){var c="";b=(b||"").toLowerCase();for(var d=0,e=b.length;d<e;d++)c+=a[b[d]]||"";return c}}()});
_.extend(String,{randomHex:function(a){for(var b="",c=0;c<a;c++)b+=Math.floor(16*Math.random()).toString(16);return b},leadingZero:function(a){return 10>a?"0"+a:a.toString()}});_.camelCaseToDashes=function(a){return a.replace(/[a-z][A-Z]/g,function(a){return a[0]+"-"+a[1].lowercase})};_.camelCaseToLoDashes=function(a){return a.replace(/[a-z][A-Z]/g,function(a){return a[0]+"_"+a[1].lowercase})};_.dashesToCamelCase=function(a){return a.replace(/(-.)/g,function(a){return a[1].uppercase})};
_.loDashesToCamelCase=function(a){return a.replace(/(_.)/g,function(a){return a[1].uppercase})};
(function(){var a=["onceBefore","onceAfter","onBefore","onAfter","intercept"],b=function(b,d){if("function"!==typeof b)throw Error("method should be a function");return _.extend({},b,{_bindable:!0,impl:b,_wrapped:b,context:d,off:function(b){_.each(a,function(a){b?this["_"+a].remove(b):this["_"+a].removeAll()},this);return this}},_.object(_.map(a,function(a){var b="_"+a,c=0<=a.indexOf("once");return[a,function(a){if(!_.isBindable(this))throw Error("wrong this");var d=this[b];(!c||0>d.indexOf(a))&&
this[b].push(a);return this}]})),_.object(_.map(a,function(a){return["_"+a,[]]})))};_.extend(_,_.mapObject(_.invert(a),function(a){return function(b,e,f){var g=b[e];b=_.isBindable(g)?g:b[e]=_.bindable(g);return b[a].call(b,f)}}.flip2),{unbind:function(a,b,e){(a=a[b])&&a.off&&a.off(e)},isBindable:function(a){return a&&a._bindable?!0:!1},bindable:_.extendWith({hooks:a,hooksShort:["onceBefore","onceAfter","before","after","intercept"]},function(a,d){return _.withSameArgs(a,_.extendWith(b(a,d),function(){var b=
arguments.callee,f=b._onceBefore,g=b._onceAfter,h=b._onBefore,k=b._onAfter,l=b._intercept,b=d||this,n,m;if(f.length){n=0;for(m=f.length;n<m;n++)f[n].apply(b,arguments);f.removeAll()}n=0;for(m=h.length;n<m;n++)h[n].apply(b,arguments);f=(l.length?_.cps.compose([a].concat(l)):a).apply(b,arguments);if(k.length||g.length){h=_.asArray(arguments).concat(f);n=0;for(m=k.length;n<m;n++)k[n].apply(b,h);if(g.length)for(k=g.copy,g.removeAll(),n=0,m=k.length;n<m;n++)k[n].apply(b,h)}return f}))})})})();
_.extend(_,{gatherChanges:function(a){var b=_.isArray(a)?a:_.initial(arguments),c=_.last(arguments),d=function(a){c.apply(this,_.pluck(b,"value"))};_.each(b,function(a){a(d)})},allTriggered:function(a,b){var c=[];0<a.length?_.each(a,function(d){d(function(){c=_.union(c,[d]);b&&c.length===a.length&&(b(),b=void 0)})}):b()},observableRef:function(a){return _.extend(_.observable.apply(this,arguments),{trackReference:!0})},observable:function(a){var b=_.stream({hasValue:0<arguments.length,value:_.isFunction(a)?
void 0:a,read:_.identity,read:function(a){return function(d){b.hasValue&&d.call(this,b.value);a.call(this,d)}},write:function(a){return function(d){b.beforeWrite&&(d=b.beforeWrite(d));if(!b.hasValue||(b.trackReference?b.value!==d:!_.isEqual(b.value,d))){var e=b.value,f=b.hasValue;b.hasValue=!0;b.value=d;f?a.call(this,!1,b.value,e):a.call(this,!1,b.value)}}}});arguments.length&&b.apply(this,arguments);return _.extend(b,{force:function(a){b.hasValue=!1;b(a||b.value)},when:function(a,d){var e=_.isFunction(a)?
a:_.equals(a);b(function(a){e(a)&&(b.off(arguments.callee),d.apply(this,arguments))})}})},barrier:function(a){var b=void 0;_.isFunction(a)&&(b=a,a=void 0);var c=_.stream({already:void 0!==a,value:a,reset:function(){c.already=!1;delete c.value},write:function(a){return function(b){c.already||(c.already=!0,c.value=b);a.call(this,!0,c.value)}},read:function(a){return function(b){c.already?(c.postpones||c.commitingReads?b.postponed:b).call(this,c.value):a.call(this,b)}}});b&&c(b);return c},triggerOnce:$restArg(function(){var a=
_.stream({read:function(b){return function(c){0>a.queue.indexOf(c)&&b.call(this,c)}},write:function(a){return a.partial(!0)}}).apply(this,arguments);return a}),trigger:$restArg(function(){return _.stream({read:_.identity,write:function(a){return a.partial(!1)}}).apply(this,arguments)}),off:function(a,b){a.queue&&(1===arguments.length?a.queue.off():a.queue.off(b));a.queuedBy&&(_.each(a.queuedBy,function(b){b.remove(a)}),delete a.queuedBy)},stream:function(a){a=a||{};var b=_.extend([],{off:function(a){this.length&&
(0===arguments.length?(_.each(this,function(a){a.queuedBy.remove(this)},this),this.removeAll()):a.queuedBy&&(a.queuedBy.remove(this),this.remove(a)))}}),c=void 0,d=a.write(function(a,d){var e=_.rest(arguments),k=c.context||this,l=b.copy;a&&b.off();c.commitingReads=!0;for(var n=0,m=l.length;n<m;n++)(c.postpones?l[n].postponed:l[n]).apply(k,e);delete c.commitingReads}),e=a.read(function(a){0>b.indexOf(a)&&(a.queuedBy?a.queuedBy.push(b):a.queuedBy=[b],b.push(a))});return c=_.extend($restArg(function(a){_.isFunction(a)?
e.call(this,a):d.apply(this,arguments);return arguments.callee}),a,{queue:b,once:function(a){_.find(b,function(b){return b.onceWrapped_===a})||e(_.extend(function(b){_.off(c,arguments.callee);a(b)},{onceWrapped_:a}))},off:_.off.asMethod,read:e,write:d,postpone:function(){this.postponed.apply(c.context,arguments)}})}});_.hasOOP=!0;_("property static final alias memoized private builtin hidden testArguments".split(" ")).each(_.defineTagKeyword);
$prototype=function(a,b){return $prototype.impl.compile.apply($prototype.impl,1<arguments.length?_.asArray(arguments).reverse():arguments)};$extends=function(a,b){return $prototype(a,b||{})};$mixin=function(a,b){return $prototype.impl.compileMixin(_.extend(b,{constructor:a}))};
_.extend($prototype,{isConstructor:function(a){return _.isPrototypeConstructor(a)},macro:function(a,b){1===arguments.length?$prototype.impl.alwaysTriggeredMacros.push(a):$prototype.impl.memberNameTriggeredMacros[a]=b},macroTag:function(a,b){_.defineTagKeyword(a);$prototype.impl.tagTriggeredMacros[_.keyword(a)]=b},each:function(a){var b=$global,c;for(c in b)if(!_.isKeyword(c)){var d=b[c];$prototype.isConstructor(d)&&a(d,c)}},defines:function(a,b){return _.find($prototype.inheritanceChain(a),function(a){return a.$definition&&
a.$definition.hasOwnProperty(b)||!1})?!0:!1},inheritanceChain:function(a){for(var b=[];a;)b.push(a),a=a.$base&&a.$base.constructor;return b},wrapMethods:function(a,b){return Tags.map(a,function(a,d,e){return _.isFunction(a)?b(a,d,e).wraps(a):a})},impl:{alwaysTriggeredMacros:[],memberNameTriggeredMacros:{},tagTriggeredMacros:{},compile:function(a,b){var c=b&&b.$impl||this;return $untag(c.sequence(a,b).call(c,a||{}).constructor)},sequence:function(a,b){return _.sequence(this.extendWithTags,this.flatten,
this.generateCustomCompilerImpl(b),this.generateArgumentContractsIfNeeded,this.ensureFinalContracts(b),this.generateConstructor(b),this.evalAlwaysTriggeredMacros(b),this.evalMemberTriggeredMacros(b),this.contributeTraits(b),this.evalPrototypeSpecificMacros(b),this.generateBuiltInMembers(b),this.callStaticConstructor,this.expandAliases,this.groupMembersByTagForFastEnumeration,this.defineStaticMembers,this.defineInstanceMembers)},compileMixin:function(a){return _.sequence(this.flatten,this.contributeTraits(),
this.expandAliases,this.evalMemberTriggeredMacros(),this.defineStaticMembers,this.defineInstanceMembers).call(this,a||{}).constructor},flatten:function(a){var b=_.pick(a,this.isTagKeywordGroup),b=_.object(_.flatten(_.map(b,function(a,b){return _.map(this.flatten(a),function(a,c){return[c,$global[b](a)]})},this),!0));a=_.omit(a,this.isTagKeywordGroup);return _.extend(a,b)},evalAlwaysTriggeredMacros:function(a){return function(b){for(var c=$prototype.impl.alwaysTriggeredMacros,d=0,e=c.length;d<e;d++)b=
c[d](b,a)||b;return b}},evalMemberTriggeredMacros:function(a){return function(b){var c=$prototype.impl.memberNameTriggeredMacros,d=$prototype.impl.tagTriggeredMacros;_.each(b,function(e,f){c.hasOwnProperty(f)&&(b=c[f](b,e,f,a)||b);_.each(_.keys(e),function(c){d.hasOwnProperty(c)&&(b=d[c](b,e,f,a)||b)})});return b}},evalPrototypeSpecificMacros:function(a){return function(b){if(!b.isTraitOf){var c=$untag(b.$macroTags||a&&a.$definition&&a.$definition.$macroTags);c&&this.applyMacroTags(c,b)}return b}},
applyMacroTags:function(a,b){_.each(b,function(c,d){_.each(a,function(a,f){c=b[d];_.keyword(f)in c&&(b[d]=a.call(b,b,c,d)||c)},this)},this);return b},generateCustomCompilerImpl:function(a){return function(b){b.$impl?(b.$impl=_.extend(Object.create(a&&a.$impl||this),b.$impl),b.$impl=$static($builtin($property(b.$impl)))):a&&a.$impl&&(b.$impl=$static($builtin($property(a.$impl))));return b}},generateArgumentContractsIfNeeded:function(a){return a.$testArguments?$prototype.wrapMethods(a,function(a,c){return function(){var d=
_.asArray(arguments);$assertArguments(d.copy,a.original,c);return a.apply(this,d)}}):a},contributeTraits:function(a){return function(b){if(b.$traits){var c=b.$traits;this.mergeTraitsMembers(b,c,a);b.$traits=$static($builtin($property(c)));b.hasTrait=$static($builtin(function(a){return 0<=c.indexOf(a)}))}return b}},mergeTraitsMembers:function(a,b,c){_.each(b,function(b){_.defaults(a,_.omit(b.$definition,_.or($builtin.matches,_.key(_.equals("constructor")))))})},extendWithTags:function(a){return _.extendWith($untag(a),
_.mapObject(Tags.get(a),$static.arity1))},callStaticConstructor:function(a){a.isTraitOf||(_.each($untag(a.$traits),function(b){b.$definition.$constructor&&$untag(b.$definition.$constructor).call(a)}),a.$constructor&&$untag(a.$constructor).call(a));return a},generateConstructor:function(a){return function(b){return _.extend(b,{constructor:Tags.modify(b.hasOwnProperty("constructor")?b.constructor:this.defaultConstructor(a),function(b){a&&(b.prototype=Object.create(a.prototype),b.prototype.constructor=
b);return b})})}},generateBuiltInMembers:function(a){return function(b){b.$constructor&&(b.$constructor=$builtin($static(b.$constructor)));return _.defaults(b,{$base:$builtin($static($property(_.constant(a&&a.prototype)))),$definition:$builtin($static($property(_.constant(_.extend({},a&&a.$definition,b))))),isTypeOf:$builtin($static(_.partial(_.isTypeOf,$untag(b.constructor)))),isInstanceOf:$builtin(function(a){return _.isTypeOf(a,this)}),$:$builtin($prototype.impl.$)})}},$:function(a){return _.$.apply(null,
[this].concat(_.asArray(arguments)))},defaultConstructor:function(a){return a?function(){a.prototype.constructor.apply(this,arguments)}:function(a){_.extend(this,a||{})}},defineStaticMembers:function(a){this.defineMembers($untag(a.constructor),_.pick(a,$static.matches));return a},defineInstanceMembers:function(a){this.defineMembers($untag(a.constructor).prototype,_.omit(a,$static.matches));return a},defineMembers:function(a,b){_.each(b,function(c,d){"constructor"!==d&&b.hasOwnProperty(d)&&this.defineMember(a,
c,d)},this)},defineMember:function(a,b,c){b&&b.$property?b.$memoized?_.defineMemoizedProperty(a,c,b):_.defineProperty(a,c,b,b.$hidden?{enumerable:!1}:{}):(b=$untag(b),a[c]=b)},ensureFinalContracts:function(a){return function(b){if(a){if(a.$final)throw Error("Cannot derive from $final-marked prototype");if(a.$definition){var c=_.intersection(_.keys(_.pick(a.$definition,$final.matches)),_.keys(b));if(c.length)throw Error("Cannot override $final "+c.join(", "));}}return b}},expandAliases:function(a){_.each(a,
function(b,c){a[c]=this.resolveMember(a,c,b)[1]},this);return a},resolveMember:function(a,b,c){c=c||a[b];if($alias.is(c)){a=this.resolveMember(a,$untag(c));var d=a[0];a=a[1];return[d,$property.is(c)?$property({get:function(){return this[d]},set:function(a){this[d]=a}}):Tags.extend(a,Tags.omit(c,"$alias"))]}return[b,c]},groupMembersByTagForFastEnumeration:function(a){var b={};_.each(a,function(a,d){Tags.each(a,function(e){(b[e]=b[e]||{})[d]=a})});a.$membersByTag=$static($builtin($property(b)));return a},
isTagKeywordGroup:function(a,b){var c=$untag(a);return _.isKeyword(b)&&_.isFunction($global[b])&&"object"===typeof c&&!_.isArray(c)},modifyMember:function(a,b){return $property.is(a)&&Tags.modify(a,function(a){return _.extend(a,_.map2(_.pick(a,"get","set"),b))})||_.isFunction($untag(a))&&Tags.modify(a,b)||a}}});_.isTraitOf=function(a,b){var c=b&&b.constructor;return c&&c.hasTrait&&c.hasTrait(a)||!1};_.isTypeOf=_.or(_.isTypeOf,_.isTraitOf);
$trait=function(a,b){var c=void 0,d=_.extend(1<arguments.length?b:a,{constructor:_.throwsError("Traits are not instantiable (what for?)"),isTraitOf:$static($builtin(function(a){return _.isTraitOf(c,a)}))});return c=$prototype.impl.compile(d,1<arguments.length?a:b)};$prototype.macro("$macroTags",function(a,b,c){_.each($untag(b),function(a,b){_.defineTagKeyword(b)})});
_.$=function(a,b){return _.rest(arguments,2).length?_.bind.apply(void 0,[b,a].concat(_.rest(arguments,2))):_.withSameArgs(b,function(){return b.apply(a,arguments)})};"undefined"!==typeof jQuery&&jQuery.fn.extend({$:function(){return _.$.apply(null,[this].concat(_.asArray(arguments)))}});_.defineKeyword("const",function(a){return $static($property(a))});_.defineTagKeyword("callableAsFreeFunction");
$prototype.macroTag("callableAsFreeFunction",function(a,b,c){a.constructor[c]=$untag(b).asFreeFunction;return a});_.defineTagKeyword("callableAsMethod");$prototype.macroTag("callableAsMethod",function(a,b,c){a[c]=Tags.modify(b,_.asMethod);a.constructor[c]=$untag(b);return a});$singleton=function(a,b){return new ($prototype.apply(null,arguments))};_.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};_.lerp=function(a,b,c){return b+(c-b)*a};
_.rescale=function(a,b,c,d){a=(a-b[0])/(b[1]-b[0]);return _.lerp(d&&d.clamp?_.clamp(a,0,1):a,c[0],c[1])};_.rescaleClamped=function(a,b,c){return _.rescale(a,b,c,{clamp:!0})};_.sqr=function(a){return a*a};Math.sign||(Math.sign=function(a){return 0>a?-1:0<a?1:0});
Intersect={rayCircle:function(a,b,c,d){var e=a.sub(c);c=b.dot(b);var f=2*e.dot(b);d=e.dot(e)-d*d;e=f*f-4*c*d;if(!(0>e)){e=Math.sqrt(e);d=(-f-e)/(2*c);c=(-f+e)/(2*c);if(0<=d&&1>=d)return{time:d,where:a.add(b.scale(d))};if(0<=c&&1>=c)return{time:c,where:a.add(b.scale(c)),insideOut:!0}}}};
Vec2=$prototype({$static:{xx:function(a){return new Vec2(a,a)},xy:function(a,b){return new Vec2(a,b)},x:function(a){return new Vec2(a,0)},y:function(a){return new Vec2(0,a)},zero:$property(function(){return new Vec2(0,0)}),unit:$property(function(){return new Vec2(1,1)}),one:$alias("unit"),lt:$alias("fromLT"),wh:$alias("fromWH"),fromLT:function(a){return a&&new Vec2(a.left,a.top)},fromWH:function(a){return a&&new Vec2(a.width,a.height)},fromLeftTop:$alias("fromLT"),fromWidthHeight:$alias("fromWH"),
lerp:function(a,b,c){return new Vec2(_.lerp(a,b.x,c.x),_.lerp(a,b.y,c.y))},clamp:function(a,b,c){return new Vec2(_.clamp(a.x,b.x,c.x),_.clamp(a.y,b.y,c.y))}},constructor:function(a,b){1===arguments.length?_.isNumber(a)?this.x=this.y=a:(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)},w:$alias($property("x")),h:$alias($property("y")),length:$property(function(){return Math.sqrt(this.lengthSquared)}),lengthSquared:$property(function(){return this.x*this.x+this.y*this.y}),distance:function(a){return this.sub(a).length},
aspect:$property(function(){return this.x/this.y}),add:function(a,b){return void 0===b?"number"===typeof a?new Vec2(this.x+a,this.y+a):new Vec2(this.x+a.x,this.y+a.y):new Vec2(this.x+a,this.y+b)},aspect:$property(function(){return this.w/this.h}),dot:function(a){return this.x*a.x+this.y*a.y},sub:function(a){return new Vec2(this.x-a.x,this.y-a.y)},scale:function(a,b){return new Vec2(this.x*a,this.y*(void 0===b?a:b))},mul:function(a){return new Vec2(this.x*a.x,this.y*a.y)},divide:function(a){return new Vec2(this.x/
a.x,this.y/a.y)},normal:$property(function(){return this.scale(1/this.length)}),perp:$property(function(){return new Vec2(this.y,-this.x)}),half:$property(function(){return new Vec2(.5*this.x,.5*this.y)}),inverse:$property(function(){return new Vec2(-this.x,-this.y)}),asArray:$property(function(){return[this.x,this.y]}),asLeftTop:$property(function(){return{left:this.x,top:this.y}}),asLeftTopMargin:$property(function(){return{marginLeft:this.x,marginTop:this.y}}),asWidthHeight:$property(function(){return{width:this.x,
height:this.y}}),asTranslate:$property(function(){return"translate("+this.x+" "+this.y+")"}),separatedWith:function(a){return this.x+a+this.y},floor:$property(function(){return new Vec2(Math.floor(this.x),Math.floor(this.y))}),sum:$static(function(a){return _.reduce(_.isArray(a)&&a||_.asArray(arguments),function(a,c){return a.add(c||Vec2.zero)},Vec2.zero)}),toString:function(){return"{"+this.x+","+this.y+"}"},projectOnCircle:function(a,b){return a.add(this.sub(a).normal.scale(b))},projectOnLineSegment:function(a,
b){var c=b.sub(a),d=c.lengthSquared;if(0==d)return a;d=this.sub(a).dot(c)/d;return 0>d?a:1<d?b:a.add(c.scale(d))},projectOnRay:function(a,b){var c=b.lengthSquared;return 0==c?0:this.sub(a).dot(b)/c}});
Bezier={cubic:function(a,b,c,d,e){var f=a*a*a,g=a*a,h=3*(c.x-b.x),k=3*(c.y-b.y),l=3*(d.x-c.x)-h;c=3*(d.y-c.y)-k;return new Vec2((e.x-b.x-h-l)*f+l*g+h*a+b.x,(e.y-b.y-k-c)*f+c*g+k*a+b.y)},cubic1D:function(a,b,c,d,e){return Bezier.cubic(a,Vec2.zero,new Vec2(b,c),new Vec2(d,e),Vec2.one).y},make:{cubic:function(a,b,c,d){return function(e){return Bezier.cubic(e,a,b,c,d)}},cubic1D:function(a,b,c,d){return function(e){return Bezier.cubic1D(e,a,b,c,d)}}}};
BBox=$prototype({$static:{zero:$property(function(){return new BBox(0,0,0,0)}),unit:$property(function(){return new BBox(0,0,1,1)}),fromLeftTopAndSize:function(a,b){return BBox.fromLTWH({left:a.x,top:a.y,width:b.x,height:b.y})},fromLTWH:function(a,b,c,d){return 1===arguments.length?a&&BBox.fromLTWH(a.left,a.top,a.width,a.height):new BBox(a+c/2,b+d/2,c,d)},fromLTRB:function(a,b,c,d){return 1===arguments.length?a&&BBox.fromLTRB(a.left,a.top,a.right,a.bottom):new BBox(_.lerp(.5,a,c),_.lerp(.5,b,d),c-
a,d-b)},fromSizeAndCenter:function(a,b){return new BBox(b.x-a.x/2,b.y-a.y/2,a.x,a.y)},fromSize:function(a,b){return b?new BBox(-a/2,-b/2,a,b):new BBox(-a.x/2,-a.y/2,a.x,a.y)},fromPoints:function(a){var b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=Number.MIN_VALUE;_.each(a,function(a){b=Math.min(a.x,b);c=Math.min(a.y,c);d=Math.max(a.x,d);e=Math.max(a.y,e)});return BBox.fromLTRB(b,c,d,e)}},constructor:function(a,b,c,d){4==arguments.length?(this.x=a,this.y=b,this.width=c,this.height=d):
_.extend(this,a)},classifyPoint:function(a){a=_.extend(a.x>this.right?{right:!0}:{},a.x<this.left?{left:!0}:{},a.y>this.bottom?{bottom:!0}:{},a.y<this.top?{top:!0}:{});return _.extend(a,a.left||a.right||a.bottom||a.top?{}:{inside:!0})},classifyRay:function(a,b,c){var d=this.size.half,e,f,g,h,k,l;e=1/b.x;f=1/b.y;k=Math.sign(e);l=Math.sign(f);g=(this.x-k*d.x-a.x)*e;h=(this.y-l*d.y-a.y)*f;e*=this.x+k*d.x-a.x;d=(this.y+l*d.y-a.y)*f;if(!(g>d||h>e||(f=g>h?g:h,1<=f||0>=(e<d?e:d))))return e={time:_.clamp(f,
0,1)},e.normal=g>h?new Vec2(-k,0):new Vec2(0,-l),e.delta=b.scale(e.time),e.where=a.add(e.delta),c&&(g=this.grow(-c),e.where.x>g.right?e.where.y<g.top?e=Intersect.rayCircle(a,b,g.rightTop,c):e.where.y>g.bottom&&(e=Intersect.rayCircle(a,b,g.rightBottom,c)):e.where.x<g.left&&(e.where.y<g.top?e=Intersect.rayCircle(a,b,g.leftTop,c):e.where.y>g.bottom&&(e=Intersect.rayCircle(a,b,g.leftBottom,c))),e&&e.insideOut&&(e.where=a)),e},nearestPointTo:function(a,b){var c=b||0,d=new Vec2(this.left,this.top),e=new Vec2(this.right,
this.top),f=new Vec2(this.right,this.bottom),g=new Vec2(this.left,this.bottom),c=[a.projectOnLineSegment(d.add(c,0),e.add(-c,0)),a.projectOnLineSegment(e.add(0,c),f.add(0,-c)),a.projectOnLineSegment(f.add(-c,0),g.add(c,0)),a.projectOnLineSegment(g.add(0,-c),d.add(0,c)),a.projectOnCircle(d.add(c,c),c),a.projectOnCircle(e.add(-c,c),c),a.projectOnCircle(f.add(-c,-c),c),a.projectOnCircle(g.add(c,-c),c)];return _.min(c,function(b){return a.sub(b).length})},xywh:$property(function(){return{x:this.x,y:this.y,
width:this.width,height:this.height}}),ltwh:$alias("css"),union:function(a){return BBox.fromLTRB(Math.min(this.left,a.left),Math.min(this.top,a.top),Math.max(this.right,a.right),Math.max(this.bottom,a.bottom))},clone:$property(function(){return new BBox(this.x,this.y,this.width,this.height)}),floor:$property(function(){return new BBox.fromLTRB(Math.floor(this.left),Math.floor(this.top),Math.floor(this.right),Math.floor(this.bottom))}),css:$property(function(){return{left:this.left,top:this.top,width:this.width,
height:this.height}}),leftTop:$property(function(){return new Vec2(this.left,this.top)}),leftBottom:$property(function(){return new Vec2(this.left,this.bottom)}),rightBottom:$property(function(){return new Vec2(this.right,this.bottom)}),rightTop:$property(function(){return new Vec2(this.right,this.top)}),left:$property(function(){return this.x-this.width/2}),right:$property(function(){return this.x+this.width/2}),top:$property(function(){return this.y-this.height/2}),bottom:$property(function(){return this.y+
this.height/2}),center:$property(function(){return new Vec2(this.x,this.y)}),extent:$alias("size"),size:$property(function(){return new Vec2(this.width,this.height)}),offset:function(a){return new BBox(this.x+a.x,this.y+a.y,this.width,this.height)},newWidth:function(a){return new BBox(this.x-(a-this.width)/2,this.y,a,this.height)},grow:function(a){return new BBox(this.x,this.y,this.width+2*a,this.height+2*a)},shrink:function(a){return this.grow(-a)},area:$property(function(){return Math.abs(this.width*
this.height)}),toString:function(){return"{ "+this.left+","+this.top+" \u2190\u2192 "+this.right+","+this.bottom+" }"}});
Transform=$prototype({$static:{identity:$property(function(){return new Transform}),svgMatrix:function(a){return new Transform([[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]])},translation:function(a){return new Transform([[1,0,a.x],[0,1,a.y],[0,0,1]])}},constructor:function(a){this.components=a||[[1,0,0],[0,1,0],[0,0,1]]},multiply:function(a){var b=[[0,0,0],[0,0,0],[0,0,0]],c,d,e=this.components,f=a.components;for(a=0;3>a;a++)for(c=0;3>c;c++)for(d=0;3>d;d++)b[a][c]+=e[a][d]*f[d][c];return new Transform(b)},
translate:function(a){return this.multiply(Transform.translation(a))},scale:function(a){return this.multiply(new Transform([[a,0,0],[0,a,0],[0,0,1]]))},inverse:$property($memoized(function(){var a=this.components,b=1/(a[0][0]*(a[1][1]*a[2][2]-a[2][1]*a[1][2])-a[0][1]*(a[1][0]*a[2][2]-a[1][2]*a[2][0])+a[0][2]*(a[1][0]*a[2][1]-a[1][1]*a[2][0]));return new Transform([[(a[1][1]*a[2][2]-a[2][1]*a[1][2])*b,-(a[0][1]*a[2][2]-a[0][2]*a[2][1])*b,(a[0][1]*a[1][2]-a[0][2]*a[1][1])*b],[(a[1][0]*a[2][2]-a[1][2]*
a[2][0])*b,(a[0][0]*a[2][2]-a[0][2]*a[2][0])*b,-(a[0][0]*a[1][2]-a[1][0]*a[0][2])*b],[(a[1][0]*a[2][1]-a[2][0]*a[1][1])*b,-(a[0][0]*a[2][1]-a[2][0]*a[0][1])*b,(a[0][0]*a[1][1]-a[1][0]*a[0][1])*b]])})),unproject:function(a){var b=this.components;return new Vec2(a.x*b[0][0]+a.y*b[0][1]+b[0][2],a.x*b[1][0]+a.y*b[1][1]+b[1][2])},project:function(a){return this.inverse.unproject(a)}});
_.rng=function(a,b,c){var d=a,e=987654321;return function(){e=36969*(e&65535)+(e>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;var a=(e<<16)+d&4294967295,a=a/4294967296+.5;return void 0===b&&void 0===c?a:Math.round(b+a*(c-b))}};_.equalDistribution=function(a,b){var c=a/b,d=0;return _.times(b,function(){var a=Math.round(d),b=Math.round(d+=c);return Math.floor(b-a)})};_.ptInRect=function(a,b){return a.x>=b.left&&a.y>=b.top&&a.x<b.right&&a.y<b.bottom};
_.hue2CSS=function(a,b){return _.RGB2CSS(_.hue2RGB(a),b)};_.HSL2CSS=function(a,b){return _.RGB2CSS(_.HSL2RGB(a),b)};_.HSL2RGB=function(a){var b=a[1],c=a[2];a=_.hue2RGB(a[0]);b*=1-Math.abs(2*c-1);return[(a[0]-.5)*b+c,(a[1]-.5)*b+c,(a[2]-.5)*b+c]};_.hue2RGB=function(a){return[Math.max(0,Math.min(1,Math.abs(6*a-3)-1)),Math.max(0,Math.min(1,2-Math.abs(6*a-2))),Math.max(0,Math.min(1,2-Math.abs(6*a-4)))]};
_.RGB2CSS=function(a,b){return"rgba("+Math.round(255*a[0])+","+Math.round(255*a[1])+","+Math.round(255*a[2])+","+(void 0===b?void 0===a[3]?1:a[3]:b)+")"};_.RGB2HSL=function(a,b){var c=a[0],d=a[1],e=a[2],f=void 0===b?a[3]:b,g=Math.max(c,d,e),h=Math.min(c,d,e),k,l=(g+h)/2;if(g==h)k=h=0;else{var n=g-h,h=.5<l?n/(2-g-h):n/(g+h);switch(g){case c:k=(d-e)/n+(d<e?6:0);break;case d:k=(e-c)/n+2;break;case e:k=(c-d)/n+4}k/=6}return void 0===f?[k,h,l]:[k,h,l,f]};
_.extend(Math,function(a){return{roundTo:function(a,c){return a-a%c},round10:function(b,c){return a("round",b,c)},floor10:function(b,c){return a("floor",b,c)},ceil10:function(b,c){return a("ceil",b,c)}}}(function(a,b,c){if("undefined"===typeof c||0===+c)return Math[a](b);b=+b;c=+c;if(isNaN(b)||"number"!==typeof c||0!==c%1)return NaN;b=b.toString().split("e");b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c)));b=b.toString().split("e");return+(b[0]+"e"+(b[1]?+b[1]+c:c))}));
Parse={keyCodeAsString:function(a){return String.fromCharCode(96<=a&&105>=a?a-48:a)},fileName:function(a){return _.first(_.last(a.split(/\\|\//)).split("."))}};_.enumerate=_.cps.each;
_.mapReduce=function(a,b){var c=0,d=!1,e=a&&a.length||0,f=b.maxConcurrency||e,g=0,h=b.memo;if(0===e)b.complete(b.memo||a);else{var k=function(){for(;c<e&&g<f;)g+=1,b.next(a[c],c++,function(){g--;d||(c>=e?0===g&&(setTimeout(function(){b.complete(b.memo||a)},0),d=!0):k())},function(){g--},h);!d&&c>=e&&0==g&&b.complete(b.memo||a)};k()}};_.asyncJoin=function(a,b,c){_.mapReduce(a,{complete:b.bind(c),next:function(a,b,f,g){a.call(c,f,g)}})};
Lock=$prototype({acquire:function(a){this.wait(this.$(function(){this.waitQueue||(this.waitQueue=[]);a()}))},acquired:function(){return void 0!==this.waitQueue},wait:function(a){this.acquired()?this.waitQueue.push(a):a()},release:function(){if(this.waitQueue.length){var a=_.first(this.waitQueue);this.waitQueue=_.rest(this.waitQueue);a()}else delete this.waitQueue}});_.interlocked=function(a){var b=new Lock;return _.extendWith({lock:b,wait:b.$(b.wait)},_.argumentPrependingWrapper(Tags.unwrap(a),function(a){b.acquire(function(){a(b.$(b.release))})}))};
_.defineKeyword("scope",function(a){var b=void 0;return _.argumentPrependingWrapper(Tags.unwrap(a),function(a){var d={when:void 0};(b=b||[]).push(d);a(function(a){if(d.when)throw Error("$scope: release called twice");for(d.when=a;b&&b.last&&b.last.when;)a=b.last.when,(b=_.initial(b)).isEmpty&&(b=void 0),a()})})});$platform.NodeJS&&(module.exports=_);_.defineKeyword("component",function(a){return $extends(Component,a)});_("extendable trigger triggerOnce barrier observable bindable memoize interlocked memoizeCPS debounce throttle overrideThis listener postpones reference raw binds observes".split(" ")).each(_.defineTagKeyword);
_.defineTagKeyword("observableProperty",function(a){return function(b,c){return _.isFunction(b)&&1===arguments.length?a(b,c):a(c,b)}});_.defineKeyword("observableRef",function(a){return $observableProperty($reference(a))});$prototype.macro("$depends",function(a,b,c){a.$depends=$builtin($const(_.coerceToArray(b)));return a});$prototype.macroTag("extendable",function(a,b,c){a[c]=$builtin($const(b));return a});$prototype.macro(function(a){a.$nonce=$static($builtin($property(String.randomHex(32))));return a});
Component=$prototype({$defaults:$extendable({}),$requires:$extendable({}),$macroTags:$extendable({}),$impl:{sequence:function(a,b){return _.sequence(this.extendWithTags,this.flatten,this.generateCustomCompilerImpl(b),this.generateArgumentContractsIfNeeded,this.ensureFinalContracts(b),this.generateConstructor(b),this.evalAlwaysTriggeredMacros(b),this.evalMemberTriggeredMacros(b),this.expandTraitsDependencies,this.mergeExtendables(b),this.contributeTraits(b),this.mergeStreams,this.mergeBindables,this.generateBuiltInMembers(b),
this.callStaticConstructor,this.expandAliases,this.groupMembersByTagForFastEnumeration,this.defineStaticMembers,this.defineInstanceMembers)},expandTraitsDependencies:function(a){_.isNonempty($untag(a.$depends))&&_.isEmpty($untag(a.$traits))&&(a.$traits=DAG.squash(a,{nodes:function(a){return $untag(a.$depends)},key:function(a){return $untag(a.$nonce)}}));return a},mergeExtendables:function(a){return function(b){_.each(a.$definition,function(a,d){a&&a.$extendable&&(b[d]=Tags.modify(a,function(a){a=
_.extendedDeep(a,$untag(b[d]||{}));_.each($untag(b.$traits),function(c){if(!c)throw log.e(b.$traits),Error("invalid $traits value");(c=c.$definition[d])&&(a=_.extendedDeep($untag(c),a))});return a}))});return b}},mergeTraitsMembers:function(a,b){var c={},d={},e={},f=$untag(a.$macroTags),g=_.pluck(b,"$definition").concat(_.clone(a));_.each(g,function(b){_.each(f&&this.applyMacroTags(f,_.extend(_.clone(b),{constructor:a.constructor}))||b,function(b,g){$builtin.isNot(b)&&$builtin.isNot(a[g])&&"constructor"!==
g&&($bindable.is(b)&&(d[g]=b),Component.isStreamDefinition(b)&&(e[g]=b),(c[g]||(c[g]=[])).push(b),a[g]=b)})},this);a.__bindables=d;a.__streams=e;a.__membersByName=c},mergeStreams:function(a){var b=a.__membersByName;_.each(a.__streams,function(c,d){var e=a[d]=Tags.clone(c);e.listeners=[];_.each(b[d],function(a){a!==c&&e.listeners.push($untag(a))})});return a},mergeBindables:function(a){var b=a.__membersByName;_.each(a.__bindables,function(c,d){var e=_.filter2(_.bindable.hooks,function(a,c){var e=b[_.bindable.hooksShort[c]+
d.capitalized];return e?[a,e]:!1});if(e.length){var f={};_.each(e,function(a){_.each(a[1],function(b){b=$untag(b);if(_.isFunction(b)){var c="_"+a[0];(f[c]||(f[c]=[])).push(b)}})});a[d]=$bindable({hooks:f},Tags.clone(c))}},this);return a}},isStreamDefinition:$static(function(a){return _.isObject(a)&&(a.$trigger||a.$triggerOnce||a.$barrier||a.$observable||a.$observableProperty)}),mapMethods:function(){var a=_.last(arguments),b=1===arguments.length?_.constant(!0):arguments[0],c;for(c in this){var d=
this.constructor.$definition[c];if(!d||!d.$property){var e=this[c];_.isFunction(e)&&!_.isPrototypeConstructor(e)&&b(d)&&(this[c]=a.call(this,e,c,d)||e)}}},enumMethods:function(a,b){2===arguments.length?this.mapMethods(a,b.returns(void 0)):this.mapMethods(a.returns(void 0))},constructor:$final(function(a,b){this.parent_=void 0;this.children_=[];var c=this.cfg="object"===typeof a?a:{},d=this.constructor.$definition;this.constructor.$defaults&&(c=this.cfg=_.extend(_.cloneDeep(this.constructor.$defaults),
c));this.mapMethods(function(a,b,c){if(!("$"===b||"init"===b||c&&c.$raw))return this.$(a)});_.onBefore(this,"destroy",this.beforeDestroy);_.onAfter(this,"destroy",this.afterDestroy);var e=[],f={init:!0};_.each(d,function(a,b){if(void 0!==a){if(a.$observableProperty){var d=a.subject,l=b in c?c[b]:d,n=b+"Change",m=f[n]=this[n]=_.observable();m.context=this;m.postpones=a.$postpones;if(_.isPrototypeInstance(d)){var p=d.constructor;m.beforeWrite=function(a){return p.isTypeOf(a)?a:new p(a)}}a.$reference&&
(m.trackReference=!0);_.defineProperty(this,b,{get:function(){return m.value},set:function(a){m.call(this,a)}});a.listeners&&_.each(a.listeners,function(a){e.push([m,a])});_.isFunction(a.$observableProperty)&&e.push([m,a.$observableProperty]);void 0!==l&&m(l)}else if(Component.isStreamDefinition(a)){var q=f[b]=this[b]=_.extend((a.$trigger?_.trigger:a.$triggerOnce?_.triggerOnce:a.$observable?_.observable:a.$barrier?_.barrier:void 0)(a.subject),{context:this,postpones:a.$postpones});a.listeners&&_.each(a.listeners,
function(a){e.push([q,a])});(d=c[b])&&e.push([q,d])}a.$listener&&(this[b].queuedBy=[]);a.$interlocked&&(this[b]=_.interlocked(this[b]));a.$bindable&&(this[b]=_.extend(_.bindable(this[b],this),_.map2(a.$bindable.hooks||{},_.mapsWith(this.$.bind(this).arity1))));a.$debounce&&(d=this[b],l=_.coerceToObject(a.$debounce),this[b]=d.debounced(l.wait||500,l.immediate));a.$throttle&&(d=this[b],l=_.coerceToObject(a.$throttle),this[b]=_.throttle(d,l.wait||500,l));a.$memoize?this[b]=_.memoize(this[b]):a.$memoizeCPS&&
(this[b]=_.cps.memoize(this[b]))}},this);_.intercept(this,"init",function(a){(_.hasArgs(this.constructor.prototype.init)?_.cps.sequence:_.sequence)([this._beforeInit,a.bind(this),this._afterInit]).call(this)});_.each(c,function(a,b){b in f||(this[b]=_.isFunction(a)?this.$(a):a)},this);_.each(d,function(a,b){a&&a.$alias&&!a.$raw&&(this[b]=this[$untag(a)])},this);_.hasAsserts&&_.each(this.constructor.$requires,function(a,b){$assertTypeMatches(_.object([[b,this[b]]]),_.object([[b,a]]))},this);_.each(e,
function(a){a[0].call(this,a[1])},this);!1===c.init||this.constructor.$defaults&&!1===this.constructor.$defaults.init||this.init()}),callTraitsMethod:function(a,b){_.isFunction(b)?_.cps.sequence(_.filter2(this.constructor.$traits||[],this.$(function(b){return(b=b.prototype[a])&&_.cps.arity0(_.noArgs(b)?b.asContinuation:b).bind(this)||!1})).concat(b.arity0))():_.sequence(_.filter2(this.constructor.$traits||[],this.$(function(b){return(b=b.prototype[a])&&(_.hasArgs(b)?b.bind(this,_.identity):b.bind(this))||
!1})))()},_beforeInit:function(a){if(this.initialized.already)throw Error("Component: I am already initialized. Probably you're doing it wrong.");this.callTraitsMethod("beforeInit",a)},init:function(){},_afterInit:function(a){var b=this.cfg;this.callTraitsMethod("afterInit",a);this.initialized(!0);_.each(this.constructor.$definition,function(a,d){if(a&&a.$observableProperty){d+="Change";var e=b[d];if(e)this[d](e)}},this)},initialized:$barrier(),beforeDestroy:function(){if(this.destroyed_)throw Error("Component: I am already destroyed. Probably you're doing it wrong.");
if(this.destroying_)throw Error("Component: Recursive destroy() call detected. Probably you're doing it wrong.");this.destroying_=!0;this.enumMethods(_.off);_.each(this.children_,_.method("destroy"));this.children_=[]},destroy:function(){},afterDestroy:function(){_.each(this.constructor.$traits,function(a){a.prototype.destroy&&a.prototype.destroy.call(this)},this);delete this.destroying_;this.parent_=void 0;this.destroyed_=!0},attachedTo:$property(function(){return this.parent_}),attachTo:function(a){if(a===
this)throw Error("smells like time-travel paradox.. how else can I be parent of myself?");this.parent_!==a&&(void 0!==this.parent_&&this.parent_.children_.remove(this),void 0!==(this.parent_=a)&&this.parent_.children_.push(this));return this},detach:function(){return this.attachTo(void 0)},attached:$property(function(){return this.children_}),attach:function(a){_.invoke(_.coerceToArray(a),"attachTo",this);return this},detachAll:function(){_.each(this.children_,function(a){a.parent_=void 0});this.children_=
[];return this},destroyAll:function(){_.each(this.children_,function(a){a.parent_=void 0;a.destroy()});this.children_=[];return this}});TimeoutError=$extends(Error,{message:"timeout expired"});__=Promise.coerce=function(a){return a instanceof Promise?a:a instanceof Function?new Promise(function(b){b(a())}):Promise.resolve(a)};__.noop=function(){return Promise.resolve()};__.identity=function(a){return Promise.resolve(a)};__.constant=function(a){return function(){return Promise.resolve(a)}};
__.reject=function(a){return Promise.reject(a)};__.rejects=function(a){return function(){return Promise.reject(a)}};__.safe=function(a){return function(){try{return Promise.resolve(a.apply(this,arguments))}catch(b){return Promise.reject(b)}}};__.map=__.safe(function(a,b){if(_.isStrictlyObject(a)){var c=_.coerceToEmpty(a),d=[];_.each2(a,function(a,f){d.push(__.identity(b(a,f)).then(function(a){c[f]=a}))});return __.all(d).then(_.constant(c))}return b(a)});__.then=function(a,b){return __(a).then(_.coerceToFunction(b))};
__.seq=function(a){return __(_.reduce2(a,__.then))};__.all=function(a){return Promise.all(a)};__.delay=function(a){return __.delays(a)()};__.delays=function(a){return function(b){return new Promise(function(c){setTimeout(function(){c(b)},a||0)})}};$mixin(Array,{race:$property(function(){return Promise.race(this)})});
$mixin(Promise,{race:function(a){return[this,a].race},reject:function(a){return this.then(_.throwsError(a))},delay:function(a){return this.then(__.delays(a))},timeout:function(a){return this.race(__.delay(a).reject(new TimeoutError))},now:$property(function(){return this.timeout(0)}),log:$property(function(){return this.then(function(a){log(a);return a},log.e.then(_.throwError))}),alert:$property(function(){return this.then(alert2,alert2.then(_.throwError))}),chain:function(a){return this.then(function(b){a(b);
return b})},done:function(a){return this.then(function(b){return a(null,b)},function(b){a(b,null);throw b;})},"finally":function(a){return this.then(function(b){return a(null,b)},function(b){return a(b,null)})},assert:function(a){return this.then(function(b){$assert(b,a);return b})},assertRejected:function(a){var b=0<arguments.length;return this["catch"](function(c){b&&$assert(c,a);return c})},panic:$property(function(){return this["catch"](function(a){($global.Panic||$global.log)(a);throw a;})})});
$mixin(Function,{promisifyAll:$static(function(a,b){b=b||{};var c=b.except||_.noop;c instanceof Array&&(c=c.asSet.matches);var d={},e;for(e in a){var f=a[e];f instanceof Function?(f=f.bind(a),d[e]=c(e)?f:f.promisify):d[e]=f}return d}),promisify:$hidden($property(function(){var a=this;return function(){var b=this,c=arguments;return new Promise(function(d,e){a.apply(b,_.asArray(c).concat(function(a,b){a&&e(a);d(b)}))})}}))});
Http=$singleton(Component,{$traits:[HttpMethods=$trait({get:function(a,b){return this.request("GET",a,b)},post:function(a,b){return this.request("POST",a,b)},loadFile:function(a,b){return this.request("GET",a,{responseType:"arraybuffer"})},uploadFile:function(a,b,c){return this.post(a,_.extend2({data:b,headers:{"Content-Type":"binary/octet-stream","X-File-Name":Parse.fileName(b.name||"file").transliterate||"file","X-File-Size":b.size,"X-File-Type":b.type}},c))}})],request:function(a,b,c){var d=_.extend2({headers:{"Cache-Control":"no-cache"}},
c);return new Promise(function(c,f){if($platform.Browser){var g=new XMLHttpRequest;g.open(a,(d.protocol||d.hostname||d.port?(d.protocol||window.location.protocol)+"//"+(d.hostname||window.location.hostname)+":"+(d.port||window.location.port):"")+b,!0);d.responseType&&(g.responseType=d.responseType);_.each(d.headers,function(a,b){g.setRequestHeader(b,a)});d.progress&&(g.onprogress=Http.progressCallbackWithSimulation(d.progress));g.onreadystatechange=function(){if(4===g.readyState){d.progress&&d.progress(1);
var a="arraybuffer"===g.responseType?g.response:g.responseText;200===g.status?c(a):f(_.extend(Error(g.statusText),{httpResponse:a,httpStatus:g.status}))}};d.data?g.send(d.data):g.send()}else f("not implemented")})},progressCallbackWithSimulation:function(a){var b=0;a(0);return function(c){c.lengthComputable?a(c.loaded/c.total):a(b=1<(b+=.1)?0:b)}}});
JSONAPI=$singleton(Component,{$traits:[HttpMethods],request:function(a,b,c){c=c||{};var d=_.hasReflection&&$callStack.offset((c.stackOffset||0)+1).asArray;c=_.extend2({headers:{"Content-Type":"application/json; charset=utf-8"}},c);c.what&&(c.data=JSON.stringify(c.what));return Http.request(a,"/api/"+b,c)["finally"](function(a,b){if(b&&(b=JSON.parse(b))||a&&a.httpResponse&&!1===(b=_.json(a.httpResponse)).success)return b;throw a;}).then(function(a){if(a.success)return a.value;if(a.parsedStack)throw _.extend(Error("SERVER: "+
a.error),{remote:!0,parsedStack:a.parsedStack.concat(d||[])});throw Error(a.error);})}});
jQuery&&function(a){var b=_.clone(a.fn);_.extend(a,{svg:function(b){var d=document.createElementNS("http://www.w3.org/2000/svg",b);"svg"!==b||$platform.IE||d.setAttribute("xmlns","http://www.w3.org/2000/svg");return a(d)}}).fn.extend({on:function(a,d){var e=this;d=_.find(arguments,_.isFunction);d.queuedBy&&d.queuedBy.push({remove:function(){e.off(a,d)}});return b.on.apply(this,arguments)},item:function(a){return a?(this.length&&(this[0]._item=a),this):this.length?this[0]._item:void 0},props:function(a){_.extend.apply(null,
[this[0]].concat(arguments));return this},props2:function(a){_.extend2.apply(null,[this[0]].concat(arguments));return this},hasWait:function(){return this.hasClass("i-am-busy")},waitUntil:function(a,b){this.addClass("i-am-busy").attr("disabled",!0);a(this.$(function(){this.removeClass("i-am-busy").removeAttr("disabled");b&&b.apply(null,arguments)}));return this},hasParent:function(a){for(var b=this;0<b.length;){if(b[0]==(a[0]||a))return!0;b=b.parent()}return!1},nonemptyValue:function(){var b=a.trim(this.val());
return 0==b.length?void 0:b},intValue:function(){var a=parseInt(this.nonemptyValue(),10);return isNaN(a)?void 0:a},hitTest:function(b){var d=this.offset(),e=b.clientX-d.left;b=b.clientY-d.top;return 0<=e&&0<=b&&e<a(this).width()&&b<a(this).height()},attrs:function(){return _.object(_.map(arguments,function(a){return[a,this.attr(a)]},this))},belongsTo:function(a){return this.is(a)||this.parents(a).length},selectClass:function(a,b){return this.removeClass(_.values(b).join(" ")).addClass(b[a])},attrInt:function(a){return(this.attr(a)||
"").integerValue},cssInt:function(a){return(this.css(a)||"").integerValue},eachChild:function(b,d){_.each(this.find(b),function(b){d(a(b))});return this},transitionend:function(a){return this.one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",a.oneShot)},animationend:function(a){return this.one("animationend webkitAnimationEnd oAnimationEnd oanimation MSAnimationEnd",a.oneShot)},animateWith:function(a,b){a&&(this.addClass(a),this.animationend(this.$(function(){this.removeClass(a);
b&&b.call(this)})));return this},transitionWith:function(a,b){a&&(this.addClass(a),this.transitionend(this.$(function(){this.removeClass(a);b&&b.call(this)})));return this},drag:function(){var b=function(b,c){return b.originalEvent.touches&&_.find(b.originalEvent.touches,function(b){return a(b.target).hasParent(c)})||b};return function(d){$platform.touch||window.__globalDragOverlay||(window.__globalDragOverlay=a("<div>").css({display:"none",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:999999}).appendTo(document.body));
var e=window.__globalDragOverlay,f=d.button||1,g=this.$(function(g){var h=d.relativeTo||this;this.addClass(d.cls||"");if($platform.touch||g.which===f){var n=h.offset(),m=void 0;if(!d.start||!1!==(m=d.start.call(d.context||this,new Vec2(g.pageX-n.left,g.pageY-n.top),g))){var p=void 0,q=void 0,r=void 0,m=_.clone(m),t=this.$(function(a){if($platform.touch||a.which===f){a.preventDefault();a=b(a,this[0]);var e=h.offset();m=d.move.call(d.context||this,m,new Vec2(a.pageX-g.pageX,a.pageY-g.pageY),new Vec2(a.pageX-
e.left,a.pageY-e.top),a)||m}else p(a)}),q=function(){a(e||document.body).css(e?{display:"none"}:{}).off("mouseup touchend",r).off("mousemove touchmove",t)},r=this.$(function(a){q();d.end&&(a=b(a,this[0]),d.end.call(d.context||this,m,new Vec2(a.pageX-g.pageX,a.pageY-g.pageY),a));this.removeClass(d.cls||"")}),p=this.$(function(a){q();r(a)});a(e||document.body).css(e?{display:"",cursor:d.cursor||""}:{}).on("mousemove touchmove",t).one("mouseup touchend",r);d.callMoveAtStart&&d.move.call(d.context||this,
m,Vec2.zero,new Vec2(g.pageX-n.left,g.pageY-n.top),g)}}}),h=_.$(this,function(a){var e=_.extend({},b(a,this[0]));if($platform.touch&&d.longPress){var f=void 0,h=window.setTimeout(_.$(this,function(){this.off("touchmove touchend",f);g(e)}),300),f=this.$(function(){window.clearTimeout(h);this.off("touchmove touchend",f)});this.one("touchmove touchend",f)}else g(e),a.preventDefault(),a.stopPropagation()});this.on($platform.touch?"touchstart":"mousedown",h);return _.extend(this,{cancel:this.$(function(){this.off($platform.touch?
"touchstart":"mousedown",h)})})}}(),transform:function(a){if(0===arguments.length){var b=(this.css("transform")||"").match(/^matrix\((.+\))$/);return b?(b=b[1].split(",").map(parseFloat),new Transform({a:b[0],b:b[1],c:b[2],d:b[3],e:b[4],f:b[5]})):Transform.identity}return this.css("transform",_.isStrictlyObject(a)&&(a.translate?"translate("+a.translate.x+"px,"+a.translate.y+"px) ":"")+(a.rotate?"rotate("+a.rotate+"rad) ":"")+(a.scale?"scale("+(new Vec2(a.scale)).separatedWith(",")+")":"")||"")},svgTranslate:function(a){return this.attr("transform",
"translate("+a.x+","+a.y+")")},svgTransformMatrix:function(a){a=a.components;return this.attr("transform","matrix("+a[0][0]+","+a[1][0]+","+a[0][1]+","+a[1][1]+","+a[0][2]+","+a[1][2]+")")},svgTransformToElement:function(a){return Transform.svgMatrix(this[0].getTransformToElement(a[0]))},svgBBox:function(a){return 0===arguments.length?new BBox(this[0].getBBox()):this.attr(a.xywh)},outerExtent:function(){return new Vec2(this.outerWidth(),this.outerHeight())},extent:function(){return new Vec2(this.width(),
this.height())},innerExtent:function(){return new Vec2(this.innerWidth(),this.innerHeight())},outerBBox:function(){return BBox.fromLTWH(_.extend(this.offset(),this.outerExtent().asWidthHeight))},clientBBox:function(){return BBox.fromLTWH(this[0].getBoundingClientRect())},leftTop:function(){return new Vec2.fromLT(this.offset())},offsetInParent:function(){return Vec2.fromLeftTop(this.offset()).sub(Vec2.fromLeftTop(this.parent().offset()))},monitorInput:function(b){var d=function(){""===a.trim(a(this).val())?
b.empty(!0):b.empty(!1)};return this.keyup(d).change(d).focus(_.bind(b.focus||_.noop,b,!0)).blur(_.bind(b.focus||_.noop,b,!1))},touchClick:function(a,b){var e=this;b=b||{};if(!b.disableTouch&&$platform.touch){var f=function(b){a.apply(this,arguments);b.preventDefault();return!1},g=function(a){a.preventDefault();return!1};b.handler&&b.handler({unbind:function(){e.off("touchstart",f).off("click",g)}});return this.on("touchstart",f).on("click",g)}b.handler&&b.handler({unbind:function(){e.off("click",
a)}});return this.click(a)},touchDoubleclick:function(a){if($platform.touch){var b=Date.now();return this.on("touchend",function(){var e=Date.now();200>e-b&&a.apply(this,arguments);b=e})}return this.dblclick(a)},nodoubletapzoom:function(){return a(this).bind("touchstart",function(b){var d=b.timeStamp,e=a(this).data("lastTouch")||d,e=d-e,f=b.originalEvent.touches.length;a(this).data("lastTouch",d);!e||500<e||1<f||(b.preventDefault(),a(b.target).trigger("click"))})}})}(jQuery);
