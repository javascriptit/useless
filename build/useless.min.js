$uselessFile="useless.js";"undefined"!==typeof require&&(_=require("underscore"),$include=require);_=function(){_.mixin({zipWith:function(a,b){return _.reduce(_.rest(a),function(a,d){return _.times(Math.max(a&&a.length||0,d&&d.length||0),function(e){return b(a&&a[e],d&&d[e])})},_.first(a))}});if("a1 b2 c3"!==_.zipWith([["a","b","c"],[1,2,3]],function(a,b){return a+b}).join(" "))throw Error("_.zipWith broken");return _}();
unicode_hack=function(){var a={Cn:"[\u0378\u0379\u037f-\u0383\u038b\u038d\u03a2\u0528-\u0530\u0557\u0558\u0560\u0588\u058b-\u0590\u05c8-\u05cf\u05eb-\u05ef\u05f5-\u05ff\u0604\u0605\u061c\u061d\u070e\u074b\u074c\u07b2-\u07bf\u07fb-\u07ff\u082e\u082f\u083f\u085c\u085d\u085f-\u08ff\u0978\u0980\u0984\u098d\u098e\u0991\u0992\u09a9\u09b1\u09b3-\u09b5\u09ba\u09bb\u09c5\u09c6\u09c9\u09ca\u09cf-\u09d6\u09d8-\u09db\u09de\u09e4\u09e5\u09fc-\u0a00\u0a04\u0a0b-\u0a0e\u0a11\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a\u0a3b\u0a3d\u0a43-\u0a46\u0a49\u0a4a\u0a4e-\u0a50\u0a52-\u0a58\u0a5d\u0a5f-\u0a65\u0a76-\u0a80\u0a84\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba\u0abb\u0ac6\u0aca\u0ace\u0acf\u0ad1-\u0adf\u0ae4\u0ae5\u0af0\u0af2-\u0b00\u0b04\u0b0d\u0b0e\u0b11\u0b12\u0b29\u0b31\u0b34\u0b3a\u0b3b\u0b45\u0b46\u0b49\u0b4a\u0b4e-\u0b55\u0b58-\u0b5b\u0b5e\u0b64\u0b65\u0b78-\u0b81\u0b84\u0b8b-\u0b8d\u0b91\u0b96-\u0b98\u0b9b\u0b9d\u0ba0-\u0ba2\u0ba5-\u0ba7\u0bab-\u0bad\u0bba-\u0bbd\u0bc3-\u0bc5\u0bc9\u0bce\u0bcf\u0bd1-\u0bd6\u0bd8-\u0be5\u0bfb-\u0c00\u0c04\u0c0d\u0c11\u0c29\u0c34\u0c3a-\u0c3c\u0c45\u0c49\u0c4e-\u0c54\u0c57\u0c5a-\u0c5f\u0c64\u0c65\u0c70-\u0c77\u0c80\u0c81\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba\u0cbb\u0cc5\u0cc9\u0cce-\u0cd4\u0cd7-\u0cdd\u0cdf\u0ce4\u0ce5\u0cf0\u0cf3-\u0d01\u0d04\u0d0d\u0d11\u0d3b\u0d3c\u0d45\u0d49\u0d4f-\u0d56\u0d58-\u0d5f\u0d64\u0d65\u0d76-\u0d78\u0d80\u0d81\u0d84\u0d97-\u0d99\u0db2\u0dbc\u0dbe\u0dbf\u0dc7-\u0dc9\u0dcb-\u0dce\u0dd5\u0dd7\u0de0-\u0df1\u0df5-\u0e00\u0e3b-\u0e3e\u0e5c-\u0e80\u0e83\u0e85\u0e86\u0e89\u0e8b\u0e8c\u0e8e-\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8\u0ea9\u0eac\u0eba\u0ebe\u0ebf\u0ec5\u0ec7\u0ece\u0ecf\u0eda\u0edb\u0ede-\u0eff\u0f48\u0f6d-\u0f70\u0f98\u0fbd\u0fcd\u0fdb-\u0fff\u10c6-\u10cf\u10fd-\u10ff\u1249\u124e\u124f\u1257\u1259\u125e\u125f\u1289\u128e\u128f\u12b1\u12b6\u12b7\u12bf\u12c1\u12c6\u12c7\u12d7\u1311\u1316\u1317\u135b\u135c\u137d-\u137f\u139a-\u139f\u13f5-\u13ff\u169d-\u169f\u16f1-\u16ff\u170d\u1715-\u171f\u1737-\u173f\u1754-\u175f\u176d\u1771\u1774-\u177f\u17de\u17df\u17ea-\u17ef\u17fa-\u17ff\u180f\u181a-\u181f\u1878-\u187f\u18ab-\u18af\u18f6-\u18ff\u191d-\u191f\u192c-\u192f\u193c-\u193f\u1941-\u1943\u196e\u196f\u1975-\u197f\u19ac-\u19af\u19ca-\u19cf\u19db-\u19dd\u1a1c\u1a1d\u1a5f\u1a7d\u1a7e\u1a8a-\u1a8f\u1a9a-\u1a9f\u1aae-\u1aff\u1b4c-\u1b4f\u1b7d-\u1b7f\u1bab-\u1bad\u1bba-\u1bbf\u1bf4-\u1bfb\u1c38-\u1c3a\u1c4a-\u1c4c\u1c80-\u1ccf\u1cf3-\u1cff\u1de7-\u1dfb\u1f16\u1f17\u1f1e\u1f1f\u1f46\u1f47\u1f4e\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e\u1f7f\u1fb5\u1fc5\u1fd4\u1fd5\u1fdc\u1ff0\u1ff1\u1ff5\u1fff\u2065-\u2069\u2072\u2073\u208f\u209d-\u209f\u20ba-\u20cf\u20f1-\u20ff\u218a-\u218f\u23f4-\u23ff\u2427-\u243f\u244b-\u245f\u2700\u27cb\u27cd\u2b4d-\u2b4f\u2b5a-\u2bff\u2c2f\u2c5f\u2cf2-\u2cf8\u2d26-\u2d2f\u2d66-\u2d6e\u2d71-\u2d7e\u2d97-\u2d9f\u2da7\u2daf\u2db7\u2dbf\u2dc7\u2dcf\u2dd7\u2ddf\u2e32-\u2e7f\u2e9a\u2ef4-\u2eff\u2fd6-\u2fef\u2ffc-\u2fff\u3040\u3097\u3098\u3100-\u3104\u312e-\u3130\u318f\u31bb-\u31bf\u31e4-\u31ef\u321f\u32ff\u4db6-\u4dbf\u9fcc-\u9fff\ua48d-\ua48f\ua4c7-\ua4cf\ua62c-\ua63f\ua674-\ua67b\ua698-\ua69f\ua6f8-\ua6ff\ua78f\ua792-\ua79f\ua7aa-\ua7f9\ua82c-\ua82f\ua83a-\ua83f\ua878-\ua87f\ua8c5-\ua8cd\ua8da-\ua8df\ua8fc-\ua8ff\ua954-\ua95e\ua97d-\ua97f\ua9ce\ua9da-\ua9dd\ua9e0-\ua9ff\uaa37-\uaa3f\uaa4e\uaa4f\uaa5a\uaa5b\uaa7c-\uaa7f\uaac3-\uaada\uaae0-\uab00\uab07\uab08\uab0f\uab10\uab17-\uab1f\uab27\uab2f-\uabbf\uabee\uabef\uabfa-\uabff\ud7a4-\ud7af\ud7c7-\ud7ca\ud7fc-\ud7ff\ufa2e\ufa2f\ufa6e\ufa6f\ufada-\ufaff\ufb07-\ufb12\ufb18-\ufb1c\ufb37\ufb3d\ufb3f\ufb42\ufb45\ufbc2-\ufbd2\ufd40-\ufd4f\ufd90\ufd91\ufdc8-\ufdef\ufdfe\ufdff\ufe1a-\ufe1f\ufe27-\ufe2f\ufe53\ufe67\ufe6c-\ufe6f\ufe75\ufefd\ufefe\uff00\uffbf-\uffc1\uffc8\uffc9\uffd0\uffd1\uffd8\uffd9\uffdd-\uffdf\uffe7\uffef-\ufff8\ufffe\uffff]",Lu:"[A-Z\u00c0-\u00d6\u00d8-\u00de\u0100\u0102\u0104\u0106\u0108\u010a\u010c\u010e\u0110\u0112\u0114\u0116\u0118\u011a\u011c\u011e\u0120\u0122\u0124\u0126\u0128\u012a\u012c\u012e\u0130\u0132\u0134\u0136\u0139\u013b\u013d\u013f\u0141\u0143\u0145\u0147\u014a\u014c\u014e\u0150\u0152\u0154\u0156\u0158\u015a\u015c\u015e\u0160\u0162\u0164\u0166\u0168\u016a\u016c\u016e\u0170\u0172\u0174\u0176\u0178\u0179\u017b\u017d\u0181\u0182\u0184\u0186\u0187\u0189-\u018b\u018e-\u0191\u0193\u0194\u0196-\u0198\u019c\u019d\u019f\u01a0\u01a2\u01a4\u01a6\u01a7\u01a9\u01ac\u01ae\u01af\u01b1-\u01b3\u01b5\u01b7\u01b8\u01bc\u01c4\u01c7\u01ca\u01cd\u01cf\u01d1\u01d3\u01d5\u01d7\u01d9\u01db\u01de\u01e0\u01e2\u01e4\u01e6\u01e8\u01ea\u01ec\u01ee\u01f1\u01f4\u01f6-\u01f8\u01fa\u01fc\u01fe\u0200\u0202\u0204\u0206\u0208\u020a\u020c\u020e\u0210\u0212\u0214\u0216\u0218\u021a\u021c\u021e\u0220\u0222\u0224\u0226\u0228\u022a\u022c\u022e\u0230\u0232\u023a\u023b\u023d\u023e\u0241\u0243-\u0246\u0248\u024a\u024c\u024e\u0370\u0372\u0376\u0386\u0388-\u038a\u038c\u038e\u038f\u0391-\u03a1\u03a3-\u03ab\u03cf\u03d2-\u03d4\u03d8\u03da\u03dc\u03de\u03e0\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03f9\u03fa\u03fd-\u042f\u0460\u0462\u0464\u0466\u0468\u046a\u046c\u046e\u0470\u0472\u0474\u0476\u0478\u047a\u047c\u047e\u0480\u048a\u048c\u048e\u0490\u0492\u0494\u0496\u0498\u049a\u049c\u049e\u04a0\u04a2\u04a4\u04a6\u04a8\u04aa\u04ac\u04ae\u04b0\u04b2\u04b4\u04b6\u04b8\u04ba\u04bc\u04be\u04c0\u04c1\u04c3\u04c5\u04c7\u04c9\u04cb\u04cd\u04d0\u04d2\u04d4\u04d6\u04d8\u04da\u04dc\u04de\u04e0\u04e2\u04e4\u04e6\u04e8\u04ea\u04ec\u04ee\u04f0\u04f2\u04f4\u04f6\u04f8\u04fa\u04fc\u04fe\u0500\u0502\u0504\u0506\u0508\u050a\u050c\u050e\u0510\u0512\u0514\u0516\u0518\u051a\u051c\u051e\u0520\u0522\u0524\u0526\u0531-\u0556\u10a0-\u10c5\u1e00\u1e02\u1e04\u1e06\u1e08\u1e0a\u1e0c\u1e0e\u1e10\u1e12\u1e14\u1e16\u1e18\u1e1a\u1e1c\u1e1e\u1e20\u1e22\u1e24\u1e26\u1e28\u1e2a\u1e2c\u1e2e\u1e30\u1e32\u1e34\u1e36\u1e38\u1e3a\u1e3c\u1e3e\u1e40\u1e42\u1e44\u1e46\u1e48\u1e4a\u1e4c\u1e4e\u1e50\u1e52\u1e54\u1e56\u1e58\u1e5a\u1e5c\u1e5e\u1e60\u1e62\u1e64\u1e66\u1e68\u1e6a\u1e6c\u1e6e\u1e70\u1e72\u1e74\u1e76\u1e78\u1e7a\u1e7c\u1e7e\u1e80\u1e82\u1e84\u1e86\u1e88\u1e8a\u1e8c\u1e8e\u1e90\u1e92\u1e94\u1e9e\u1ea0\u1ea2\u1ea4\u1ea6\u1ea8\u1eaa\u1eac\u1eae\u1eb0\u1eb2\u1eb4\u1eb6\u1eb8\u1eba\u1ebc\u1ebe\u1ec0\u1ec2\u1ec4\u1ec6\u1ec8\u1eca\u1ecc\u1ece\u1ed0\u1ed2\u1ed4\u1ed6\u1ed8\u1eda\u1edc\u1ede\u1ee0\u1ee2\u1ee4\u1ee6\u1ee8\u1eea\u1eec\u1eee\u1ef0\u1ef2\u1ef4\u1ef6\u1ef8\u1efa\u1efc\u1efe\u1f08-\u1f0f\u1f18-\u1f1d\u1f28-\u1f2f\u1f38-\u1f3f\u1f48-\u1f4d\u1f59\u1f5b\u1f5d\u1f5f\u1f68-\u1f6f\u1fb8-\u1fbb\u1fc8-\u1fcb\u1fd8-\u1fdb\u1fe8-\u1fec\u1ff8-\u1ffb\u2102\u2107\u210b-\u210d\u2110-\u2112\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u2130-\u2133\u213e\u213f\u2145\u2183\u2c00-\u2c2e\u2c60\u2c62-\u2c64\u2c67\u2c69\u2c6b\u2c6d-\u2c70\u2c72\u2c75\u2c7e-\u2c80\u2c82\u2c84\u2c86\u2c88\u2c8a\u2c8c\u2c8e\u2c90\u2c92\u2c94\u2c96\u2c98\u2c9a\u2c9c\u2c9e\u2ca0\u2ca2\u2ca4\u2ca6\u2ca8\u2caa\u2cac\u2cae\u2cb0\u2cb2\u2cb4\u2cb6\u2cb8\u2cba\u2cbc\u2cbe\u2cc0\u2cc2\u2cc4\u2cc6\u2cc8\u2cca\u2ccc\u2cce\u2cd0\u2cd2\u2cd4\u2cd6\u2cd8\u2cda\u2cdc\u2cde\u2ce0\u2ce2\u2ceb\u2ced\ua640\ua642\ua644\ua646\ua648\ua64a\ua64c\ua64e\ua650\ua652\ua654\ua656\ua658\ua65a\ua65c\ua65e\ua660\ua662\ua664\ua666\ua668\ua66a\ua66c\ua680\ua682\ua684\ua686\ua688\ua68a\ua68c\ua68e\ua690\ua692\ua694\ua696\ua722\ua724\ua726\ua728\ua72a\ua72c\ua72e\ua732\ua734\ua736\ua738\ua73a\ua73c\ua73e\ua740\ua742\ua744\ua746\ua748\ua74a\ua74c\ua74e\ua750\ua752\ua754\ua756\ua758\ua75a\ua75c\ua75e\ua760\ua762\ua764\ua766\ua768\ua76a\ua76c\ua76e\ua779\ua77b\ua77d\ua77e\ua780\ua782\ua784\ua786\ua78b\ua78d\ua790\ua7a0\ua7a2\ua7a4\ua7a6\ua7a8\uff21-\uff3a]",
Ll:"[a-z\u00aa\u00b5\u00ba\u00df-\u00f6\u00f8-\u00ff\u0101\u0103\u0105\u0107\u0109\u010b\u010d\u010f\u0111\u0113\u0115\u0117\u0119\u011b\u011d\u011f\u0121\u0123\u0125\u0127\u0129\u012b\u012d\u012f\u0131\u0133\u0135\u0137\u0138\u013a\u013c\u013e\u0140\u0142\u0144\u0146\u0148\u0149\u014b\u014d\u014f\u0151\u0153\u0155\u0157\u0159\u015b\u015d\u015f\u0161\u0163\u0165\u0167\u0169\u016b\u016d\u016f\u0171\u0173\u0175\u0177\u017a\u017c\u017e-\u0180\u0183\u0185\u0188\u018c\u018d\u0192\u0195\u0199-\u019b\u019e\u01a1\u01a3\u01a5\u01a8\u01aa\u01ab\u01ad\u01b0\u01b4\u01b6\u01b9\u01ba\u01bd-\u01bf\u01c6\u01c9\u01cc\u01ce\u01d0\u01d2\u01d4\u01d6\u01d8\u01da\u01dc\u01dd\u01df\u01e1\u01e3\u01e5\u01e7\u01e9\u01eb\u01ed\u01ef\u01f0\u01f3\u01f5\u01f9\u01fb\u01fd\u01ff\u0201\u0203\u0205\u0207\u0209\u020b\u020d\u020f\u0211\u0213\u0215\u0217\u0219\u021b\u021d\u021f\u0221\u0223\u0225\u0227\u0229\u022b\u022d\u022f\u0231\u0233-\u0239\u023c\u023f\u0240\u0242\u0247\u0249\u024b\u024d\u024f-\u0293\u0295-\u02af\u0371\u0373\u0377\u037b-\u037d\u0390\u03ac-\u03ce\u03d0\u03d1\u03d5-\u03d7\u03d9\u03db\u03dd\u03df\u03e1\u03e3\u03e5\u03e7\u03e9\u03eb\u03ed\u03ef-\u03f3\u03f5\u03f8\u03fb\u03fc\u0430-\u045f\u0461\u0463\u0465\u0467\u0469\u046b\u046d\u046f\u0471\u0473\u0475\u0477\u0479\u047b\u047d\u047f\u0481\u048b\u048d\u048f\u0491\u0493\u0495\u0497\u0499\u049b\u049d\u049f\u04a1\u04a3\u04a5\u04a7\u04a9\u04ab\u04ad\u04af\u04b1\u04b3\u04b5\u04b7\u04b9\u04bb\u04bd\u04bf\u04c2\u04c4\u04c6\u04c8\u04ca\u04cc\u04ce\u04cf\u04d1\u04d3\u04d5\u04d7\u04d9\u04db\u04dd\u04df\u04e1\u04e3\u04e5\u04e7\u04e9\u04eb\u04ed\u04ef\u04f1\u04f3\u04f5\u04f7\u04f9\u04fb\u04fd\u04ff\u0501\u0503\u0505\u0507\u0509\u050b\u050d\u050f\u0511\u0513\u0515\u0517\u0519\u051b\u051d\u051f\u0521\u0523\u0525\u0527\u0561-\u0587\u1d00-\u1d2b\u1d62-\u1d77\u1d79-\u1d9a\u1e01\u1e03\u1e05\u1e07\u1e09\u1e0b\u1e0d\u1e0f\u1e11\u1e13\u1e15\u1e17\u1e19\u1e1b\u1e1d\u1e1f\u1e21\u1e23\u1e25\u1e27\u1e29\u1e2b\u1e2d\u1e2f\u1e31\u1e33\u1e35\u1e37\u1e39\u1e3b\u1e3d\u1e3f\u1e41\u1e43\u1e45\u1e47\u1e49\u1e4b\u1e4d\u1e4f\u1e51\u1e53\u1e55\u1e57\u1e59\u1e5b\u1e5d\u1e5f\u1e61\u1e63\u1e65\u1e67\u1e69\u1e6b\u1e6d\u1e6f\u1e71\u1e73\u1e75\u1e77\u1e79\u1e7b\u1e7d\u1e7f\u1e81\u1e83\u1e85\u1e87\u1e89\u1e8b\u1e8d\u1e8f\u1e91\u1e93\u1e95-\u1e9d\u1e9f\u1ea1\u1ea3\u1ea5\u1ea7\u1ea9\u1eab\u1ead\u1eaf\u1eb1\u1eb3\u1eb5\u1eb7\u1eb9\u1ebb\u1ebd\u1ebf\u1ec1\u1ec3\u1ec5\u1ec7\u1ec9\u1ecb\u1ecd\u1ecf\u1ed1\u1ed3\u1ed5\u1ed7\u1ed9\u1edb\u1edd\u1edf\u1ee1\u1ee3\u1ee5\u1ee7\u1ee9\u1eeb\u1eed\u1eef\u1ef1\u1ef3\u1ef5\u1ef7\u1ef9\u1efb\u1efd\u1eff-\u1f07\u1f10-\u1f15\u1f20-\u1f27\u1f30-\u1f37\u1f40-\u1f45\u1f50-\u1f57\u1f60-\u1f67\u1f70-\u1f7d\u1f80-\u1f87\u1f90-\u1f97\u1fa0-\u1fa7\u1fb0-\u1fb4\u1fb6\u1fb7\u1fbe\u1fc2-\u1fc4\u1fc6\u1fc7\u1fd0-\u1fd3\u1fd6\u1fd7\u1fe0-\u1fe7\u1ff2-\u1ff4\u1ff6\u1ff7\u210a\u210e\u210f\u2113\u212f\u2134\u2139\u213c\u213d\u2146-\u2149\u214e\u2184\u2c30-\u2c5e\u2c61\u2c65\u2c66\u2c68\u2c6a\u2c6c\u2c71\u2c73\u2c74\u2c76-\u2c7c\u2c81\u2c83\u2c85\u2c87\u2c89\u2c8b\u2c8d\u2c8f\u2c91\u2c93\u2c95\u2c97\u2c99\u2c9b\u2c9d\u2c9f\u2ca1\u2ca3\u2ca5\u2ca7\u2ca9\u2cab\u2cad\u2caf\u2cb1\u2cb3\u2cb5\u2cb7\u2cb9\u2cbb\u2cbd\u2cbf\u2cc1\u2cc3\u2cc5\u2cc7\u2cc9\u2ccb\u2ccd\u2ccf\u2cd1\u2cd3\u2cd5\u2cd7\u2cd9\u2cdb\u2cdd\u2cdf\u2ce1\u2ce3\u2ce4\u2cec\u2cee\u2d00-\u2d25\ua641\ua643\ua645\ua647\ua649\ua64b\ua64d\ua64f\ua651\ua653\ua655\ua657\ua659\ua65b\ua65d\ua65f\ua661\ua663\ua665\ua667\ua669\ua66b\ua66d\ua681\ua683\ua685\ua687\ua689\ua68b\ua68d\ua68f\ua691\ua693\ua695\ua697\ua723\ua725\ua727\ua729\ua72b\ua72d\ua72f-\ua731\ua733\ua735\ua737\ua739\ua73b\ua73d\ua73f\ua741\ua743\ua745\ua747\ua749\ua74b\ua74d\ua74f\ua751\ua753\ua755\ua757\ua759\ua75b\ua75d\ua75f\ua761\ua763\ua765\ua767\ua769\ua76b\ua76d\ua76f\ua771-\ua778\ua77a\ua77c\ua77f\ua781\ua783\ua785\ua787\ua78c\ua78e\ua791\ua7a1\ua7a3\ua7a5\ua7a7\ua7a9\ua7fa\ufb00-\ufb06\ufb13-\ufb17\uff41-\uff5a]",
Lt:"[\u01c5\u01c8\u01cb\u01f2\u1f88-\u1f8f\u1f98-\u1f9f\u1fa8-\u1faf\u1fbc\u1fcc\u1ffc]",Lm:"[\u02b0-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0374\u037a\u0559\u0640\u06e5\u06e6\u07f4\u07f5\u07fa\u081a\u0824\u0828\u0971\u0e46\u0ec6\u10fc\u17d7\u1843\u1aa7\u1c78-\u1c7d\u1d2c-\u1d61\u1d78\u1d9b-\u1dbf\u2071\u207f\u2090-\u209c\u2c7d\u2d6f\u2e2f\u3005\u3031-\u3035\u303b\u309d\u309e\u30fc-\u30fe\ua015\ua4f8-\ua4fd\ua60c\ua67f\ua717-\ua71f\ua770\ua788\ua9cf\uaa70\uaadd\uff70\uff9e\uff9f]",Lo:"[\u01bb\u01c0-\u01c3\u0294\u05d0-\u05ea\u05f0-\u05f2\u0620-\u063f\u0641-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u0800-\u0815\u0840-\u0858\u0904-\u0939\u093d\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e45\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0edc\u0edd\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10d0-\u10fa\u1100-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17dc\u1820-\u1842\u1844-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bc0-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c77\u1ce9-\u1cec\u1cee-\u1cf1\u2135-\u2138\u2d30-\u2d65\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3006\u303c\u3041-\u3096\u309f\u30a1-\u30fa\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcb\ua000-\ua014\ua016-\ua48c\ua4d0-\ua4f7\ua500-\ua60b\ua610-\ua61f\ua62a\ua62b\ua66e\ua6a0-\ua6e5\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa6f\uaa71-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb\uaadc\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff66-\uff6f\uff71-\uff9d\uffa0-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]",
Mn:"[\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065f\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u0900-\u0902\u093a\u093c\u0941-\u0948\u094d\u0951-\u0957\u0962\u0963\u0981\u09bc\u09c1-\u09c4\u09cd\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b62\u0b63\u0b82\u0bc0\u0bcd\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc6\u0ccc\u0ccd\u0ce2\u0ce3\u0d41-\u0d44\u0d4d\u0d62\u0d63\u0dca\u0dd2-\u0dd4\u0dd6\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1be6\u1be8\u1be9\u1bed\u1bef-\u1bf1\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfc-\u1dff\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\ufb1e\ufe00-\ufe0f\ufe20-\ufe26]",
Me:"[\u0488\u0489\u20dd-\u20e0\u20e2-\u20e4\ua670-\ua672]",Mc:"[\u0903\u093b\u093e-\u0940\u0949-\u094c\u094e\u094f\u0982\u0983\u09be-\u09c0\u09c7\u09c8\u09cb\u09cc\u09d7\u0a03\u0a3e-\u0a40\u0a83\u0abe-\u0ac0\u0ac9\u0acb\u0acc\u0b02\u0b03\u0b3e\u0b40\u0b47\u0b48\u0b4b\u0b4c\u0b57\u0bbe\u0bbf\u0bc1\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcc\u0bd7\u0c01-\u0c03\u0c41-\u0c44\u0c82\u0c83\u0cbe\u0cc0-\u0cc4\u0cc7\u0cc8\u0cca\u0ccb\u0cd5\u0cd6\u0d02\u0d03\u0d3e-\u0d40\u0d46-\u0d48\u0d4a-\u0d4c\u0d57\u0d82\u0d83\u0dcf-\u0dd1\u0dd8-\u0ddf\u0df2\u0df3\u0f3e\u0f3f\u0f7f\u102b\u102c\u1031\u1038\u103b\u103c\u1056\u1057\u1062-\u1064\u1067-\u106d\u1083\u1084\u1087-\u108c\u108f\u109a-\u109c\u17b6\u17be-\u17c5\u17c7\u17c8\u1923-\u1926\u1929-\u192b\u1930\u1931\u1933-\u1938\u19b0-\u19c0\u19c8\u19c9\u1a19-\u1a1b\u1a55\u1a57\u1a61\u1a63\u1a64\u1a6d-\u1a72\u1b04\u1b35\u1b3b\u1b3d-\u1b41\u1b43\u1b44\u1b82\u1ba1\u1ba6\u1ba7\u1baa\u1be7\u1bea-\u1bec\u1bee\u1bf2\u1bf3\u1c24-\u1c2b\u1c34\u1c35\u1ce1\u1cf2\ua823\ua824\ua827\ua880\ua881\ua8b4-\ua8c3\ua952\ua953\ua983\ua9b4\ua9b5\ua9ba\ua9bb\ua9bd-\ua9c0\uaa2f\uaa30\uaa33\uaa34\uaa4d\uaa7b\uabe3\uabe4\uabe6\uabe7\uabe9\uabea\uabec]",
Nd:"[0-9\u0660-\u0669\u06f0-\u06f9\u07c0-\u07c9\u0966-\u096f\u09e6-\u09ef\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be6-\u0bef\u0c66-\u0c6f\u0ce6-\u0cef\u0d66-\u0d6f\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29\u1040-\u1049\u1090-\u1099\u17e0-\u17e9\u1810-\u1819\u1946-\u194f\u19d0-\u19d9\u1a80-\u1a89\u1a90-\u1a99\u1b50-\u1b59\u1bb0-\u1bb9\u1c40-\u1c49\u1c50-\u1c59\ua620-\ua629\ua8d0-\ua8d9\ua900-\ua909\ua9d0-\ua9d9\uaa50-\uaa59\uabf0-\uabf9\uff10-\uff19]",Nl:"[\u16ee-\u16f0\u2160-\u2182\u2185-\u2188\u3007\u3021-\u3029\u3038-\u303a\ua6e6-\ua6ef]",
No:"[\u00b2\u00b3\u00b9\u00bc-\u00be\u09f4-\u09f9\u0b72-\u0b77\u0bf0-\u0bf2\u0c78-\u0c7e\u0d70-\u0d75\u0f2a-\u0f33\u1369-\u137c\u17f0-\u17f9\u19da\u2070\u2074-\u2079\u2080-\u2089\u2150-\u215f\u2189\u2460-\u249b\u24ea-\u24ff\u2776-\u2793\u2cfd\u3192-\u3195\u3220-\u3229\u3251-\u325f\u3280-\u3289\u32b1-\u32bf\ua830-\ua835]",Zs:"[ \u00a0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000]",Zl:"[\u2028]",Zp:"[\u2029]",Cc:"[\x00-\u001f\u007f-\u009f]",Cf:"[\u00ad\u0600-\u0603\u06dd\u070f\u17b4\u17b5\u200b-\u200f\u202a-\u202e\u2060-\u2064\u206a-\u206f\ufeff\ufff9-\ufffb]",
Cs:"[\ud800-\udfff]",Co:"[\ue000-\uf8ff]",Ps:"[([{\u0f3a\u0f3c\u169b\u201a\u201e\u2045\u207d\u208d\u2329\u2768\u276a\u276c\u276e\u2770\u2772\u2774\u27c5\u27e6\u27e8\u27ea\u27ec\u27ee\u2983\u2985\u2987\u2989\u298b\u298d\u298f\u2991\u2993\u2995\u2997\u29d8\u29da\u29fc\u2e22\u2e24\u2e26\u2e28\u3008\u300a\u300c\u300e\u3010\u3014\u3016\u3018\u301a\u301d\ufd3e\ufe17\ufe35\ufe37\ufe39\ufe3b\ufe3d\ufe3f\ufe41\ufe43\ufe47\ufe59\ufe5b\ufe5d\uff08\uff3b\uff5b\uff5f\uff62]",Pd:"[-\u058a\u05be\u1400\u1806\u2010-\u2015\u2e17\u2e1a\u301c\u3030\u30a0\ufe31\ufe32\ufe58\ufe63\uff0d]",
Pc:"[_\u203f\u2040\u2054\ufe33\ufe34\ufe4d-\ufe4f\uff3f]",Pe:"[)]}\u0f3b\u0f3d\u169c\u2046\u207e\u208e\u232a\u2769\u276b\u276d\u276f\u2771\u2773\u2775\u27c6\u27e7\u27e9\u27eb\u27ed\u27ef\u2984\u2986\u2988\u298a\u298c\u298e\u2990\u2992\u2994\u2996\u2998\u29d9\u29db\u29fd\u2e23\u2e25\u2e27\u2e29\u3009\u300b\u300d\u300f\u3011\u3015\u3017\u3019\u301b\u301e\u301f\ufd3f\ufe18\ufe36\ufe38\ufe3a\ufe3c\ufe3e\ufe40\ufe42\ufe44\ufe48\ufe5a\ufe5c\ufe5e\uff09\uff3d\uff5d\uff60\uff63]",Sm:"[+<->|~\u00ac\u00b1\u00d7\u00f7\u03f6\u0606-\u0608\u2044\u2052\u207a-\u207c\u208a-\u208c\u2118\u2140-\u2144\u214b\u2190-\u2194\u219a\u219b\u21a0\u21a3\u21a6\u21ae\u21ce\u21cf\u21d2\u21d4\u21f4-\u22ff\u2308-\u230b\u2320\u2321\u237c\u239b-\u23b3\u23dc-\u23e1\u25b7\u25c1\u25f8-\u25ff\u266f\u27c0-\u27c4\u27c7-\u27ca\u27cc\u27ce-\u27e5\u27f0-\u27ff\u2900-\u2982\u2999-\u29d7\u29dc-\u29fb\u29fe-\u2aff\u2b30-\u2b44\u2b47-\u2b4c\ufb29\ufe62\ufe64-\ufe66\uff0b\uff1c-\uff1e\uff5c\uff5e\uffe2\uffe9-\uffec]",
Po:"[!-#%-'*,./:;?@\\\u00a1\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1361-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cd3\u2016\u2017\u2020-\u2027\u2030-\u2038\u203b-\u203e\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205e\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00\u2e01\u2e06-\u2e08\u2e0b\u2e0e-\u2e16\u2e18\u2e19\u2e1b\u2e1e\u2e1f\u2e2a-\u2e2e\u2e30\u2e31\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]",
Sk:"[^`\u00a8\u00af\u00b4\u00b8\u02c2-\u02c5\u02d2-\u02df\u02e5-\u02eb\u02ed\u02ef-\u02ff\u0375\u0384\u0385\u1fbd\u1fbf-\u1fc1\u1fcd-\u1fcf\u1fdd-\u1fdf\u1fed-\u1fef\u1ffd\u1ffe\u309b\u309c\ua700-\ua716\ua720\ua721\ua789\ua78a\ufbb2-\ufbc1\uff3e\uff40\uffe3]",Sc:"[$\u00a2-\u00a5\u060b\u09f2\u09f3\u09fb\u0af1\u0bf9\u0e3f\u17db\u20a0-\u20b9\ua838\ufdfc\ufe69\uff04\uffe0\uffe1\uffe5\uffe6]",Pi:"[\u00ab\u2018\u201b\u201c\u201f\u2039\u2e02\u2e04\u2e09\u2e0c\u2e1c\u2e20]",So:"[\u00a6\u00a7\u00a9\u00ae\u00b0\u00b6\u0482\u060e\u060f\u06de\u06e9\u06fd\u06fe\u07f6\u09fa\u0b70\u0bf3-\u0bf8\u0bfa\u0c7f\u0d79\u0f01-\u0f03\u0f13-\u0f17\u0f1a-\u0f1f\u0f34\u0f36\u0f38\u0fbe-\u0fc5\u0fc7-\u0fcc\u0fce\u0fcf\u0fd5-\u0fd8\u109e\u109f\u1360\u1390-\u1399\u1940\u19de-\u19ff\u1b61-\u1b6a\u1b74-\u1b7c\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116\u2117\u211e-\u2123\u2125\u2127\u2129\u212e\u213a\u213b\u214a\u214c\u214d\u214f\u2195-\u2199\u219c-\u219f\u21a1\u21a2\u21a4\u21a5\u21a7-\u21ad\u21af-\u21cd\u21d0\u21d1\u21d3\u21d5-\u21f3\u2300-\u2307\u230c-\u231f\u2322-\u2328\u232b-\u237b\u237d-\u239a\u23b4-\u23db\u23e2-\u23f3\u2400-\u2426\u2440-\u244a\u249c-\u24e9\u2500-\u25b6\u25b8-\u25c0\u25c2-\u25f7\u2600-\u266e\u2670-\u26ff\u2701-\u2767\u2794-\u27bf\u2800-\u28ff\u2b00-\u2b2f\u2b45\u2b46\u2b50-\u2b59\u2ce5-\u2cea\u2e80-\u2e99\u2e9b-\u2ef3\u2f00-\u2fd5\u2ff0-\u2ffb\u3004\u3012\u3013\u3020\u3036\u3037\u303e\u303f\u3190\u3191\u3196-\u319f\u31c0-\u31e3\u3200-\u321e\u322a-\u3250\u3260-\u327f\u328a-\u32b0\u32c0-\u32fe\u3300-\u33ff\u4dc0-\u4dff\ua490-\ua4c6\ua828-\ua82b\ua836\ua837\ua839\uaa77-\uaa79\ufdfd\uffe4\uffe8\uffed\uffee\ufffc\ufffd]",
Pf:"[\u00bb\u2019\u201d\u203a\u2e03\u2e05\u2e0a\u2e0d\u2e1d\u2e21]"},b={},c;for(c in a)b[c[0]]=b[c[0]]?a[c].substring(0,a[c].length-1)+b[c[0]].substring(1):a[c];for(c in b)a[c]=b[c];return function(b){var c="";b instanceof RegExp&&(c=(b.global?"g":"")+(b.ignoreCase?"i":"")+(b.multiline?"m":""),b=b.source);b=b.replace(/\\p\{(..?)\}/g,function(b,c){return a[c]||b});return new RegExp(b,c)}}();
Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",c,d,e,g,f,h,k=0;for(a=Base64._utf8_encode(a);k<a.length;)c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),g=c>>2,c=(c&3)<<4|d>>4,f=(d&15)<<2|e>>6,h=e&63,isNaN(d)?f=h=64:isNaN(e)&&(h=64),b=b+Base64._keyStr.charAt(g)+Base64._keyStr.charAt(c)+Base64._keyStr.charAt(f)+Base64._keyStr.charAt(h);return b},decode:function(a){var b="",c,d,e,g,f,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,
"");h<a.length;)c=Base64._keyStr.indexOf(a.charAt(h++)),d=Base64._keyStr.indexOf(a.charAt(h++)),g=Base64._keyStr.indexOf(a.charAt(h++)),f=Base64._keyStr.indexOf(a.charAt(h++)),c=c<<2|d>>4,d=(d&15)<<4|g>>2,e=(g&3)<<6|f,b+=String.fromCharCode(c),64!=g&&(b+=String.fromCharCode(d)),64!=f&&(b+=String.fromCharCode(e));return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=
String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),c+=3);return b}};
_.platform=function(){return arguments.callee.__value||(arguments.callee.__value="undefined"!==typeof window&&window._&&window._.platform===_.platform&&"undefined"!==typeof navigator&&navigator.platform&&navigator.platform.indexOf?_.extend({engine:"browser",browser:0<=navigator.userAgent.indexOf("Firefox")?"Firefox":0<=navigator.userAgent.indexOf("Trident")?"IE":void 0},0<=navigator.platform.indexOf("Linux arm")||0<=navigator.platform.indexOf("Android")||0<=navigator.userAgent.indexOf("Android")?
{touch:!0,system:"Android"}:0<=navigator.platform.indexOf("iPad")?{touch:!0,system:"iOS",device:"iPad"}:0<=navigator.platform.indexOf("iPhone")||0<=navigator.platform.indexOf("iPod")?{touch:!0,system:"iOS",device:"iPhone"}:{}):"undefined"!==typeof global&&global._&&global._.platform===_.platform?{engine:"node"}:{})};_.global=function(){return"browser"===_.platform().engine?window:"node"===_.platform().engine?global:void 0};
_.defineGlobalProperty=function(a,b,c){if(void 0!==_.global()[a])throw Error("cannot defineGlobalProperty: "+a+" is already there");Object.defineProperty(_.global(),a,_.extend({enumerable:!0,get:_.isFunction(b)&&0===b.length?b:_.constant(b)},c));return b};$overrideUnderscore=function(a,b){return _[a]=b(_[a])};"browser"!==_.platform().engine&&_.defineGlobalProperty("alert",function(a){var b=_.global().log&&_.partial(log.warn,log.config({stackOffset:2}))||console.log;b.apply(b,["ALERT:"].concat(_.asArray(arguments)))});
_.defineGlobalProperty("alert2",function(a){alert(_.map(arguments,_.stringify).join(", "));return arguments[0]});_.hasAsserts=!0;_.extend(_,{tests:{},withTest:function(a,b,c){c();_.runTest(b);_.publishToTestsNamespace(a,b)},deferTest:function(a,b,c){c();_.publishToTestsNamespace(a,b)},runTest:function(a){_.isFunction(a)?a():_.each(a,function(a){a()})},publishToTestsNamespace:function(a,b){_.isArray(a)?(_.tests[a[0]]||(_.tests[a[0]]={}))[a[1]]=b:_.tests[a]=b}});
_.extend(_,_.assertions={assert:function(a){var b=[].splice.call(arguments,0);1===b.length?!0!==b[0]&&_.assertionFailed({notMatching:b}):_.allEqual(b)||_.assertionFailed({notMatching:b});return!0},assertCPS:function(a,b,c){var d=b&&(_.isArray(b)?b:[b])||[];a(function(){$assert([].splice.call(arguments,0),d);if(c)return c(),!0})},assertNotCalled:function(a){a(function(){$fail})},assertEveryCalledOnce:function(a,b){return _.assertEveryCalled(_.hasTags?$once(a):_.extend(a,{once:!0}),b)},assertEveryCalled:function(a,
b){var c=_.hasTags?$untag(a):a,d=_.hasTags?$async.is(a):a.async,e=(once=_.hasTags?$once.is(a):a.once)?null:c.toString().match(/.*function[^\(]\(([^\)]+)\)/),g=once?_.times(c.length,_.constant(1)):_.map(e[1].split(","),function(a){return(a=a.trim().match(/^(.+)__(.+)$/))&&parseInt(a[2],10)||!0}),f=[],e=_.times(c.length,function(a){return function(){f[a]=_.isNumber(g[a])?(f[a]||0)+1:!0;d&&_.isEqual(f,g)&&b()}});c.apply(null,e);d||(_.assert(f,g),b&&b())},assertCallOrder:function(a){var b=0,c=_.times(a.length,
function(a){return function(){arguments.callee.callIndex=b++}});a.apply(null,c);return _.assert(_.pluck(c,"callIndex"),_.times(c.length,_.identity.arity1))},assertMatches:function(a,b){try{return _.assert(_.matches.apply(null,_.rest(arguments))(a))}catch(c){throw _.isAssertionError(c)?_.extend(c,{notMatching:[a,b]}):c;}},assertNotMatches:function(a,b){try{return _.assert(!_.matches.apply(null,_.rest(arguments))(a))}catch(c){throw _.isAssertionError(c)?_.extend(c,{notMatching:[a,b]}):c;}},assertType:function(a,
b){return _.assert(_.decideType(a),b)},assertTypeMatches:function(a,b){return _.isEmpty(_.typeMismatches(b,a))?!0:_.assertionFailed({asColumns:!0,notMatching:[{value:a},{type:_.decideType(a)},{contract:b},{mismatches:void 0}]})},assertFails:function(a){return _.assertThrows.call(this,a,_.isAssertionError)},assertThrows:function(a,b){var c=void 0,d=!1;try{a.call(this)}catch(e){c=e,d=!0}_.assert.call(this,d);1<arguments.length&&_.assertMatches.apply(this,[c].concat(_.rest(arguments)))},assertNotThrows:function(a){return _.assertEveryCalled(function(b){a();
b()})},assertArguments:function(a,b,c){b=(b||a.callee).toString();var d=b.match(/.*function[^\(]\(([^\)]+)\)/);if(d){a=_.asArray(a);var d=_.map(d[1].split(","),function(a){a="_"===a.trim()[0]?a.replace(/_/g," ").trim():void 0;var b=parseInt(a,10);return _.isFinite(b)?b:a}),e=_.zipWith([d,a],function(a,b){return void 0===a?!0:a===b});_.every(e)||_.assertionFailed({notMatching:_.nonempty([[c,b].join(": "),d,a])})}},fail:function(){_.assertionFailed()},fails:_.constant(function(){_.assertionFailed()}),
stub:function(){_.assertionFailed()}});_.extend(_,{assertionError:function(a){return _.extend(Error("assertion failed"),a,{assertion:!0})},assertionFailed:function(a){throw _.extend(_.assertionError(a),{stack:_.rest(Error().stack.split("\n"),3).join("\n")});},isAssertionError:function(a){return!0===a.assertion}});_.extend(_,{allEqual:function(a){return _.reduce(a,function(b,c){return b&&_.isEqual(a[0],c)},!0)}});_.each(_.keys(_.assertions),function(a){_.defineGlobalProperty("$"+a,_[a],{configurable:!0})});
_.extend(_,{asArray:function(a){return[].slice.call(a,0)}});
_.extend(_,{numArgs:function(a){return void 0===a._ac?a.length:a._ac},restArg:function(a){return a._ra||!1},noArgs:function(a){return 0===_.numArgs(a)&&!a._ra},hasArgs:function(a){return 0<_.numArgs(a)&&!a._ra},oneArg:function(a){return 1===_.numArgs(a)&&!a._ra},withRestArg:_.defineGlobalProperty("$restArg",function(a){Object.defineProperty(a,"_ra",{enumerable:!1,writable:!0,value:!0});return a}),withArgs:function(a,b,c){void 0!==a&&Object.defineProperty(c,"_ac",{enumerable:!1,writable:!0,value:a});
void 0!==b&&Object.defineProperty(c,"_ra",{enumerable:!1,writable:!0,value:b});return c},withSameArgs:function(a,b){return _.withArgs(_.numArgs(a),_.restArg(a),b)}});$overrideUnderscore("memoize",function(a){return function(b){return _.withSameArgs(b,a(b))}});$overrideUnderscore("partial",function(a){return $restArg(function(b){return _.withArgs(Math.max(0,_.numArgs(b)-(arguments.length-1)),b._ra,a.apply(this,arguments))})});
$overrideUnderscore("bind",function(a){return $restArg(function(b,c){return _.withArgs(Math.max(0,_.numArgs(b)-(arguments.length-2)),b._ra,a.apply(this,arguments))})});_.arity=function(a,b){return function(){return b.apply(this,_.first(arguments,a))}};_.arity0=function(a){return function(){return a.call(this)}};_.arity1=function(a){return function(b){return a.call(this,b)}};_.arity2=function(a){return function(b,c){return a.call(this,b,c)}};
_.arity3=function(a){return function(b,c,d){return a.call(this,b,c,d)}};_.arityFn=function(a){return _["arity"+a]};_.tails=$restArg(function(a){var b=_.rest(arguments);return function(){return a.apply(this,_.asArray(arguments).concat(b))}});_.tails2=$restArg(function(a){var b=_.rest(arguments);return function(c){return a.apply(this,[c].concat(b))}});_.tails3=$restArg(function(a){var b=_.rest(arguments);return function(c,d){return a.apply(this,[c,d].concat(b))}});
_.flip=function(a){if(_.restArg(a))return $restArg(function(){return a.apply(this,_.asArray(arguments).reverse())});switch(_.numArgs(a)){case 0:case 1:return a;case 2:return _.flip2(a);case 3:return _.flip3(a);default:throw Error("flip: unsupported arity");}};_.flip2=function(a){return function(b,c){return a.call(this,c,b)}};_.flip3=function(a){return function(b,c,d){return a.call(this,d,c,b)}};_.or=function(a,b){return function(){return a.apply(this,arguments)||b.apply(this,arguments)}};
_.and=function(a,b){return function(){return a.apply(this,arguments)&&b.apply(this,arguments)}};_.not=function(a){return function(){return!a.apply(this,arguments)}};_.extend(_,{Y:function(a){var b=a(function(){return b.apply(this,arguments)});return b}});
(function(){_.hyperOperator=function(a,b,c,d){var e=_.arityFn(a)||_.identity,g=(c||_.goDeeperWhenFirstArgumentIsGood)(a,d||_.isNonTrivial);return function(){var a=_.last(arguments);return _.Y(function(c){var d=_.tails(b,e(c));return function(){return(g(arguments)?d:a).apply(this,arguments)}}).apply(this,_.initial(arguments))}};_.goDeeperWhenFirstArgumentIsGood=function(a,b){return function(a){return 0<a.length?b(a[0]):!1}};_.goDeeperAlwaysIfPossible=function(a,b){return 0===a?_.constant(!1):1===a?
function(a){return b(a[0])}:2===a?function(a){return b(a[0])||b(a[1])}:function(a){return _.some(_.asArray(a),b)}};_.goDeeperOnlyWhenNessesary=function(a,b){return 0===a?_.constant(!1):1===a?function(a){return b(a[0])}:2===a?function(a){return b(a[0])&&b(a[1])}:function(a){return _.every(_.asArray(a),b)}};_.isTrivial=function(a){return _.isEmpty(a)||_.isString(a)||_.isNumber(a)||!(_.isStrictlyObject(a)||_.isArray(a))||_.isPrototypeInstance(a)||_.isMeta(a)};_.isMeta=_.constant(!1);_.isNonTrivial=_.not(_.isTrivial);
_.binary=2;_.unary=1})();_.higherOrder=function(a){return _.partial(_.partial,a)};_.eval=function(a){return _.isFunction(a)?a.call(this):a};_.evals=function(a){var b=arguments;return function(a){return _.isFunction(a)?a.apply(this,b):a}};_.method=function(a){var b=_.rest(arguments);return function(c){return c[a].apply(c,b)}};_.asFreeFunction=function(a){return function(b,c){return a.apply(b,_.rest(arguments))}};_.asMethod=function(a){return function(){return a.apply(void 0,[this].concat(_.asArray(arguments)))}};
_.appendsArguments=function(a,b){return _.withSameArgs(a,function(){var c=this,d=_.asArray(arguments);return b(function(){a.apply(c,d.concat(_.asArray(arguments)))})})};_.prependsArguments=function(a,b){return _.withSameArgs(a,function(){var c=this,d=_.asArray(arguments);return b(function(){a.apply(c,_.asArray(arguments).concat(d))})})};_.once=function(a){var b=!1;return function(){if(!b)return b=!0,a.apply(this,arguments)}};
_.withTimeout=function(a,b,c){var d=!1,e=setTimeout(function(){d=!0;a.expired&&a.expired(c)},a.maxTime);b(function(){d||(clearTimeout(e),c&&c.apply(this,arguments))})};_.sequence=function(a){var b=_.isArray(a)?a:_.asArray(arguments),c=b.length;return 0===c?_.identity:function(a){for(var e=0;e<c;e++)a=b[e].call(this,a);return a}};_.seq=_.sequence;_.then=function(a,b){return function(c){return b.call(this,a.apply(this,arguments))}};
_.makes=function(a){return function(){switch(arguments.length){case 0:return new a;case 1:return new a(arguments[0]);case 2:return new a(arguments[0],arguments[1]);default:throw Error("not supported");}}};_.asString=function(a){return a+""};_.typeOf=function(a){return typeof a};_.count=function(a){return a.length};_.array=_.tuple=function(){return _.asArray(arguments)};_.concat=function(a,b){return _.isArray(a)?a.concat([b]):a+b};_.atIndex=function(a){return function(b){return b[a]}};
_.takesFirst=_.higherOrder(_.first);_.takesLast=_.higherOrder(_.last);_.call=function(a){return a()};_.applies=function(a,b,c){return function(){return a.apply(b,c)}};_.prepends=function(a){return function(b){return a+b}};_.appends=function(a){return function(b){return b+a}};_.join=function(a,b){return a.join(b)};_.joinWith=_.flip2(_.join);_.joinsWith=_.higherOrder(_.joinWith);_.sum=function(a,b){return(a||0)+(b||0)};_.subtract=function(a,b){return(a||0)-(b||0)};
_.mul=function(a,b){return(a||0)*(b||0)};_.equal=function(a,b){return a===b};_.sums=_.plus=_.higherOrder(_.sum);_.subtracts=_.minus=_.higherOrder(_.subtract);_.muls=_.higherOrder(_.mul);_.equals=_.higherOrder(_.equal);_.less=function(a,b){return a<b};_.lessOrEqual=function(a,b){return a<=b};_.greater=function(a,b){return a>b};_.greaterOrEqual=function(a,b){return a>=b};_.isNegative=function(a){return 0>a};_.largest=function(a,b){return isNaN(a)&&isNaN(b)?NaN:isNaN(a)?b:isNaN(b)?a:Math.max(a,b)};
_.notZero=function(a){return 0!==a};_.propertyOf=function(a){return function(b){return a[b]}};_.isInstanceofSyntaxAvailable=function(){var a=Error();try{return a instanceof Error}catch(b){return!1}};_.isTypeOf_ES4=function(a,b){for(;b;){if(b.constructor===a)return!0;b=b.constructor.$base}return!1};_.isTypeOf_ES5=function(a,b){return b instanceof a};_.isTypeOf=_.isInstanceofSyntaxAvailable()?_.isTypeOf_ES5:_.isTypeOf_ES4;_.isPrototypeInstance=function(a){return a&&a.constructor&&_.isPrototypeConstructor(a.constructor)};
_.isPrototypeConstructor=function(a){return a&&void 0!==a.$definition||!1};_.coerceToArray=function(a){return void 0===a?[]:_.isArray(a)?a:[a]};$overrideUnderscore("isArray",function(a){return function(b){return _.isTypeOf(Array,b)||a(b)}});
_.mixin({matches:function(a){return 0===arguments.length&&_.constant(!0)||_.tails2(_.match,a)},match:function(a,b){return a===b||_.isArray(a)&&_.isArray(b)&&_.arrayMatch(a,b)||_.isObject(a)&&_.isObject(b)&&_.objectMatch(a,b)||_.isTypeOf(RegExp,b)&&_.isString(a)&&null!==a.match(b)},arrayMatch:function(a,b){return _.every(b,_.propertyOf(_.index(a)))},objectMatch:function(a,b){return _.reduce(_.pairs(b),function(b,d){return b&&_.match(a[d[0]],d[1])},!0)}});
_.extend(_,{isNonPOD:function(a){return a&&a.constructor&&a.constructor!==Object&&a.constructor!==Array&&a.constructor!==String&&a.constructor!==Number&&a.constructor!==Boolean},isPOD:function(a){return!_.isNonPOD(a)}});"undefined"===typeof Number.EPSILON&&Object.defineProperty(Number,"EPSILON",{enumerable:!0,get:_.constant(2.220446049250313E-16)});_.extend(_,{isDecimal:function(a,b){return!_.isNumber(a)||_.isNaN(a)?!1:Math.abs(Math.floor(a)-a)>(b||Number.EPSILON)}});
_.extend(_,{isEmpty:function(a){return void 0===_.coerceToUndefined(a)},isNonempty:function(a){return void 0!==_.coerceToUndefined(a)},isEmptyObject:function(a){return!_.isArray(a)&&!_.isFunction(a)&&_.isObject(a)&&0===_.keys(a).length},isStrictlyObject:function(a){return a&&"object"===typeof a?!0:!1},isEmptyArray:function(a){return _.isArray(a)&&0===a.length},isNonemptyString:function(a){return"string"===typeof a&&0<a.length},coerceToObject:function(a){return _.isStrictlyObject(a)?a:{}},coerceToEmpty:function(a){if(_.isArray(a))return[];
if(_.isStrictlyObject(a))return{}},coerceToUndefined:function(a){return void 0===a||null===a||a===Math.NaN||""===a||_.isPOD(a)&&(_.isEmptyObject(a)||0===a.length)?void 0:a}});_.json=function(a){if("string"===typeof a)try{return JSON.parse(a)}catch(b){return{}}else return JSON.stringify(a)};_.stringify=function(a,b){return _.stringifyImpl(a,[],[],0,b||{},-1)};
_.stringifyImpl=function(a,b,c,d,e,g){var f=e.formatter&&e.formatter(a);if(f)return f;"undefined"!==typeof jQuery&&_.isTypeOf(jQuery,a)&&(a=_.asArray(a));if(a===$global)return"$global";if(0<=b.indexOf(a))return e.pure?void 0:"<cyclic>";if(0<=c.indexOf(a))return e.pure?void 0:"<ref:"+c.indexOf(a)+">";if(void 0===a)return"undefined";if(null===a)return"null";if(_.isFunction(a))return e.pure?a.toString():_.isPrototypeConstructor(a)?"<prototype>":"<function>";if("string"===typeof a)return _.quoteWith('"',
a);if(_.isTypeOf(Tags,a))return _.reduce(_.keys(Tags.get(a)),function(a,b){return b+" "+a.quote("()")},_.stringifyImpl($untag(a),b,c,d+1,e,l));if(!e.pure&&_.hasOOP&&_.isPrototypeInstance(a)&&$prototype.defines(a.constructor,"toString"))return a.toString();if(!_.isObject(a)||"undefined"!==typeof $atom&&$atom.is(a))return _.isDecimal(a)&&0<e.precision?_.toFixed(a,e.precision):a+"";var h=_.isArray(a),f=e.pretty||!1;if("browser"===_.platform().engine){if(_.isTypeOf(Element,a))return"<"+a.tagName.lowercase+
">";if(_.isTypeOf(Text,a))return"@"+a.wholeText}if(a.toJSON)return _.quoteWith('"',a.toJSON());if(!e.pure&&(d>(e.maxDepth||5)||h&&a.length>(e.maxArrayLength||30)))return h?"<array["+a.length+"]>":"<object>";var k=b.concat([a]);c.push(a);b=_.pairs(a);var m=!f||2>b.length,l=g+1,n=m?"":"\t".repeats(l);if(f&&!h){var p=_.reduce(_.map(_.keys(a),_.count),_.largest,0);b=_.map(b,function(a){return[a[0],a[1]," ".repeats(p-a[0].length)]})}return _.quoteWith(h?m?"[]":"[\n  ]":m?"{  }":"{\n  }",_.joinWith(m?", ":
",\n",_.map(b,function(a){return n+(h?"":a[0]+": "+(a[2]||""))+_.stringifyImpl(a[1],k,c,d+1,e,l)})))};_.toFixed=function(a,b){return a&&a.toFixed&&a.toFixed(b)||void 0};_.toFixed2=function(a){return _.toFixed(a,2)};_.toFixed3=function(a){return _.toFixed(a,3)};_.hasStdlib=!0;_.extend(_,{throwsError:function(a){return function(){throw Error(a);}}});_.overrideThis=_.throwsError("override this");_.notImplemented=_.throwsError("not implemented");
_.mixin({tryEval:function(a,b,c){var d=void 0;try{d=a()}catch(e){d=b&&b(e)}return c?c(d):d}});_.mixin({values2:function(a){return _.isArray(a)?a:_.isStrictlyObject(a)?_.values(a):_.isEmpty(a)?[]:[a]}});_.mixin({map2:function(a,b,c){return _.isArray(a)?_.map(a,b,c):_.isStrictlyObject(a)?_.mapObject(a,b,c):b.call(c,a)}});_.mixin({mapMap:_.hyperOperator(_.unary,_.map2)});
_.mixin({reject2:function(a,b){return _.filter2(a,_.not(b))},filter2:function(a,b){if(_.isArray(a)){for(var c=[],d=0,e=a.length;d<e;d++){var g=a[d],f=b(g,d);!0===f?c.push(g):!1!==f&&c.push(f)}return c}if(_.isStrictlyObject(a))return c={},_.each(Object.keys(a),function(d){var e=a[d],g=b(e,d);!0===g?c[d]=e:!1!==g&&(c[d]=g)}),c;f=b(a);if(!0===f)return a;if(!1!==f)return f}});_.mixin({filterFilter:_.hyperOperator(_.unary,_.filter2)});
_.reduce2=function(a,b,c){var d=_.last(arguments),e=function(a,b){var c=void 0!==b,e=c?d(a,b):a;return void 0===e?c?b:a:e};if(_.isArray(a))for(var g=0,f=a.length;g<f;g++)b=e(a[g],b);else _.isStrictlyObject(a)?_.each(Object.keys(a),function(c){b=e(a[c],b)}):b=e(a,b);return b};_.reduceReduce=function(a,b,c){return _.hyperOperator(_.binary,_.reduce2,_.goDeeperAlwaysIfPossible)(b,a,c.flip2)};
_.mixin({zipObjectsWith:function(a,b){return _.reduce(_.rest(a),function(a,d){_.each(_.union(_.keys(d),_.keys(a)),function(e){var g=b(a&&a[e],d&&d[e]);void 0===g?delete a[e]:a[e]=g});return a},_.clone(a[0]))},zip2:function(a,b){var c=2===arguments.length?a:_.initial(arguments),d=2===arguments.length?b:_.last(arguments);return _.isArray(c)&&0!==c.length?_.isArray(c[0])?_.zipWith(c,d):_.isStrictlyObject(c[0])?_.zipObjectsWith(c,d):_.reduce(c,d):c}});_.mixin({zipZip:_.hyperOperator(_.binary,_.zip2)});
_.findFind=function(a,b){return _.hyperOperator(_.unary,function(a,d){if(_.isArray(a))for(var e=0,g=a.length;e<g;e++){var f=d(a[e]);if("boolean"!==typeof f)return f;if(!0===f)return a[e]}else if(_.isStrictlyObject(a))for(var e=0,h=Object.keys(a),g=h.length;e<g;e++){var k=h[e],f=d(a[k]);if("boolean"!==typeof f)return f;if(!0===f)return a[k]}f=b(a);return"boolean"!==typeof f?f:!0===f?a:!1})(a,b)};_.extend=$restArg(_.extend);_.extendWith=_.flip(_.extend);_.extendsWith=_.flip(_.partial(_.partial,_.flip(_.extend)));
_.extend2=$restArg(function(a){return _.extend(a,_.reduceRight(arguments,function(a,c){return _.object(_.map(_.union(_.keys(c),_.keys(a)),function(d){var e=c[d];return[d,d in a?"object"===typeof e?_.extend(e,a[d]):a[d]:e]}))},{}))});_.nonempty=function(a){return _.filter2(a,_.isNonempty)};_.extend(_,{cloneDeep:_.tails2(_.mapMap,_.clone)});_.hyperMatch=_.hyperOperator(_.binary,function(a,b,c){return _.coerceToUndefined(_.nonempty(_.zip2(a,b,c)))});
_.diff=_.tails3(_.hyperMatch,function(a,b){return $atom.unwrap(a)===$atom.unwrap(b)||a===$any||b===$any?void 0:b});_.hyperMatch=_.hyperOperator(_.binary,function(a,b,c){return _.coerceToUndefined(_.zip2(a,b,c))});_.undiff=_.tails3(_.hyperMatch,function(a,b){return $atom.unwrap(a)===$atom.unwrap(b)||a===$any||b===$any?b:void 0});_.extend(_,{index:function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}});
_.quote=function(a,b){var c=b||'"',d=Math.floor(c.length/2+c.length%2),e=c.slice(0,d),c=c.slice(d)||e;return e+a+c};_.quoteWith=_.flip2(_.quote);_.quotesWith=_.higherOrder(_.quoteWith);_.partition2=function(a,b){var c=void 0,d=[],e=[];_.each(a,function(a){var f=b(a);c!=f&&e.length&&(d.push(e),e=[]);e.push(a);c=f});e.length&&d.push(e);return d};_.key=function(a){return function(b,c){return a(c)}};_.filterKeys=function(a,b){return _.filter(a,function(a,d){return b(d)})};
_.rejectKeys=function(a,b){return _.reject(a,function(a,d){return b(d)})};_.pickKeys=function(a,b){return _.pick(a,function(a,d){return b(d)})};_.omitKeys=function(a,b){return _.omit(a,function(a,d){return b(d)})};
_.extend(_,{defineProperty:function(a,b,c,d){if(Object.hasOwnProperty(a,b))throw Error("_.defineProperty: targetObject already has property "+b);Object.defineProperty(a,b,_.extend({enumerable:!0},d,_.coerceToPropertyDefinition(c,b)))},defineHiddenProperty:function(a,b,c,d){return _.defineProperty(a,b,c,_.extend({enumerable:!1},d))},defineMemoizedProperty:function(a,b,c,d){c=_.coerceToPropertyDefinition(c,b);return _.defineProperty(a,b,_.extend({},c,{get:_.memoizeToThis("_"+b,c.get)}),d)},defineProperties:function(a,
b){_.each(b,_.defineProperty.partial(a).flip2)},memoizeToThis:function(a,b){return function(){var c=this[a];return void 0!==c?c:this[a]=b.call(this)}},coerceToPropertyDefinition:function(a,b){var c=a||{},d="undefined"===typeof Tags?a:Tags.unwrap(a);return!c.$constant&&!c.$get&&_.isPropertyDefinition(d)&&d||(c.$get||!c.$constant&&_.isFunction(d)&&_.noArgs(d))&&{get:d,set:_.throwsError("cannot change "+(b||"property")+" (as it's an accessor function)")}||!c.$get&&{get:_.constant(d),set:_.throwsError("cannot change "+
(b||"property")+" (as it's sealed to "+d+")")}||_.throwsError("coerceToPropertyDefinition: crazy input, unable to match")()},isPropertyDefinition:function(a){return _.isObject(a)&&(_.isFunction(a.get)||_.isFunction(a.set))},ownProperties:function(a){return a&&_.pickKeys(a,a.hasOwnProperty.bind(a))||{}}});_.hasTags=!0;
Tags=_.extend2(function(a){void 0!==a&&(this.subject=a)},{$definition:{},prototype:{add:function(a,b){return this[_.keyword(a)]=b||!0,this},clone:function(a){return _.extend(new Tags(a||this.subject),_.pick(this,_.keyIsKeyword))},modifySubject:function(a){this.subject=a(this.subject);return _.isTypeOf(Tags,this.subject)?_.extend(this.subject,_.pick(this,_.keyIsKeyword)):this}},clone:function(a,b){return _.isTypeOf(Tags,a)?a.clone(b):b||a},get:function(a){return _.isTypeOf(Tags,a)?_.pick(a,_.keyIsKeyword):
{}},hasSubject:function(a){return _.isTypeOf(Tags,a)&&"subject"in a},matches:function(a){return function(b){return b&&void 0!==b[_.keyword(a)]}},unwrapAll:function(a){return _.map2(a,Tags.unwrap)},unwrap:function(a){return _.isTypeOf(Tags,a)?a.subject:a},wrap:function(a){return _.isTypeOf(Tags,a)?a:0===arguments.length?new Tags:new Tags(a)},modifySubject:function(a,b){return _.isTypeOf(Tags,a)?a.clone().modifySubject(b):b(a)},map:function(a,b){return Tags.modifySubject(a,function(a){return _.map2(a,
function(a,c){return Tags.modifySubject(a,function(g){return b(g,c,_.isTypeOf(Tags,a)?a:void 0)})})})},add:function(a,b,c){return Tags.wrap.apply(null,_.rest(arguments,1)).add(a,c)}});_.keyword=function(a){return"$"+a};_.isKeyword=function(a){return"$"==a[0]};_.keywordName=function(a){return _.isKeyword(a)?a.slice(1):a};_.keywords=function(a){return _.pick(a,_.keyIsKeyword)};_.tagKeywords={};_.isTagKeyword=function(a){return _.keywordName(a)in _.tagKeywords};_.keyIsKeyword=function(a,b){return _.isKeyword(b[0])};
_.defineKeyword=function(a,b){_.defineProperty(_.global(),_.keyword(a),b)};_.defineKeyword("global",_.global);_.defineKeyword("platform",_.platform);_.defineKeyword("untag",Tags.unwrap);
_.defineTagKeyword=function(a,b){b=_.isFunction(b)&&b||_.identity;_.keyword(a)in $global||(_.defineKeyword(a,Tags.add("constant",_.extendWith({matches:Tags.matches(a)},b(function(b,c){return 2>arguments.length?Tags.add(a,b):Tags.add(a,c,b)})))),_.tagKeywords[a]=!0);var c=_.keyword(a);return _.extend($global[c],{is:function(a){return _.isTypeOf(Tags,a)&&c in a||!1},isNot:function(a){return!(_.isTypeOf(Tags,a)&&c in a)||!1},unwrap:function(a){return!0===$atom.matches(a)?Tags.unwrap(a):a}})};
_(["constant","get","once","async"]).each(_.defineTagKeyword);_.defineModifierKeyword=function(a,b){_.defineKeyword(a,function(a){return Tags.modifySubject(a,b)})};_.deleteKeyword=function(a){delete $global[_.keyword(a)]};_.defineTagKeyword("required");_.defineTagKeyword("atom");_.defineKeyword("any",_.identity);
(function(){_.isMeta=function(a){return a===$any||!0===$atom.is(a)||!0===$required.is(a)};var a=function(a,b,c){var d=Tags.unwrapAll(_.filter2(a,$required.matches));a=_.nonempty(_.zip2(Tags.unwrapAll(a),b,c));if(_.isEmpty(d))return a;c=_.nonempty(_.zip2(d,b,c));return _.values2(d).length===_.values2(c).length?a:_.coerceToEmpty(b)},b=_.hyperOperator(_.binary,function(b,c,d){var h=Tags.unwrap(b);if(_.isArray(h)){if(_.isArray(c))return a(_.times(c.length,_.constant(h[0])),c,d)}else if(_.isStrictlyObject(h)&&
h["*"]){if(_.isStrictlyObject(c))return a(_.extend(_.map2(c,_.constant(h["*"])),_.omit(h,"*")),c,d)}else return a(b,c,d)}),c=function(a,b){var c=Tags.unwrap(a);return void 0===c&&void 0===b||_.isFunction(c)&&(_.isPrototypeConstructor(c)?_.isTypeOf(c,b):c(b))||typeof b===c||b===c};_.mismatches=function(a,c,d){return b(c,d,function(b,c){return a(b,c)?void 0:b})};_.omitMismatches=function(a,c,d){return b(c,d,function(b,c){return a(b,c)?c:void 0})};_.typeMismatches=_.partial(_.mismatches,c);_.omitTypeMismatches=
_.partial(_.omitMismatches,c);_.valueMismatches=_.partial(_.mismatches,function(a,b){return a===$any||b===$any||a===b});var d=function(a){if(_.isArray(a))return _.nonempty([_.reduce(_.rest(a),function(a,b){return _.undiff(a,b)},_.first(a)||void 0)]);if(_.isStrictlyObject(a)){var b=_.pairs(a),b=_.map(_.reduce(_.rest(b),function(a,b){return _.undiff(a,b)},_.first(b)||[void 0,void 0]),_.nonempty);return _.isEmpty(b)||_.isEmpty(b[1])?a:_.object([[b[0]||"*",b[1]]])}return a};_.decideType=function(a){return _.hyperOperator(_.unary,
function(a,b){return a&&a.constructor&&a.constructor.$definition?a.constructor:d(_.map2(a,b))})(a,function(a){return _.isPrototypeInstance(a)?a.constructor:_.isEmptyArray(a)?a:typeof a})}})();_.cps=function(){return _.cps.sequence.apply(null,arguments)};_.cps.apply=function(a,b,c,d){c=_.asArray(c);var e=_.numArgs(a)-1,g=c[e];c[e]=function(){d.call(this,arguments,g)};return a.apply(b,c)};
_.extend(_.cps,{each:function(a,b,c,d,e,g){var f=arguments.callee,h=d||0,k=0===h?void 0===a.length?_.keys(a):void 0:g,m=0===h?k?k.length:a.length:e,l=2!==_.numArgs(b);if(!a||h>=(m||0))c&&c();else{var n=k?k[h]:h,p=function(){f(a,b,c,h+1,m,k)};l?b(a[n],n,p,c,a):b(a[n],p,c,a)}}});_.extend(_.cps,{map:function(a,b,c){var d=_.isArray(a)?[]:{};_.cps.each(a,2==_.numArgs(b)?function(a,c,f){b(a,function(a){d[c]=a;f()})}:function(a,c,f){b(a,c,function(a){d[c]=a;f()})},function(){c(d)})}});
_.extend(_.cps,{find:function(a,b,c){var d=2!==_.numArgs(b);_.cps.each(a,function(a,c,f,h){var k=function(b){!1===b?f():h(!0===b?a:b,c)};d?b(a,c,k):b(a,k)},c)}});
_.extend(_.cps,{memoize:function(a){return _.barrier?_.cps._betterMemoize(a):_.cps._poorMemoize(a)},_poorMemoize:function(a){var b={};return function(c,d){c in b?d(b[c]):a.call(this,c,function(a){d(b[c]=a)})}},_betterMemoize:function(a){var b={};switch(_.numArgs(a)){case 1:return function(c){b.already||a.call(this,b=_.barrier());b(c)};case 2:return b={},function(c,d){c in b||a.call(this,c,b[c]=_.barrier());b[c](d)};default:throw Error("_.cps.memoize: unsupported number of arguments");}}});
(function(){var a=function(b,c,d,e,g){!b||g>=(b.length||0)?d(e):c(e,b[g],function(e){a(b,c,d,e,g+1)})};_.cps.reduce=function(b,c,d,e){4>arguments.length?a(b,c,d,b[0],1):a(b,c,d,e,0)}})();_.extend(_.cps,{noop:$restArg(function(){return _.last(arguments).call(this)}),identity:$restArg(function(){var a=_.initial(arguments),b=_.last(arguments);if(b)return b.apply(this,a)}),constant:$restArg(function(){var a=arguments;return function(){return _.last(arguments).apply(this,a)}})});
_.cps.arity0=function(a){return function(){a.call(this,_.last(arguments))}};_.cps.arity1=function(a){return function(){a.call(this,arguments[0],_.last(arguments))}};_.cps.arity2=function(a){return function(){a.call(this,arguments[0],arguments[1],_.last(arguments))}};_.cps.transformResult=function(a,b){return function(c){b.apply(this,_.initial(arguments).concat(a(_.last(arguments))))}};_.cps.resultArity2=_.partial(_.cps.transformResult,_.arity2);_.cps.resultArity1=_.partial(_.cps.transformResult,_.arity1);
_.cps.resultArity0=_.partial(_.cps.transformResult,_.arity0);_.cps.sequence=$restArg(function(a){var b=_.isArray(a)&&a||_.asArray(arguments);return _.reduceRight(b,function(a,b){return function(){return b.apply(this,_.asArray(arguments).concat(a))}},_.cps.identity)});_.cps.compose=$restArg(function(a){var b=_.isArray(a)&&a||_.asArray(arguments);return _.cps.sequence(b.slice().reverse())});
_.cps.trySequence=function(a,b,c){_.reduceRight(a,function(a,e){return function(g){if(_.isTypeOf(Error,g))return(c||b)(g);try{return e.apply(this,_.asArray(arguments).concat(a))}catch(f){return(c||b)(f)}}},b)()};_(["method","property","flipped"]).each(_.defineTagKeyword);
$extensionMethods=function(a,b){_.each(b,function(b,d){var e=Tags.unwrap(b);d in _||(_[d]=_[d]||e);if(b.$method||!b.$property&&!_.oneArg(e)){if(b.$property)throw Error("$extensionMethods: crazy input, unable to match");d in a.prototype||(a.prototype[d]=_.asMethod(b.$flipped?_.flip(e):e))}else d in a.prototype||_.defineHiddenProperty(a.prototype,d,function(){return e(this)})})};
$extensionMethods(Function,{bind:_.bind,partial:_.partial,tails:_.tails,tails2:_.tails2,tails3:_.tails3,compose:_.compose,then:_.then,flip:_.flip,flip2:_.flip2,flip3:_.flip3,asFreeFunction:_.asFreeFunction,asMethod:_.asMethod,asContinuation:function(a){return $restArg(function(){_.last(arguments)(a.apply(this,_.initial(arguments)))})},wraps:function(a,b){a._wrapped=_.withSameArgs(a,b);return a},wrapped:function(a){return a._wrapped||a},original:function(a){for(;a&&a._wrapped;)a=a._wrapped;return a},
arity0:_.arity0,arity1:_.arity1,arity2:_.arity2,arity3:_.arity3,or:_.or,and:_.and,not:_.not,applies:_.applies,oneShot:function(a){var b=!1;return function(){if(!b)return b=!0,a.apply(this,arguments)}},memoized:_.memoize,throttled:_.throttle,debounced:function(a,b,c){var d,e,g,f,h,k=function(){var l=Date.now()-d;l<b&&0<l?e=setTimeout(k,b-l):(e=null,c||(g=a.apply(h,f),e||(h=f=null)))},m=function(){h=this;f=arguments;d=Date.now();var l=c&&!e;e||(e=setTimeout(k,b));l&&(g=a.apply(h,f),h=f=null);return g};
m.cancel=function(){e&&(clearTimeout(e),e=null)};m.callImmediately=function(){m.cancel();a.apply(h,f)};return m},postpone:$method(function(a){a.postponed.apply(null,arguments)}),postponed:function(a){return function(){var b=arguments;a._postponed||(a._postponed=!0,_.delay(function(){a._postponed=!1;a.apply(this,b)}))}},delay:_.delay,delayed:function(a,b){return function(){var c=arguments,d=this;_.delay(function(){a.apply(d,c)},b)}}});
$extensionMethods(Array,{each:_.each,map:_.map,reduce:_.reduce,reduceRight:_.reduceRight,zip:_.zipWith,filter:_.filter,isEmpty:function(a){return 0===a.length},notEmpty:function(a){return 0<a.length},lastIndex:function(a){return a.length-1},last:function(a){return _.last(a)},random:function(a){return a[_.random(0,a.lastIndex)]},copy:function(a){return a.slice(0)},removeAll:$method(function(a){return a.splice(0,a.length),a}),remove:function(a,b){for(var c;-1!==(c=a.indexOf(b));)a.splice(c,1);return a},
removeAt:function(a,b){a.splice(b,1);return a},insertAt:function(a,b,c){a.splice(c,0,b);return a},itemAtWrappedIndex:function(a,b){return a[b%a.length]},reversed:function(a){return a.slice().reverse()},flat:function(a){return _.flatten(a,!0)},swap:$method(function(a,b,c){var d=a[b];a[b]=a[c];a[c]=d;return a})});_.zap=function(a){var b=_.last(arguments);return _.reduce(_.rest(_.initial(arguments)),function(a,d){return _.times(Math.max(a.length,d.length),function(e){return b(a[e],d[e])})},a)};
$extensionMethods(String,{quote:_.quote,cut:function(a,b){return a.substring(0,b-1)+a.substring(b,a.length)},insert:function(a,b,c){return a.substring(0,b)+c+a.substring(b,a.length)},lowercase:function(a){return a.toLowerCase()},uppercase:function(a){return a.toUpperCase()},trimmed:function(a){return a.trim()},escaped:function(a){return _.escape(a)},repeats:function(a,b){return _.times(b,_.constant(a)).join("")},prepend:function(a,b){return b+a},append:function(a,b){return a+b},first:function(a,b){return _.first(a,
b).join("")},last:function(a,b){return _.last(a,b).join("")},reversed:function(a){return a.split("").reverse().join("")},capitalized:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},decapitalized:function(a){return a.charAt(0).toLowerCase()+a.slice(1)},latinAlphanumericValue:function(a){return a.replace(/[^a-z0-9]/gi,"")},alphanumericValue:function(a){return a.replace(unicode_hack(/[^0-9\p{L}|^0-9\p{N}|^0-9\p{Pc}|^0-9\p{M}]/g),"")},numericValue:function(a){return a.replace(/[^0-9]/g,"")},
integerValue:function(a){return a.numericValue.parsedInt},parsedInt:function(a){a=parseInt(a,10);return _.isFinite(a)?a:void 0},bytes:function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b},hash:function(a){var b=0,c,d,e;if(0===a.length)return b;c=0;for(e=a.length;c<e;c++)d=a.charCodeAt(c),b=(b<<5)-b+d,b|=0;return b},transliterate:function(){var a=_.extend({"\u0430":"a","\u0431":"b","\u0432":"v","\u0433":"g","\u0434":"d","\u0435":"e","\u0451":"yo","\u0436":"zh",
"\u0437":"z","\u0438":"i","\u0439":"y","\u043a":"k","\u043b":"l","\u043c":"m","\u043d":"n","\u043e":"o","\u043f":"p","\u0440":"r","\u0441":"s","\u0442":"t","\u0443":"u","\u0444":"ph","\u0445":"h","\u0446":"ts","\u0447":"ch","\u0448":"sh","\u0449":"sch","\u044c":"","\u044a":"","\u044b":"y","\u044d":"e","\u044e":"yu","\u044f":"ya"},_.object(_.map("_-1234567890qwertyuiopasdfghjklzxcvbnm",function(a){return[a,a]})));return function(b){var c="";b=(b||"").toLowerCase();for(var d=0,e=b.length;d<e;d++)c+=
a[b[d]]||"";return c}}(),fixedEncodeURIComponent:function(a,b){return encodeURIComponent(a).replace(b?b:/[!'().,*-]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}});
(function(){var a=["onceBefore","onceAfter","onBefore","onAfter","intercept"],b=function(b){return _.extend({},b,{_bindable:!0,impl:b,_wrapped:b},_.object(_.map(a,function(a){var b="_"+a,c=0<=a.indexOf("once");return[a,function(a){if(!_.isBindable(this))throw Error("wrong this");var d=this[b];(!c||0>d.indexOf(a))&&this[b].push(a);return this}]})),_.object(_.map(a,function(a){return["_"+a,[]]})))};_.extend(_,_.mapObject(_.invert(a),function(a){return function(b,e,g){var f=b[e];b=_.isBindable(f)?f:
b[e]=_.bindable(f);return b[a].call(b,g)}}.flip2),{off:function(b,d,e){var g=b[d];_.isBindable(g)&&_.each(a,function(a){g["_"+a]=_.without(g["_"+a],e)})},isBindable:function(a){return a&&a._bindable?!0:!1},bindable:_.extendWith({hooks:a,hooksShort:["onceBefore","onceAfter","before","after",""]},function(a,d){return _.withSameArgs(a,_.extendWith(b(a),function(){var b=arguments.callee,g=b._onceBefore,f=b._onceAfter,h=b._onBefore,k=b._onAfter,m=b._intercept,b=d||this,l,n=void 0;if(g.length){l=0;for(n=
g.length;l<n;l++)g[l].apply(b,arguments);g.removeAll()}l=0;for(n=h.length;l<n;l++)h[l].apply(b,arguments);g=(m.length?_.cps.compose([a].concat(m)):a).apply(b,arguments);if(k.length||f.length){h=_.asArray(arguments).concat(g);l=0;for(n=k.length;l<n;l++)k[l].apply(b,h);if(f.length){l=0;for(n=f.length;l<n;l++)f[l].apply(b,h);f.removeAll()}}return g}))})})})();
_.extend(_,{gatherChanges:function(a){var b=_.isArray(a)?a:_.initial(arguments),c=_.last(arguments),d=function(a){c.apply(this,_.pluck(b,"value"))};_.each(b,function(a){a(d)})},allTriggered:function(a,b){var c=[];0<a.length?_.each(a,function(d){d(function(){c=_.union(c,[d]);b&&c.length===a.length&&(b(),b=void 0)})}):b()},observableRef:function(a){return _.extend(_.observable.apply(this,arguments),{trackReference:!0})},observable:function(a){var b=_.stream({hasValue:0<arguments.length,value:a,read:_.identity,
read:function(a){return function(d){b.hasValue&&d.call(this,b.value);a.call(this,d)}},write:function(a){return function(d){b.beforeWrite&&(d=b.beforeWrite(d));if(!b.hasValue||(b.trackReference?b.value!==d:!_.isEqual(b.value,d))){var e=b.value,g=b.hasValue;b.hasValue=!0;b.value=d;g?a.call(this,!1,b.value,e):a.call(this,!1,b.value)}}}});arguments.length&&b.apply(this,arguments);return _.extend(b,{force:function(a){b.hasValue=!1;b(a||b.value)},when:function(a,d){var e=_.isFunction(a)?a:_.equals(a);b(function(a){e(a)&&
(b.off(arguments.callee),d(a))})}})},barrier:function(a){var b=void 0;_.isFunction(a)&&(b=a,a=void 0);var c=_.stream({already:void 0!==a,value:a,write:function(a){return function(b){c.already||(c.already=!0,c.value=b);a.call(this,!0,c.value)}},read:function(a){return function(b){c.already?b.call(this,c.value):a.call(this,b)}}});b&&c(b);return c},triggerOnce:$restArg(function(){var a=_.stream({read:function(b){return function(c){0>a.queue.indexOf(c)&&b.call(this,c)}},write:function(a){return a.partial(!0)}}).apply(this,
arguments);return a}),trigger:$restArg(function(){return _.stream({read:_.identity,write:function(a){return a.partial(!1)}}).apply(this,arguments)}),off:function(a,b){a.queue&&(1===arguments.length?a.queue.off():a.queue.off(b));a.queuedBy&&(_.each(a.queuedBy,function(b){b.remove(a)}),delete a.queuedBy)},stream:function(a){a=a||{};var b=_.extend([],{off:function(a){this.length&&(0===arguments.length?(_.each(this,function(a){a.queuedBy.remove(this)},this),this.removeAll()):a.queuedBy&&(a.queuedBy.remove(this),
this.remove(a)))}}),c=void 0,d=a.write(function(a,d){var e=_.rest(arguments),k=b.copy,m=c.context;a&&b.off();_.each(k,function(a){c.postpones?a.postponed.apply(this,e):a.apply(this,e)},m||this)}),e=a.read(function(a){0>b.indexOf(a)&&(a.queuedBy?a.queuedBy.push(b):a.queuedBy=[b],b.push(a))});return c=_.extend($restArg(function(a){_.isFunction(a)?e.call(this,a):d.apply(this,arguments);return arguments.callee}),a,{queue:b,once:function(a){_.find(b,function(b){return b.onceWrapped_===a})||e(_.extend(function(b){_.off(c,
arguments.callee);a(b)},{onceWrapped_:a}))},off:_.off.asMethod,read:e,write:d,postpone:function(){this.postponed.apply(c.context,arguments)}})}});_.hasOOP=!0;_("property static final alias memoized private builtin testArguments".split(" ")).each(_.defineTagKeyword);$prototype=function(a,b){return $prototype.impl.compile.apply($prototype.impl,1<arguments.length?_.asArray(arguments).reverse():arguments)};$extends=function(a,b){return $prototype(a,b||{})};
_.extend($prototype,{isConstructor:function(a){return _.isPrototypeConstructor(a)},macro:function(a,b){1===arguments.length?$prototype.impl.alwaysTriggeredMacros.push(a):$prototype.impl.memberNameTriggeredMacros[a]=b},macroTag:function(a,b){$prototype.impl.tagTriggeredMacros[_.keyword(a)]=b},each:function(a){var b=$global,c;for(c in b)if(!_.isKeyword(c)){var d=b[c];$prototype.isConstructor(d)&&a(d,c)}},defines:function(a,b){return _.find($prototype.inheritanceChain(a),function(a){return a.$definition&&
a.$definition.hasOwnProperty(b)||!1})?!0:!1},inheritanceChain:function(a){for(var b=[];a;)b.push(a),a=a.$base&&a.$base.constructor;return b},wrapMethods:function(a,b){return Tags.map(a,function(a,d,e){return _.isFunction(a)?b(a,d,e).wraps(a):a})},impl:{alwaysTriggeredMacros:[],memberNameTriggeredMacros:{},tagTriggeredMacros:{},compile:function(a,b){return(b&&b.$impl||this)._compile(a,b)},_compile:function(a,b){return Tags.unwrap(_.sequence(this.extendWithTags,this.flatten,this.generateCustomCompilerImpl(b),
this.generateArgumentContractsIfNeeded,this.ensureFinalContracts(b),this.generateConstructor(b),this.evalAlwaysTriggeredMacros(b),this.evalMemberTriggeredMacros(b),this.contributeTraits,this.generateBuiltInMembers(b),this.expandAliases,this.defineStaticMembers,this.defineInstanceMembers).call(this,a||{}).constructor)},evalAlwaysTriggeredMacros:function(a){return function(b){for(var c=$prototype.impl.alwaysTriggeredMacros,d=0,e=c.length;d<e;d++)b=c[d](b,a);return b}},evalMemberTriggeredMacros:function(a){return function(b){var c=
$prototype.impl.memberNameTriggeredMacros,d=$prototype.impl.tagTriggeredMacros;_.each(b,function(e,g){c.hasOwnProperty(g)&&(b=c[g](b,e,g,a));_.each(_.keys(e),function(c){d.hasOwnProperty(c)&&(b=d[c](b,e,g,a))})});return b}},generateCustomCompilerImpl:function(a){return function(b){b.$impl?(b.$impl.__proto__=a&&a.$impl||this,b.$impl=$static($builtin($property(b.$impl)))):a&&a.$impl&&(b.$impl=$static($builtin($property(a.$impl))));return b}},generateArgumentContractsIfNeeded:function(a){return a.$testArguments?
$prototype.wrapMethods(a,function(a,c){return function(){var d=_.asArray(arguments);$assertArguments(d.copy,a.original,c);return a.apply(this,d)}}):a},contributeTraits:function(a){if(a.$traits){var b=a.$traits;this.mergeTraitsMembers(a,b);a.$traits=$static($builtin($property(b)));a.hasTrait=$static($builtin(function(a){return 0<=b.indexOf(a)}))}return a},mergeTraitsMembers:function(a,b){_.each(b,function(b){_.defaults(a,_.omit(b.$definition,_.or($builtin.matches,_.key(_.equals("constructor")))))})},
extendWithTags:function(a){return _.extendWith(Tags.unwrap(a),_.mapObject(Tags.get(a),$static.arity1))},generateConstructor:function(a){return function(b){return _.extend(b,{constructor:Tags.modifySubject(b.hasOwnProperty("constructor")?b.constructor:this.defaultConstructor(a),function(b){a&&(b.prototype.__proto__=a.prototype);return b})})}},generateBuiltInMembers:function(a){return function(b){return _.defaults(b,{$base:$builtin($static($property(_.constant(a&&a.prototype)))),$definition:$builtin($static($property(_.constant(_.extend({},
a&&a.$definition,b))))),isTypeOf:$builtin($static(_.partial(_.isTypeOf,Tags.unwrap(b.constructor)))),isInstanceOf:$builtin(function(a){return _.isTypeOf(a,this)}),$:$builtin(function(a){return _.$.apply(null,[this].concat(_.asArray(arguments)))})})}},defaultConstructor:function(a){return a?function(){a.prototype.constructor.apply(this,arguments)}:function(a){_.extend(this,a||{})}},defineStaticMembers:function(a){this.defineMembers(Tags.unwrap(a.constructor),_.pick(a,$static.matches));return a},defineInstanceMembers:function(a){this.defineMembers(Tags.unwrap(a.constructor).prototype,
_.omit(a,$static.matches));return a},defineMembers:function(a,b){_.each(b,function(c,d){"constructor"!==d&&b.hasOwnProperty(d)&&this.defineMember(a,c,d)},this)},defineMember:function(a,b,c){b&&b.$property?b.$memoized?_.defineMemoizedProperty(a,c,b):_.defineProperty(a,c,b):(b=Tags.unwrap(b),a[c]=b)},ensureFinalContracts:function(a){return function(b){if(a){if(a.$final)throw Error("Cannot derive from $final-marked prototype");if(a.$definition){var c=_.intersection(_.keys(_.pick(a.$definition,$final.matches)),
_.keys(b));if(c.length)throw Error("Cannot override $final "+c.join(", "));}}return b}},expandAliases:function(a){return _.mapObject(a,function(b){var c=Tags.unwrap(b);return $alias.is(b)?$property.is(b)?$property({get:function(){return this[c]},set:function(a){this[c]=a}}):a[c]:b})},flatten:function(a){var b=_.pick(a,this.isTagKeywordGroup),b=_.object(_.flatten(_.map(b,function(a,b){return _.map(a,function(a,c){return[c,$global[b](a)]})}),!0));a=_.omit(a,this.isTagKeywordGroup);return _.extend(a,
b)},isTagKeywordGroup:function(a,b){var c=Tags.unwrap(a);return _.isKeyword(b)&&_.isFunction($global[b])&&"object"===typeof c&&!_.isArray(c)}}});_.isTraitOf=function(a,b){var c=b&&b.constructor;return c&&c.hasTrait&&c.hasTrait(a)||!1};_.isTypeOf=_.or(_.isTypeOf,_.isTraitOf);
$trait=function(a,b){var c=void 0,d=_.extend(1<arguments.length?b:a,{constructor:_.throwsError("Traits are not instantiable (what for?)"),isTraitOf:$static($builtin(function(a){return _.isTraitOf(c,a)}))});return c=$prototype.impl.compile(d,1<arguments.length?a:b)};_.$=function(a,b){return _.bind.apply(void 0,[b,a].concat(_.rest(arguments,2)))};"undefined"!==typeof jQuery&&jQuery.fn.extend({$:function(a){return _.$(this,a)}});_.defineKeyword("const",function(a){return $static($property(a))});
$singleton=function(a,b){return new ($prototype.apply(null,arguments))};Platform=$singleton({$property:{engine:_.platform().engine,system:_.platform().system,device:_.platform().device,touch:_.platform().touch||!1,IE:"IE"===_.platform().browser,Firefox:"Firefox"===_.platform().browser,Browser:"browser"===_.platform().engine,NodeJS:"node"===_.platform().engine,iPad:"iPad"===_.platform().device,iPhone:"iPhone"===_.platform().device,iOS:"iOS"===_.platform().system}});
Parse={keyCodeAsString:function(a){return String.fromCharCode(96<=a&&105>=a?a-48:a)},fileName:function(a){return _.first(_.last(a.split(/\\|\//)).split("."))},phoneNumber:function(a){a=a.numericValue;return a.length&&"8"===a[0]?"7"+a.slice(1):a},sqlDate:function(a){if(a){var b=a.split(" ");a=b[0].split("-");var b=1<b.length?b[1].split(":"):["0","0","0"],c=parseFloat(b[2]);return new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10),parseInt(b[0],10),parseInt(b[1],10),Math.floor(c),1E3*
(c-Math.floor(c)))}},timestampFromDateTimeString:function(a){if(a){var b=a.split(" ");a=b[0].split(".");b=1<b.length?b[1].split(":"):["0","0","0"];return(new Date((2<a[2].length?0:2E3)+parseInt(a[2],10),parseInt(a[1],10)-1,parseInt(a[0],10),parseInt(b[0],10),parseInt(b[1],10))).getTime()}}};
Format={javascript:function(a){return _.stringify(a,{pretty:!0,pure:!0,formatter:function(a){if(_.isTypeOf(Tags,a))return _.reduce(_.keys(_.pick(a,_.keyIsKeyword)),function(a,b){return b+" "+_.quote(a,"()")},_.stringify(Tags.unwrap(a)));if(_.isFunction(a))return a.toString()}})},progressPercents:function(a,b){return Math.floor(a/b*100)+"%"},randomHexString:function(a){for(var b="",c=0;c<a;c++)b+=Math.floor(16*Math.random()).toString(16);return b},leadingZero:function(a){return 10>a?"0"+a:a.toString()},
plural:function(a,b,c,d){_.isArray(b)&&(d=b[2],c=b[1],b=b[0]);b=[d,b,c,c,c,d];return a+" "+(4<a%100&&20>a%100?d:b[Math.min(a%10,5)])}};
Sort={Ascending:1,Descending:-1,strings:function(a,b){a=$.trim(a).toLowerCase();b=$.trim(b).toLowerCase();return 0==a.length&&0<b.length?1:0<a.length&&0==b.length?-1:a==b?0:a<b?-1:1},numbers:function(a,b){return isNaN(a)&&isNaN(b)?0:isNaN(a)?-1:isNaN(b)?1:a<b?-1:a>b?1:0},generic:function(a,b){return a||b?a?b?a<b?-1:a>b?1:0:1:-1:0},inverse:function(a){return function(b,c){return-a(b,c)}},field:function(a,b,c){return function(d,e){return b(d[a],e[a])*c}}};_.enumerate=_.cps.each;
_.mapReduce=function(a,b){var c=0,d=!1,e=a&&a.length||0,g=b.maxConcurrency||e,f=0,h=b.memo;if(0===e)b.complete(b.memo||a);else{var k=function(){for(;c<e&&f<g;)f+=1,b.next(a[c],c++,function(){f--;d||(c>=e?0===f&&(setTimeout(function(){b.complete(b.memo||a)},0),d=!0):k())},function(){f--},h);!d&&c>=e&&0==f&&b.complete(b.memo||a)};k()}};_.asyncJoin=function(a,b,c){_.mapReduce(a,{complete:b.bind(c),next:function(a,b,g,f){a.call(c,g,f)}})};
Lock=$prototype({acquire:function(a){this.wait(this.$(function(){this.waitQueue||(this.waitQueue=[]);a()}))},acquired:function(){return void 0!==this.waitQueue},wait:function(a){this.acquired()?this.waitQueue.push(a):a()},release:function(){if(this.waitQueue.length){var a=_.first(this.waitQueue);this.waitQueue=_.rest(this.waitQueue);a()}else delete this.waitQueue}});_.defineKeyword("interlocked",function(a){var b=new Lock;return _.extendWith({wait:b.$(b.wait)},_.prependsArguments(Tags.unwrap(a),function(a){b.acquire(function(){a(b.$(b.release))})}))});
_.defineKeyword("scope",function(a){var b=void 0;return _.prependsArguments(Tags.unwrap(a),function(a){var d={when:void 0};(b=b||[]).push(d);a(function(a){if(d.when)throw Error("$scope: release called twice");for(d.when=a;b&&b.last&&b.last.when;)a=b.last.when,(b=_.initial(b)).isEmpty&&(b=void 0),a()})})});Platform.NodeJS&&(module.exports=_);_.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};_.lerp=function(a,b,c){return b+(c-b)*a};
_.rescale=function(a,b,c,d){a=(a-b[0])/(b[1]-b[0]);return _.lerp(d&&d.clamp?_.clamp(a,0,1):a,c[0],c[1])};_.sqr=function(a){return a*a};Math.sign||(Math.sign=function(a){return 0>a?-1:0<a?1:0});Intersect={rayCircle:function(a,b,c,d){var e=a.sub(c);c=b.dot(b);var g=2*e.dot(b);d=e.dot(e)-d*d;e=g*g-4*c*d;if(!(0>e)){e=Math.sqrt(e);d=(-g-e)/(2*c);c=(-g+e)/(2*c);if(0<=d&&1>=d)return{time:d,where:a.add(b.scale(d))};if(0<=c&&1>=c)return{time:c,where:a.add(b.scale(c)),insideOut:!0}}}};
Vec2=$prototype({$static:{xx:function(a){return new Vec2(a,a)},xy:function(a,b){return new Vec2(a,b)},x:function(a){return new Vec2(a,0)},y:function(a){return new Vec2(0,a)},zero:$property(function(){return new Vec2(0,0)}),unit:$property(function(){return new Vec2(1,1)}),one:$alias("unit"),lt:$alias("fromLT"),wh:$alias("fromWH"),fromLT:function(a){return new Vec2(a.left,a.top)},fromWH:function(a){return new Vec2(a.width,a.height)},fromLeftTop:$alias("fromLT"),fromWidthHeight:$alias("fromWH"),lerp:function(a,
b,c){return new Vec2(_.lerp(a,b.x,c.x),_.lerp(a,b.y,c.y))},clamp:function(a,b,c){return new Vec2(_.clamp(a.x,b.x,c.x),_.clamp(a.y,b.y,c.y))}},constructor:function(a,b){1===arguments.length?_.isNumber(a)?this.x=this.y=a:(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)},w:$alias($property("x")),h:$alias($property("y")),length:$property(function(){return Math.sqrt(this.lengthSquared)}),lengthSquared:$property(function(){return this.x*this.x+this.y*this.y}),distance:function(a){return this.sub(a).length},
aspect:$property(function(){return this.x/this.y}),add:function(a,b){return void 0===b?"number"===typeof a?new Vec2(this.x+a,this.y+a):new Vec2(this.x+a.x,this.y+a.y):new Vec2(this.x+a,this.y+b)},dot:function(a){return this.x*a.x+this.y*a.y},sub:function(a){return new Vec2(this.x-a.x,this.y-a.y)},scale:function(a,b){return new Vec2(this.x*a,this.y*(void 0===b?a:b))},mul:function(a){return new Vec2(this.x*a.x,this.y*a.y)},divide:function(a){return new Vec2(this.x/a.x,this.y/a.y)},normal:$property(function(){return this.scale(1/
this.length)}),perp:$property(function(){return new Vec2(this.y,-this.x)}),half:$property(function(){return new Vec2(.5*this.x,.5*this.y)}),inverse:$property(function(){return new Vec2(-this.x,-this.y)}),asArray:$property(function(){return[this.x,this.y]}),asLeftTop:$property(function(){return{left:this.x,top:this.y}}),asLeftTopMargin:$property(function(){return{marginLeft:this.x,marginTop:this.y}}),asWidthHeight:$property(function(){return{width:this.x,height:this.y}}),asTranslate:$property(function(){return"translate("+
this.x+" "+this.y+")"}),separatedWith:function(a){return this.x+a+this.y},floor:$property(function(){return new Vec2(Math.floor(this.x),Math.floor(this.y))}),sum:$static(function(a){return _.reduce(_.isArray(a)&&a||_.asArray(arguments),function(a,c){return a.add(c||Vec2.zero)},Vec2.zero)}),toString:function(){return"{"+this.x+","+this.y+"}"},projectOnCircle:function(a,b){return a.add(this.sub(a).normal.scale(b))},projectOnLineSegment:function(a,b){var c=b.sub(a),d=c.lengthSquared;if(0==d)return a;
d=this.sub(a).dot(c)/d;return 0>d?a:1<d?b:a.add(c.scale(d))},projectOnRay:function(a,b){var c=b.lengthSquared;return 0==c?0:this.sub(a).dot(b)/c}});
Bezier={cubic:function(a,b,c,d,e){var g=a*a*a,f=a*a,h=3*(c.x-b.x),k=3*(c.y-b.y),m=3*(d.x-c.x)-h;c=3*(d.y-c.y)-k;return new Vec2((e.x-b.x-h-m)*g+m*f+h*a+b.x,(e.y-b.y-k-c)*g+c*f+k*a+b.y)},cubic1D:function(a,b,c,d,e){return Bezier.cubic(a,Vec2.zero,new Vec2(b,c),new Vec2(d,e),Vec2.one).y},make:{cubic:function(a,b,c,d){return function(e){return Bezier.cubic(e,a,b,c,d)}},cubic1D:function(a,b,c,d){return function(e){return Bezier.cubic1D(e,a,b,c,d)}}}};
BBox=$prototype({$static:{zero:$property(function(){return new BBox(0,0,0,0)}),unit:$property(function(){return new BBox(0,0,1,1)}),fromLeftTopAndSize:function(a,b){return BBox.fromLTWH({left:a.x,top:a.y,width:b.x,height:b.y})},fromLTWH:function(a,b,c,d){return 1===arguments.length?BBox.fromLTWH(a.left,a.top,a.width,a.height):new BBox(a+c/2,b+d/2,c,d)},fromLTRB:function(a,b,c,d){return 1===arguments.length?BBox.fromLTRB(a.left,a.top,a.right,a.bottom):new BBox(_.lerp(.5,a,c),_.lerp(.5,b,d),c-a,d-b)},
fromSizeAndCenter:function(a,b){return new BBox(b.x-a.x/2,b.y-a.y/2,a.x,a.y)},fromSize:function(a,b){return b?new BBox(-a/2,-b/2,a,b):new BBox(-a.x/2,-a.y/2,a.x,a.y)},fromPoints:function(a){var b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MIN_VALUE,e=Number.MIN_VALUE;_.each(a,function(a){b=Math.min(a.x,b);c=Math.min(a.y,c);d=Math.max(a.x,d);e=Math.max(a.y,e)});return BBox.fromLTRB(b,c,d,e)}},constructor:function(a,b,c,d){4==arguments.length?(this.x=a,this.y=b,this.width=c,this.height=d):_.extend(this,
a)},classifyPoint:function(a){a=_.extend(a.x>this.right?{right:!0}:{},a.x<this.left?{left:!0}:{},a.y>this.bottom?{bottom:!0}:{},a.y<this.top?{top:!0}:{});return _.extend(a,a.left||a.right||a.bottom||a.top?{}:{inside:!0})},classifyRay:function(a,b,c){var d=this.size.half,e,g,f,h,k,m;e=1/b.x;g=1/b.y;k=Math.sign(e);m=Math.sign(g);f=(this.x-k*d.x-a.x)*e;h=(this.y-m*d.y-a.y)*g;e*=this.x+k*d.x-a.x;d=(this.y+m*d.y-a.y)*g;if(!(f>d||h>e||(g=f>h?f:h,1<=g||0>=(e<d?e:d))))return e={time:_.clamp(g,0,1)},e.normal=
f>h?new Vec2(-k,0):new Vec2(0,-m),e.delta=b.scale(e.time),e.where=a.add(e.delta),c&&(f=this.grow(-c),e.where.x>f.right?e.where.y<f.top?e=Intersect.rayCircle(a,b,f.rightTop,c):e.where.y>f.bottom&&(e=Intersect.rayCircle(a,b,f.rightBottom,c)):e.where.x<f.left&&(e.where.y<f.top?e=Intersect.rayCircle(a,b,f.leftTop,c):e.where.y>f.bottom&&(e=Intersect.rayCircle(a,b,f.leftBottom,c))),e&&e.insideOut&&(e.where=a)),e},nearestPointTo:function(a,b){var c=b||0,d=new Vec2(this.left,this.top),e=new Vec2(this.right,
this.top),g=new Vec2(this.right,this.bottom),f=new Vec2(this.left,this.bottom),c=[a.projectOnLineSegment(d.add(c,0),e.add(-c,0)),a.projectOnLineSegment(e.add(0,c),g.add(0,-c)),a.projectOnLineSegment(g.add(-c,0),f.add(c,0)),a.projectOnLineSegment(f.add(0,-c),d.add(0,c)),a.projectOnCircle(d.add(c,c),c),a.projectOnCircle(e.add(-c,c),c),a.projectOnCircle(g.add(-c,-c),c),a.projectOnCircle(f.add(c,-c),c)];return _.min(c,function(b){return a.sub(b).length})},xywh:$property(function(){return{x:this.x,y:this.y,
width:this.width,height:this.height}}),ltwh:$alias("css"),union:function(a){return BBox.fromLTRB(Math.min(this.left,a.left),Math.min(this.top,a.top),Math.max(this.right,a.right),Math.max(this.bottom,a.bottom))},clone:$property(function(){return new BBox(this.x,this.y,this.width,this.height)}),floor:$property(function(){return new BBox.fromLTRB(Math.floor(this.left),Math.floor(this.top),Math.floor(this.right),Math.floor(this.bottom))}),css:$property(function(){return{left:this.left,top:this.top,width:this.width,
height:this.height}}),leftTop:$property(function(){return new Vec2(this.left,this.top)}),leftBottom:$property(function(){return new Vec2(this.left,this.bottom)}),rightBottom:$property(function(){return new Vec2(this.right,this.bottom)}),rightTop:$property(function(){return new Vec2(this.right,this.top)}),left:$property(function(){return this.x-this.width/2}),right:$property(function(){return this.x+this.width/2}),top:$property(function(){return this.y-this.height/2}),bottom:$property(function(){return this.y+
this.height/2}),center:$property(function(){return new Vec2(this.x,this.y)}),size:$property(function(){return new Vec2(this.width,this.height)}),offset:function(a){return new BBox(this.x+a.x,this.y+a.y,this.width,this.height)},newWidth:function(a){return new BBox(this.x-(a-this.width)/2,this.y,a,this.height)},grow:function(a){return new BBox(this.x,this.y,this.width+2*a,this.height+2*a)},shrink:function(a){return this.grow(-a)},area:$property(function(){return Math.abs(this.width*this.height)}),toString:function(){return"{ "+
this.left+","+this.top+" \u2190\u2192 "+this.right+","+this.bottom+" }"}});
Transform=$prototype({$static:{identity:$property(function(){return new Transform}),svgMatrix:function(a){return new Transform([[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]])},translation:function(a){return new Transform([[1,0,a.x],[0,1,a.y],[0,0,1]])}},constructor:function(a){this.components=a||[[1,0,0],[0,1,0],[0,0,1]]},multiply:function(a){var b=[[0,0,0],[0,0,0],[0,0,0]],c,d,e=this.components,g=a.components;for(a=0;3>a;a++)for(c=0;3>c;c++)for(d=0;3>d;d++)b[a][c]+=e[a][d]*g[d][c];return new Transform(b)},
translate:function(a){return this.multiply(Transform.translation(a))},scale:function(a){return this.multiply(new Transform([[a,0,0],[0,a,0],[0,0,1]]))},inverse:$property($memoized(function(){var a=this.components,b=1/(a[0][0]*(a[1][1]*a[2][2]-a[2][1]*a[1][2])-a[0][1]*(a[1][0]*a[2][2]-a[1][2]*a[2][0])+a[0][2]*(a[1][0]*a[2][1]-a[1][1]*a[2][0]));return new Transform([[(a[1][1]*a[2][2]-a[2][1]*a[1][2])*b,-(a[0][1]*a[2][2]-a[0][2]*a[2][1])*b,(a[0][1]*a[1][2]-a[0][2]*a[1][1])*b],[(a[1][0]*a[2][2]-a[1][2]*
a[2][0])*b,(a[0][0]*a[2][2]-a[0][2]*a[2][0])*b,-(a[0][0]*a[1][2]-a[1][0]*a[0][2])*b],[(a[1][0]*a[2][1]-a[2][0]*a[1][1])*b,-(a[0][0]*a[2][1]-a[2][0]*a[0][1])*b,(a[0][0]*a[1][1]-a[1][0]*a[0][1])*b]])})),unproject:function(a){var b=this.components;return new Vec2(a.x*b[0][0]+a.y*b[0][1]+b[0][2],a.x*b[1][0]+a.y*b[1][1]+b[1][2])},project:function(a){return this.inverse.unproject(a)}});
_.rng=function(a,b,c){var d=a,e=987654321;return function(){e=36969*(e&65535)+(e>>16)&4294967295;d=18E3*(d&65535)+(d>>16)&4294967295;var a=(e<<16)+d&4294967295,a=a/4294967296+.5;return void 0===b&&void 0===c?a:Math.round(b+a*(c-b))}};_.equalDistribution=function(a,b){var c=a/b,d=0;return _.times(b,function(){var a=Math.round(d),b=Math.round(d+=c);return Math.floor(b-a)})};_.ptInRect=function(a,b){return a.x>=b.left&&a.y>=b.top&&a.x<b.right&&a.y<b.bottom};
_.hue2CSS=function(a,b){return _.RGB2CSS(_.hue2RGB(a),b)};_.HSL2CSS=function(a,b){return _.RGB2CSS(_.HSL2RGB(a),b)};_.HSL2RGB=function(a){var b=a[1],c=a[2];a=_.hue2RGB(a[0]);b*=1-Math.abs(2*c-1);return[(a[0]-.5)*b+c,(a[1]-.5)*b+c,(a[2]-.5)*b+c]};_.hue2RGB=function(a){return[Math.max(0,Math.min(1,Math.abs(6*a-3)-1)),Math.max(0,Math.min(1,2-Math.abs(6*a-2))),Math.max(0,Math.min(1,2-Math.abs(6*a-4)))]};
_.RGB2CSS=function(a,b){return"rgba("+Math.round(255*a[0])+","+Math.round(255*a[1])+","+Math.round(255*a[2])+","+(void 0===b?void 0===a[3]?1:a[3]:b)+")"};_.RGB2HSL=function(a,b){var c=a[0],d=a[1],e=a[2],g=void 0===b?a[3]:b,f=Math.max(c,d,e),h=Math.min(c,d,e),k,m=(f+h)/2;if(f==h)k=h=0;else{var l=f-h,h=.5<m?l/(2-f-h):l/(f+h);switch(f){case c:k=(d-e)/l+(d<e?6:0);break;case d:k=(e-c)/l+2;break;case e:k=(c-d)/l+4}k/=6}return void 0===g?[k,h,m]:[k,h,m,g]};
_.extend(Math,function(a){return{roundTo:function(a,c){return a-a%c},round10:function(b,c){return a("round",b,c)},floor10:function(b,c){return a("floor",b,c)},ceil10:function(b,c){return a("ceil",b,c)}}}(function(a,b,c){if("undefined"===typeof c||0===+c)return Math[a](b);b=+b;c=+c;if(isNaN(b)||"number"!==typeof c||0!==c%1)return NaN;b=b.toString().split("e");b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c)));b=b.toString().split("e");return+(b[0]+"e"+(b[1]?+b[1]+c:c))}));
_.defineKeyword("component",function(a){return $extends(Component,a)});_("trigger triggerOnce barrier observable bindable memoize lock memoizeCPS debounce throttle overrideThis listener postpones reference".split(" ")).each(_.defineTagKeyword);_.defineTagKeyword("observableProperty",_.flip);_.defineKeyword("observableRef",function(a){return $observableProperty($reference(a))});
$prototype.inheritsBaseValues=function(a){$prototype.macro(a,function(b,c,d,e){_.extend2(c,e&&e[a]||{},c);_.each(b.$traits,function(b){_.extend2(c,b[a])});b[a]=$static($builtin($property(_.constant(c))));return b})};$prototype.inheritsBaseValues("$defaults");$prototype.inheritsBaseValues("$requires");
Component=$prototype({$impl:{mergeTraitsMembers:function(a,b){var c={},d={};_.each([a].concat(_.pluck(b,"$definition")),function(a){_.each(_.omit(a,_.or($builtin.matches,_.key(_.equals("constructor")))),function(a,b){a.$bindable&&(d[b]=a);(c[b]||(c[b]=[])).push(a)})});_.each(c,function(b,d){var f=_.find(b,Component.isStreamDefinition);if(f){var h=a[d]=Tags.clone(f);h.listeners=[];_.each(b,function(a){a!==f&&h.listeners.push(a)})}else a[d]||(a[d]=c[d][0])});_.each(d,function(b,d){var f=_.nonempty(_.map(_.bindable.hooks,
function(a,b){var e=c[_.bindable.hooksShort[b]+d.capitalized];return e&&[a,e]}));if(f.length){var h=(a[d]=Tags.clone(b,_.bindable($untag(b)))).subject;_.each(f,function(a){_.each(a[1],function(b){b=$untag(b);if(_.isFunction(b))h[a[0]](b)})})}})}},isStreamDefinition:$static(function(a){return _.isObject(a)&&(a.$trigger||a.$triggerOnce||a.$barrier||a.$observable||a.$observableProperty)}),enumMethods:function(){var a=_.last(arguments),b=1===arguments.length?_.constant(!0):arguments[0],c;for(c in this){var d=
this.constructor.$definition[c];if(!d||!d.$property){var e=this[c];b(d)&&_.isFunction(e)&&!_.isPrototypeConstructor(e)&&a.call(this,e,c)}}},constructor:$final(function(a,b){var c=this.cfg="object"===typeof a?a:{},d=this.constructor.$definition;this.constructor.$defaults&&_.defaults(this,_.cloneDeep(this.constructor.$defaults));_.onBefore(this,"destroy",this.beforeDestroy);_.onAfter(this,"destroy",this.afterDestroy);_.extend(this,{parent_:void 0,children_:[]},_.omit(_.omit(c,"init","attachTo","attach"),
function(a,b){return Component.isStreamDefinition(d[b])},this));this.enumMethods(function(a,b){"$"!==b&&"init"!==b&&(this[b]=this.$(a))});var e=[];_.each(d,function(a,b){if(void 0!==a){if(a.$observableProperty){var d=this[b];defaultValue=b in c?c[b]:d;var k=this[b+"Change"]=_.observable();k.context=this;k.postpones=a.$postpones;if(_.isPrototypeInstance(d)){var m=d.constructor;k.beforeWrite=function(a){return m.isTypeOf(a)?a:new m(a)}}a.$reference&&(k.trackReference=!0);_.defineProperty(this,b,{get:function(){return k.value},
set:function(a){k.call(this,a)}});a.listeners&&_.each(a.listeners,function(a){e.push([k,a])});_.isFunction(a.$observableProperty)&&e.push([k,a.$observableProperty]);void 0!==defaultValue&&k(_.isFunction(defaultValue)?this.$(defaultValue):defaultValue)}else if(Component.isStreamDefinition(a)){var l=(a.$trigger?_.trigger:a.$triggerOnce?_.triggerOnce:a.$observable?_.observable:a.$barrier?_.barrier:void 0)(this[b]);this[b]=_.extend(l,{context:this,postpones:a.$postpones});a.listeners&&_.each(a.listeners,
function(a){e.push([l,a])});(d=c[b])&&e.push([l,d])}a.$listener&&(this[b].queuedBy=[]);a.$lock&&(this[b]=$interlocked(this[b]));a.$bindable&&(_.hasAsserts&&$assert(_.isFunction(this[b])),this[b]=_.extendWith(a.defaultHooks||{},_.bindable(this[b],this)));if(a.$debounce){var d=this[b],n=_.coerceToObject(a.$debounce);this[b]=d.debounced(n.wait||500,n.immediate)}a.$throttle&&(d=this[b],n=_.coerceToObject(a.$throttle),this[b]=_.throttle(d,n.wait||500,n));a.$memoize?this[b]=_.memoize(this[b]):a.$memoizeCPS&&
(this[b]=_.cps.memoize(this[b]))}},this);_.intercept(this,"init",function(a){(_.hasArgs(this.constructor.prototype.init)?_.cps.sequence:_.sequence)([this._beforeInit,a.bind(this),this._afterInit]).call(this)});_.each(d,function(a,b){a&&a.$alias&&(this[b]=this[Tags.unwrap(a)])},this);_.hasAsserts&&_.each(this.constructor.$requires,function(a,b){$assertTypeMatches(this[b],a)},this);_.each(e,function(a){a[0].call(this,a[1])},this);!1===c.init||this.constructor.$defaults&&!1===this.constructor.$defaults.init||
this.init()}),callTraitsMethod:function(a,b){_.isFunction(b)?_.cps.sequence(_.filter2(this.constructor.$traits||[],this.$(function(b){return(b=b.prototype[a])&&_.cps.arity0(_.noArgs(b)?b.asContinuation:b).bind(this)||!1})).concat(b.arity0))():_.sequence(_.filter2(this.constructor.$traits||[],this.$(function(b){return(b=b.prototype[a])&&(_.hasArgs(b)?b.bind(this,_.identity):b.bind(this))||!1})))()},_beforeInit:function(a){if(this.initialized.already)throw Error("Component: I am already initialized. Probably you're doing it wrong.");
this.callTraitsMethod("beforeInit",a)},init:function(){},_afterInit:function(a){var b=this.cfg;b.attach&&!_.isFunction(b.attach)&&this.attach(b.attach);b.attachTo&&!_.isFunction(b.attachTo)&&this.attachTo(b.attachTo);this.callTraitsMethod("afterInit",a);this.initialized(!0);_.each(this.constructor.$definition,function(a,d){d+="Change";if(a&&a.$observableProperty){var e=b[d];if(_.isFunction(e))this[d](e)}},this)},initialized:$barrier(),beforeDestroy:function(){if(this.destroyed_)throw Error("Component: I am already destroyed. Probably you're doing it wrong.");
if(this.destroying_)throw Error("Component: Recursive destroy() call detected. Probably you're doing it wrong.");this.destroying_=!0;this.enumMethods(_.off);_.each(this.children_,_.method("destroy"));this.children_=[]},destroy:function(){},afterDestroy:function(){_.each(this.constructor.$traits,function(a){a.prototype.destroy&&a.prototype.destroy.call(this)},this);delete this.destroying_;this.parent_=void 0;this.destroyed_=!0},attachedTo:$property(function(){return this.parent_}),attachTo:function(a){if(a===
this)throw Error("smells like time-travel paradox.. how else can I be parent of myself?");this.parent_!==a&&(void 0!==this.parent_&&this.parent_.children_.remove(this),void 0!==(this.parent_=a)&&this.parent_.children_.push(this));return this},detach:function(){return this.attachTo(void 0)},attached:$property(function(){return this.children_}),attach:function(a){_.invoke(_.coerceToArray(a),"attachTo",this);return this},detachAll:function(){_.each(this.children_,function(a){a.parent_=void 0});this.children_=
[];return this},destroyAll:function(){_.each(this.children_,function(a){a.parent_=void 0;a.destroy()});this.children_=[];return this}});
R=$singleton({$test:function(){var a=function(a,b){$assert(a,_.quote(b.str,"//"))};a("/[^\\s]*/",$r.anyOf.except.space.$);a("/\\[.*\\]|[\\s]/",$r.anything.inBrackets.or.oneOf.space.$);var b=$r.expr("before",$r.anything.text("$print").something).then($r.expr("argument",$r.someOf.except.text(",)")).inParentheses.then($r.expr("tail",$r.anything))).$;a("/(.*\\$print.+)\\(([^,\\)]+)\\)(.*)/",b);$assert(b.parse(" var x = $print (blabla) // lalala "),{before:" var x = $print ",argument:"blabla",tail:" // lalala "});
$assert([["[^","\\s","]"],"*"],R.anyOf(R.except(R.space)))},constructor:function(){this.reduce=_.hyperOperator(_.binary,_.reduce2,_.goDeeperAlwaysIfPossible,_.isNonTrivial.and(_.not(this.isSubexpr)));this.initDSL()},expr:function(a,b){b=b||[];return new R.Expr(R.reduce(a,"",function(a,d){return R.isSubexpr(a)?(b.push(a),d+R.expr(R.root(a.value),b).str):d+a}),b)},Expr:$prototype({constructor:function(a,b){this.rx=RegExp();this.rx.compile(a);this.str=a;this.subexprs=b},parse:function(a){return(a=a.match(this.rx))&&
_.extend.apply(null,_.zipWith([_.rest(a),this.subexprs],function(a,c){return _.object([[c.name,a]])}))||{}}}),metacharacters:$property(_.index("\\^$.|?*+()[{")),escape:function(a){return _.map(a,function(a){return R.metacharacters[a]?"\\"+a:a}).join("")},text:$alias("escape"),subexpr:function(a,b){return{name:a,value:["(",b,")"]}},maybe:function(a){return[a,"?"]},anyOf:function(a){return[a,"*"]},someOf:function(a){return[a,"+"]},oneOf:function(a){return["[",a,"]"]},except:function(a){return["[^",
a,"]"]},or:function(a,b){return[a,"|",b]},begin:$property("^"),end:$property("$"),space:$property("\\s"),maybeSpaces:$property("\\s*"),spaces:$property("\\s+"),anything:$property(".*"),something:$property(".+"),comma:$property(","),parentheses:function(a){return["\\(",a,"\\)"]},brackets:function(a){return["\\[",a,"\\]"]},isSubexpr:function(a){return _.isStrictlyObject(a)&&!_.isArray(a)?!0:!1},root:function(a){return a&&a.$$?a.$$:a},initDSL:function(){_.defineKeyword("r",function(){return $$r([])});
_.defineKeyword("$r",function(a){var b=function(b){a.push(b);return a.forward};_.defineHiddenProperty(a,"then",function(b){a.push(R.root(b));return a});_.defineHiddenProperty(a,"text",function(b){a.push(R.text(b));return a});_.defineHiddenProperty(a,"expr",function(b,d){a.push(R.subexpr(b,R.root(d)));return a});_.defineHiddenProperty(a,"forward",function(){return a.next||((a.next=$r).prev=a).next});_.each(["maybe","anyOf","someOf","oneOf","except"],function(c){_.defineHiddenProperty(a,c,function(){return b(R[c](a.forward))})});
_.each(["parentheses","brackets"],function(b){_.defineHiddenProperty(a,"in"+b.capitalized,function(){return a.$$.prev=$$r(R[b](a.$$))})});_.each(["or"],function(b){_.defineHiddenProperty(a,b,function(){var d=$r;return(d.prev=a.$$.prev=$$r(R[b](a.$$,d))).next=d})});_.each(["begin","end","space","anything","something"],function(c){_.defineHiddenProperty(a,c,function(){return b([R[c],a.forward])})});_.defineHiddenProperty(a,"$$",function(){for(var b=a;b.prev;)b=b.prev;return b});_.defineHiddenProperty(a,
"$",function(){return R.expr(a.$$)});return a})}});
(function(){_.hasUncaught=!0;var a=_.globalUncaughtExceptionHandler=function(a){var c=arguments.callee.chain;arguments.callee.chain=_.reject(c,_.property("catchesOnce"));if(c.length)for(var d=0,e=c.length;d<e;d++)try{c[d](a);break}catch(g){if(d===e-1)throw g.message+=" [re-thrown by a hook]",g;g&&"object"===typeof g&&(g.originalError=a);a=g}else throw a.message+=" [re-thrown by a hook]",a;};_.withUncaughtExceptionHandler=function(b,c){var d=c||_.identity;c&&(b.catchesOnce=!0);a.chain.unshift(b);d(function(){a.chain.remove(b)})};
a.chain=[];switch(Platform.engine){case "node":require("process").on("uncaughtException",a);break;case "browser":window.addEventListener("error",function(b){0>b.message.indexOf(" [re-thrown by a hook]")&&(b.error?a(b.error):a(_.extend(Error(b.message),{stub:!0,stack:"at "+b.filename+":"+b.lineno+":"+b.colno})))})}})();_.hasReflection=!0;_.defineKeyword("callStack",function(){return CallStack.fromRawString(CallStack.currentAsRawString).offset(Platform.NodeJS?1:0)});
_.defineKeyword("currentFile",function(){return(CallStack.rawStringToArray(CallStack.currentAsRawString)[Platform.NodeJS?3:1]||{file:""}).file});_.defineKeyword("uselessPath",_.memoize(function(){return _.initial($currentFile.split("/"),Platform.NodeJS?2:1).join("/")+"/"}));_.defineKeyword("sourcePath",_.memoize(function(){var a=($uselessPath.match(/(.+)\/node_modules\/(.+)/)||[])[1];return a?a+"/":$uselessPath}));
SourceFiles=$singleton(Component,{apiConfig:{},line:function(a,b,c){SourceFiles.read(a,function(a){c((a.split("\n")[b]||"").trimmed)})},read:$memoizeCPS(function(a,b){if(0>a.indexOf("<"))try{if(Platform.NodeJS)b(require("fs").readFileSync(a,{encoding:"utf8"})||"");else{var c=new XMLHttpRequest;c.open("GET",a,!0);c.onreadystatechange=function(){4==c.readyState&&b(c.responseText)};c.send(null)}}catch(d){b("")}else b("")}),write:function(a,b,c){Platform.NodeJS?this.read(a,function(d){var e=require("fs"),
g={encoding:"utf8"};try{e.mkdirSync(a+".backups")}catch(f){}e.writeFileSync(a+".backups/"+Date.now(),d,g);e.writeFileSync(a,b,g);c()}):API.post("source/"+a,_.extend2({},this.apiConfig,{what:{text:b},failure:Panic,success:function(){log.ok(a,"\u2014 successfully saved");c&&c()}}))}});_.readSourceLine=SourceFiles.line;_.readSource=SourceFiles.read;_.writeSource=SourceFiles.write;
CallStack=$extends(Array,{current:$static($property(function(){return CallStack.fromRawString(CallStack.currentAsRawString).offset(1)})),fromError:$static(function(a){return a&&a.parsedStack?CallStack.fromParsedArray(a.parsedStack).offset(a.stackOffset||0):a&&a.stack?CallStack.fromRawString(a.stack).offset(a.stackOffset||0):CallStack.fromParsedArray([])}),locationEquals:$static(function(a,b){return a.file===b.file&&a.line===b.line&&a.column===b.column}),safeLocation:function(a){return this[a]||{callee:"",
calleeShort:"",file:"",fileName:"",fileShort:"",thirdParty:!1,source:"??? WRONG LOCATION ???",sourceReady:_.barrier("??? WRONG LOCATION ???")}},mergeDuplicateLines:$property(function(){return CallStack.fromParsedArray(_.map(_.partition2(this,function(a){return a.file+a.line}),function(a){return _.reduce(_.rest(a),function(a,c){a.callee=(a.callee||"<anonymous>")+" \u2192 "+(c.callee||"<anonymous>");a.calleeShort=(a.calleeShort||"<anonymous>")+" \u2192 "+(c.calleeShort||"<anonymous>");return a},_.clone(a[0]))}))}),
clean:$property(function(){return this.mergeDuplicateLines.reject(_.property("thirdParty"))}),asArray:$property(function(){return _.asArray(this)}),offset:function(a){return a&&CallStack.fromParsedArray(_.rest(this,a))||this},initial:function(a){return a&&CallStack.fromParsedArray(_.initial(this,a))||this},concat:function(a){return CallStack.fromParsedArray(this.asArray.concat(a.asArray))},filter:function(a){return CallStack.fromParsedArray(_.filter(this,a))},reject:function(a){return CallStack.fromParsedArray(_.reject(this,
a))},reversed:$property(function(){return CallStack.fromParsedArray(_.reversed(this))}),sourcesReady:function(a){return _.allTriggered(_.pluck(this,"sourceReady"),a)},constructor:function(a){Array.prototype.constructor.call(this);_.each(a,function(a){a.sourceReady||(a.sourceReady=_.barrier(),SourceFiles.line((a.remote?"api/source/":"")+a.file,a.line-1,function(c){a.sourceReady(a.source=c)}));this.push(a)},this)},fromParsedArray:$static(function(a){return new CallStack(a)}),currentAsRawString:$static($property(function(){var a=
Platform.Browser?3:2;return _.rest((Error().stack||"").split("\n"),a).join("\n")})),shortenPath:$static(function(a){var b=a.replace($uselessPath,"").replace($sourcePath,"");return b!==a?b:a.split("/").last}),isThirdParty:$static(_.bindable(function(a){var b=a.replace($sourcePath,"");return Platform.NodeJS&&"/"!==a[0]||0<=b.indexOf("/node_modules/")||0<=a.indexOf("/node_modules/")&&!b||0<=b.indexOf("underscore")||0<=b.indexOf("jquery")})),fromRawString:$static(_.sequence(function(a){return CallStack.rawStringToArray(a)},
function(a){return _.map(a,function(a){return _.extend(a,{calleeShort:_.last(a.callee.split(".")),fileName:_.last(a.file.split("/")),fileShort:CallStack.shortenPath(a.file),thirdParty:CallStack.isThirdParty(a.file)&&!a.index})})},function(a){return CallStack.fromParsedArray(a)})),rawStringToArray:$static(function(a){a=(a||"").split("\n");return _.filter2(a,function(a){a=a.trimmed;var c,d=[],e=!1,d=d=void 0;if((d=a.match(/at (.+) \((.+)\)/))||(d=a.match(/(.*)@(.*)/)))c=d[1],e="native"===d[2],d=_.rest(d[2].match(/(.*):(.+):(.+)/)||
[]);else if(d=a.match(/^(at\s+)*(.+):([0-9]+):([0-9]+)/))d=_.rest(d,2);else return!1;return 0<=(c||"").indexOf("__supressErrorReporting")?!1:{beforeParse:a,callee:c||"",index:Platform.Browser&&d[0]===window.location.href,"native":e,file:d[0]||"",line:(d[1]||"").integerValue,column:(d[2]||"").integerValue}})})});
$prototype.macro(function(a,b){var c=CallStack.currentAsRawString;a.$meta||(a.$meta=$static(_.cps.memoize(function(a){_.cps.find(CallStack.fromRawString(c).reversed,function(a,b){a.sourceReady(function(c){c=(c||"").match(/([A-z]+)\s*=\s*\$(prototype|singleton|component|extends|trait|aspect)/);b(c&&{name:c[1],type:c[2],file:a.fileShort}||!1)})},function(b){a(b||{})})})));return a});_.hasLog=!0;
_.extend(log=function(){return log.write.apply(this,arguments)},{Color:$prototype(),Config:$prototype(),cleanArgs:function(a){return _.reject(a,_.or(log.Color.isTypeOf,log.Config.isTypeOf))},read:function(a,b){return _.find(b,a.isTypeOf)||new a({})},modify:function(a,b,c){return _.reject(b,a.isTypeOf).concat(c(log.read(a,b)))}});
_.extend(log,{config:function(a){return new log.Config(a)},indent:function(a){return log.config({indent:a})},color:{red:new log.Color({shell:"\u001b[31m",css:"crimson"}),blue:new log.Color({shell:"\u001b[36m",css:"royalblue"}),orange:new log.Color({shell:"\u001b[33m",css:"saddlebrown"}),green:new log.Color({shell:"\u001b[32m",css:"forestgreen"})},readColor:log.read.partial(log.Color),readConfig:log.read.partial(log.Config),modifyColor:log.modify.partial(log.Color),modifyConfig:log.modify.partial(log.Config),
boldLine:"======================================",line:"--------------------------------------",thinLine:"......................................",withWriteBackend:$scope(function(a,b,c,d){var e=log.writeBackend.value;log.writeBackend.value=b;c(function(b){a(function(){log.writeBackend.value=e;b&&b();d&&d()})})}),writeUsingDefaultBackend:function(){var a=arguments;log.withWriteBackend(log.impl.defaultWriteBackend,function(b){log.write.apply(null,a);b()})},writeBackend:function(){return arguments.callee.value||
log.impl.defaultWriteBackend},impl:{write:function(a){return $restArg(function(){var b=log.writeBackend(),c=_.asArray(arguments),d=log.cleanArgs(c),e=_.extend({indent:0},a,log.readConfig(c)),g=(b.indent||0)+e.indent,f=log.impl.stringifyArguments(d,e),g=_.times(g,_.constant("\t")).join(""),f=f.reversed.match(/(\n*)([^]*)/),h=e.location&&log.impl.location(e.where||$callStack[3+(e.stackOffset||0)])||"",c={color:log.readColor(c),indentedText:f[2].reversed.split("\n").map(_.prepends(g)).join("\n"),trailNewlines:f[1],
codeLocation:h,config:e};b(c);return d[0]})},defaultWriteBackend:function(a){var b=a.color,c=a.indentedText,d=a.codeLocation;a=a.trailNewlines;(b=b&&(Platform.NodeJS?b.shell:b.css))?Platform.NodeJS?console.log(b+c+"\u001b[0m",d,a):(c=c.split("\n"),c=[_.first(c)||""].concat(_.rest(c).map(_.prepends(" "))),console.log("%c"+c.join("\n"),"color: "+b,d,a)):console.log(c,d,a)},location:function(a){return _.quoteWith("()",_.nonempty([a.calleeShort,a.fileName+":"+a.line]).join(" @ "))},stringifyArguments:function(a,
b){return _.map(a,log.impl.stringify.tails2(b)).join(" ")},stringify:function(a,b){b=b||{};if(_.isTypeOf(Error,a)){var c=log.impl.stringifyError(a);return a.originalError?c+"\n\n"+log.impl.stringify(a.originalError):c}return _.isTypeOf(CallStack,a)?log.impl.stringifyCallStack(a):"object"===typeof a?_.isArray(a)&&1<a.length&&_.isObject(a[0])&&b.table?log.asTable(a):_.stringify(a,b):"string"===typeof a?a:_.stringify(a)},stringifyError:function(a){try{var b=CallStack.fromError(a).clean.offset(a.stackOffset||
0);return"[EXCEPTION] "+(a.message||"").replace(/\r|\n/g,"").trimmed.first(120)+"\n\n"+log.impl.stringifyCallStack(b)+"\n"}catch(c){return"YO DAWG I HEARD YOU LIKE EXCEPTIONS... SO WE THREW EXCEPTION WHILE PRINTING YOUR EXCEPTION:\n\n"+c.stack+"\n\nORIGINAL EXCEPTION:\n\n"+a.stack+"\n\n"}},stringifyCallStack:function(a){return log.columns(a.map(function(a){return["\tat "+a.calleeShort.first(30),_.nonempty([a.fileShort,":",a.line]).join(""),(a.source||"").first(80)]})).join("\n")}}});
_.extend(log,log.printAPI={newline:log.impl.write().partial(""),write:log.impl.write(),red:log.impl.write().partial(log.color.red),blue:log.impl.write().partial(log.color.blue),orange:log.impl.write().partial(log.color.orange),green:log.impl.write().partial(log.color.green),failure:log.impl.write({location:!0}).partial(log.color.red),error:log.impl.write({location:!0}).partial(log.color.red),e:log.impl.write({location:!0}).partial(log.color.red),info:log.impl.write({location:!0}).partial(log.color.blue),
i:log.impl.write({location:!0}).partial(log.color.blue),w:log.impl.write({location:!0}).partial(log.color.orange),warn:log.impl.write({location:!0}).partial(log.color.orange),warning:log.impl.write({location:!0}).partial(log.color.orange),success:log.impl.write({location:!0}).partial(log.color.green),ok:log.impl.write({location:!0}).partial(log.color.green)});log.writes=log.printAPI.writes=_.higherOrder(log.write);logs=_.map2(log.printAPI,_.higherOrder);
_.extend(log,{asTable:function(a){var b=a.map(_.keys.arity1).reduce(_.union.arity2,[]);a=log.columns([b].concat(_.map(a,function(a){return b.map(_.propertyOf(a))})),{maxTotalWidth:120,minColumnWidths:b.map(_.property("length"))});return[a[0],log.thinLine[0].repeats(a[0].length),_.rest(a)].flat.join("\n")},columns:function(a,b){if(0===a.length)return[];var c=a.map(_.map.tails2(function(a){return(a+"").split("\n")[0]})),d=c.map(_.map.tails2(_.property("length"))),e=d.zip(_.largest),g=b||{minColumnWidths:e,
maxTotalWidth:0},f=_.reduce(e,_.sum,0),h=_.map(e,_.muls(1/f)),k=Math.max(0,f-g.maxTotalWidth),m=_.map(e,function(a,b){return Math.max(g.minColumnWidths[b],Math.floor(a-k*h[b]))}),d=d.map(function(a){return[m,a].zip(_.subtract)});return[c,d].zip(_.zap.tails(function(a,b){return 0<=b?a+" ".repeats(b):_.initial(a,-b).join("")}).then(_.joinsWith("  ")))}});Platform.NodeJS&&(module.exports=log);_.defineTagKeyword("shouldFail");_.defineTagKeyword("async");_.defineTagKeyword("assertion");
Testosterone=$singleton({prototypeTests:[],isRunning:$property(function(){return void 0!==this.currentAssertion}),constructor:function(){_.each(_.assertions,function(a,b){this.defineAssertion(b,"assertFails"===b?$shouldFail(function(a){a.call(this)}):a)},this);(function(a){$prototype.macro("$test",a);$prototype.macro("$tests",a)})(this.$(function(a,b,c){this.prototypeTests.push({readPrototypeMeta:Tags.unwrap(a.$meta),tests:b});a[c]=$static($property($constant(a[c])));return a}));this.run=this.$(this.run)},
run:$interlocked(function(a,b,c){var d=3===arguments.length?c:_.identity,e=this.runConfig=_.extend({silent:!0,verbose:!1,timeout:2E3,testStarted:function(a){},testComplete:function(a){}},b),g=_.isArray(e.suites),f=_.map(e.suites||[],this.$(function(a,b){return this.testSuite(g?a.name:b,g?a.tests:a,e.context)}));(!1===e.codebase?_.cps.constant([]):this.$(this.collectPrototypeTests))(this.$(function(b){var c=!1===e.codebase?[]:this.collectTests();b=_.flatten(_.pluck(c.concat(f).concat(b),"tests"));
b=_.filter(b,e.shouldRun||_.constant(!0));this.runningTests=_.map(b,function(a,b){return _.extend(a,{indent:e.indent,index:b})});_.withUncaughtExceptionHandler(this.$(this.onException),this.$(function(b){_.cps.each(this.runningTests,this.$(this.runTest),this.$(function(){_.assert(!0!==e.done);e.done=!0;this.printLog(e);this.failedTests=_.filter(this.runningTests,_.property("failed"));this.failed=0<this.failedTests.length;d(!this.failed);b();a()}))}))}))}),onException:function(a){if(this.currentAssertion)this.currentAssertion.onException(a);
else throw a;},defineAssertions:function(a){_.each(a,function(a,c){this.defineAssertion(c,a)},this)},runTest:function(a,b,c){var d=this.runConfig;d.testStarted(a);a.verbose=d.verbose;a.timeout=d.timeout;a.startTime=Date.now();a.run(function(){d.testComplete(a);a.time=Date.now()-a.startTime;c()})},collectTests:function(){return _.map(_.tests,this.$(function(a,b){return this.testSuite(b,a)}))},collectPrototypeTests:function(a){_.cps.map(this.prototypeTests,this.$(function(a,c){a.readPrototypeMeta(this.$(function(d){c(this.testSuite(d.name,
a.tests))}))}),a)},testSuite:function(a,b,c){return{name:a||"",tests:_(_.pairs("function"===typeof b&&_.object([[a,b]])||b)).map(function(b){var e=new Test({name:b[0],routine:b[1],suite:a,context:c});e.complete(function(){(e.hasLog=0<e.logCalls.length)||(e.failed?log.red("FAIL"):e.verbose&&log.green("PASS"))});return e})}},defineAssertion:function(a,b){var c=this;_.deleteKeyword(a);_.defineKeyword(a,Tags.modifySubject(b,function(d){return _.withSameArgs(d,function(){var e=$callStack.safeLocation(1);
return c.currentAssertion?c.currentAssertion.babyAssertion(a,b,d,arguments,e):d.apply(c,arguments)})}))},printLog:function(a){if(!a.supressLog){var b=_.filter(this.runningTests,function(b){return b.failed||!a.silent&&b.hasLog}),c=_.filter(this.runningTests,_.property("failed"));_.invoke(a.verbose?this.runningTests:b,"printLog");c.length?log.orange("\n"+log.boldLine+"\nSOME TESTS FAILED:",_.pluck(c,"name").join(", "),"\n\n"):!0!==a.silent&&log.green("\n"+log.boldLine+"\nALL TESTS PASS\n\n")}}});
Test=$prototype({constructor:function(a){_.defaults(this,a,{name:"<< UNNAMED FOR UNKNOWN REASON >>",failed:!1,routine:void 0,verbose:!1,depth:1,indent:0,failedAssertions:[],context:this,complete:_.barrier()});this.babyAssertion=$interlocked(this.babyAssertion)},finalize:function(){this.babyAssertion.wait(this.$(function(){this.canFail&&this.failedAssertions.length&&(this.failed=!0);this.complete(!0)}))},babyAssertion:function(a,b,c,d,e,g){var f=this,h=new Test({mother:this,name:b,shouldFail:c.$shouldFail||
this.shouldFail,depth:this.depth+1,location:g,context:this.context,timeout:this.timeout/2,verbose:this.verbose,silent:this.silent,routine:Tags.modifySubject(c,function(a){return function(b){if($async.is(e[0]))_.cps.apply(a,f.context,e,function(a,c){c&&c();b()});else try{a.apply(f.context,e),b()}catch(c){h.onException(c)}}})}),k=function(){h.failed&&f.canFail&&f.failedAssertions.push(h);a()};h.run(function(){Testosterone.currentAssertion=f;h.failed||h.verbose&&h.logCalls.notEmpty?h.location.sourceReady(function(a){log.red(a,
log.config({location:h.location,where:h.location}));h.evalLogCalls();k()}):k()})},canFail:$property(function(){return!this.failed&&!this.shouldFail}),fail:function(){this.failed=!0;this.finalize()},assertionStack:$property(function(){var a=[],b=this;do a.push(b),b=b.mother;while(b);return a}),onException:function(a){if(this.canFail||this.verbose){if(_.isAssertionError(a)){if("notMatching"in a){var b=_.coerceToArray(a.notMatching);a.asColumns?log.orange(log.columns(_.map(b,function(a){return["\u2022 "+
_.keys(a)[0],_.stringify(_.values(a)[0])]})).join("\n")):_.each(b,function(a,b){log.orange("\u2022",a)})}}else 1<this.depth&&log.newline(),log.write(a);log.newline()}this.canFail?this.fail():this.finalize()},run:function(a){var b=Testosterone.currentAssertion=this,c=Tags.unwrap(this.routine);this.shouldFail=$shouldFail.is(this.routine);this.hasLog=this.failed=!1;this.logCalls=[];this.failureLocations={};_.withTimeout({maxTime:b.timeout,expired:function(){b.canFail&&(log.error("TIMEOUT EXPIRED"),b.fail())}},
function(a){b.complete(a.arity0)});log.withWriteBackend(_.extendWith({indent:b.depth+(b.indent||0)},function(a){b.logCalls.push(a)}),function(d){b.complete(d.arity0);a&&b.complete(a);0<c.length?c.call(b.context,b.$(b.finalize)):(c.call(b.context),b.finalize())})},printLog:function(){var a=this.suite&&this.suite!==this.name&&(this.suite||"").quote("[]")||"";log.write(log.color.blue,"\n"+log.boldLine,"\n"+_.nonempty([a,this.name]).join(" "),(this.index+" of "+Testosterone.runningTests.length).quote("()")+
(this.failed?" FAILED":"")+":","\n");this.evalLogCalls()},evalLogCalls:function(){_.each(this.logCalls,log.writeBackend().arity1)}});Platform.NodeJS&&(module.exports=Testosterone);_.measure=function(a,b){if(b){var c=_.now();a(function(){b(_.now()-c)})}else return c=_.now(),a(),_.now()-c};
_.perfTest=function(a,b){var c=_.isFunction(a)?{test:a}:a,d={};_.cps.each(c,function(a,b,c){var h=[],k=function(){for(var c=0;500>c;c++)h.push(a());console.log(b,h)};k();_.delay(function(){d[b]=_.measure(k)/500;c()},100)},function(){b(d)})};
(function(){var a=$r.expr("how",$r.text("before").or.text("after")).expr("name",$r.anything).$;_.defineKeyword("aspect",function(b,c){var d=Tags.unwrap(_.sequence($prototype.impl.extendWithTags,$prototype.impl.flatten,$prototype.impl.generateArgumentContractsIfNeeded,$prototype.impl.contributeTraits,$prototype.impl.expandAliases).call($prototype.impl,c)),e=b.constructor&&b.constructor.$definition;e&&(e.$aspects=e.$aspects||[]).push(d);_.each(d,function(c,e){if(d.hasOwnProperty(e)&&_.isFunction(c)){var h=
a.parse(e),k=h.name&&h.name.decapitalized||e;if(h=h.how&&_["on"+h.how.capitalized]||_.intercept){var m=b[k];m&&_.isFunction(m)&&h(b,k,c);var m=b.prototype,l=m[k];l&&_.isFunction(l)&&h(m,k,c)}}});b.aspectAdded&&b.aspectAdded(d);return d})})();
Platform.Browser&&jQuery&&function(a){var b=_.clone(a.fn);_.extend(a,{svg:function(b){var d=document.createElementNS("http://www.w3.org/2000/svg",b);"svg"!==b||Platform.IE||d.setAttribute("xmlns","http://www.w3.org/2000/svg");return a(d)}}).fn.extend({on:function(a,d){var e=this;d=_.find(arguments,_.isFunction);d.queuedBy&&d.queuedBy.push({remove:function(){e.off(a,d)}});return b.on.apply(this,arguments)},item:function(a){return a?(this.length&&(this[0]._item=a),this):this.length?this[0]._item:void 0},
props:function(a){_.extend.apply(null,[this[0]].concat(arguments));return this},props2:function(a){_.extend2.apply(null,[this[0]].concat(arguments));return this},hasWait:function(){return this.hasClass("i-am-busy")},waitUntil:function(a,b){this.addClass("i-am-busy").attr("disabled",!0);a(this.$(function(){this.removeClass("i-am-busy").removeAttr("disabled");b&&b.apply(null,arguments)}));return this},hasParent:function(a){for(var b=this;0<b.length;){if(b[0]==(a[0]||a))return!0;b=b.parent()}return!1},
nonemptyValue:function(){var b=a.trim(this.val());return 0==b.length?void 0:b},intValue:function(){var a=parseInt(this.nonemptyValue(),10);return isNaN(a)?void 0:a},hitTest:function(b){var d=this.offset(),e=b.clientX-d.left;b=b.clientY-d.top;return 0<=e&&0<=b&&e<a(this).width()&&b<a(this).height()},attrs:function(){return _.object(_.map(arguments,function(a){return[a,this.attr(a)]},this))},belongsTo:function(a){return this.is(a)||this.parents(a).length},selectClass:function(a,b){return this.removeClass(_.values(b).join(" ")).addClass(b[a])},
attrInt:function(a){return(this.attr(a)||"").integerValue},cssInt:function(a){return(this.css(a)||"").integerValue},eachChild:function(b,d){_.each(this.find(b),function(b){d(a(b))});return this},transitionend:function(a){return this.one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",a.oneShot)},animationend:function(a){return this.one("animationend webkitAnimationEnd oAnimationEnd oanimation MSAnimationEnd",a.oneShot)},animateWith:function(a,b){a&&(this.addClass(a),
this.animationend(this.$(function(){this.removeClass(a);b&&b.call(this)})));return this},drag:function(){var b=function(b,c){return b.originalEvent.touches&&_.find(b.originalEvent.touches,function(b){return a(b.target).hasParent(c)})||b};return function(d){Platform.touch||window.__globalDragOverlay||(window.__globalDragOverlay=a("<div>").css({display:"none",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:999999}).appendTo(document.body));var e=window.__globalDragOverlay,g=d.button||1,f=this.$(function(f){var h=
d.relativeTo||this;this.addClass(d.cls||"");if(Platform.touch||f.which===g){var l=h.offset(),n=void 0;if(!d.start||!1!==(n=d.start.call(d.context||this,new Vec2(f.pageX-l.left,f.pageY-l.top),f))){var p=void 0,r=void 0,q=void 0,n=_.clone(n),t=this.$(function(a){if(Platform.touch||a.which===g){a.preventDefault();a=b(a,this[0]);var e=h.offset();n=d.move.call(d.context||this,n,new Vec2(a.pageX-f.pageX,a.pageY-f.pageY),new Vec2(a.pageX-e.left,a.pageY-e.top),a)||n}else p(a)}),r=function(){a(e||document.body).css(e?
{display:"none"}:{}).off("mouseup touchend",q).off("mousemove touchmove",t)},q=this.$(function(a){r();d.end&&(a=b(a,this[0]),d.end.call(d.context||this,n,new Vec2(a.pageX-f.pageX,a.pageY-f.pageY),a));this.removeClass(d.cls||"")}),p=this.$(function(a){r();q(a)});a(e||document.body).css(e?{display:"",cursor:d.cursor||""}:{}).on("mousemove touchmove",t).one("mouseup touchend",q);d.callMoveAtStart&&d.move.call(d.context||this,n,Vec2.zero,new Vec2(f.pageX-l.left,f.pageY-l.top),f)}}}),h=_.$(this,function(a){var e=
_.extend({},b(a,this[0]));if(Platform.touch&&d.longPress){var g=void 0,h=window.setTimeout(_.$(this,function(){this.off("touchmove touchend",g);f(e)}),300),g=this.$(function(){window.clearTimeout(h);this.off("touchmove touchend",g)});this.one("touchmove touchend",g)}else f(e),a.preventDefault(),a.stopPropagation()});this.on(Platform.touch?"touchstart":"mousedown",h);return _.extend(this,{cancel:this.$(function(){this.off(Platform.touch?"touchstart":"mousedown",h)})})}}(),transform:function(a){if(0===
arguments.length){var b=(this.css("transform")||"").match(/^matrix\((.+\))$/);return b?(b=b[1].split(",").map(parseFloat),new Transform({a:b[0],b:b[1],c:b[2],d:b[3],e:b[4],f:b[5]})):Transform.identity}return this.css("transform",_.isStrictlyObject(a)&&(a.translate?"translate("+a.translate.x+"px,"+a.translate.y+"px) ":"")+(a.rotate?"rotate("+a.rotate+"rad) ":"")+(a.scale?"scale("+(new Vec2(a.scale)).separatedWith(",")+")":"")||"")},svgTranslate:function(a){return this.attr("transform","translate("+
a.x+","+a.y+")")},svgTransformMatrix:function(a){a=a.components;return this.attr("transform","matrix("+a[0][0]+","+a[1][0]+","+a[0][1]+","+a[1][1]+","+a[0][2]+","+a[1][2]+")")},svgTransformToElement:function(a){return Transform.svgMatrix(this[0].getTransformToElement(a[0]))},svgBBox:function(a){return 0===arguments.length?new BBox(this[0].getBBox()):this.attr(a.xywh)},outerExtent:function(){return new Vec2(this.outerWidth(),this.outerHeight())},extent:function(){return new Vec2(this.width(),this.height())},
innerExtent:function(){return new Vec2(this.innerWidth(),this.innerHeight())},outerBBox:function(){return BBox.fromLTWH(_.extend(this.offset(),this.outerExtent().asWidthHeight))},clientBBox:function(){return BBox.fromLTWH(this[0].getBoundingClientRect())},leftTop:function(){return new Vec2.fromLT(this.offset())},offsetInParent:function(){return Vec2.fromLeftTop(this.offset()).sub(Vec2.fromLeftTop(this.parent().offset()))},monitorInput:function(b){var d=function(){""===a.trim(a(this).val())?b.empty(!0):
b.empty(!1)};return this.keyup(d).change(d).focus(_.bind(b.focus||_.noop,b,!0)).blur(_.bind(b.focus||_.noop,b,!1))},touchClick:function(a,b){var e=this;b=b||{};if(!b.disableTouch&&Platform.touch){var g=function(b){a.apply(this,arguments);b.preventDefault();return!1},f=function(a){a.preventDefault();return!1};b.handler&&b.handler({unbind:function(){e.off("touchstart",g).off("click",f)}});return this.on("touchstart",g).on("click",f)}b.handler&&b.handler({unbind:function(){e.off("click",a)}});return this.click(a)},
touchDoubleclick:function(a){if(Platform.touch){var b=Date.now();return this.on("touchend",function(){var e=Date.now();200>e-b&&a.apply(this,arguments);b=e})}return this.dblclick(a)},nodoubletapzoom:function(){return a(this).bind("touchstart",function(b){var d=b.timeStamp,e=a(this).data("lastTouch")||d,e=d-e,g=b.originalEvent.touches.length;a(this).data("lastTouch",d);!e||500<e||1<g||(b.preventDefault(),a(b.target).trigger("click"))})}})}(jQuery);Platform.NodeJS&&(module.exports=_);
